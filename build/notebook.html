<!DOCTYPE html>
<!-- generated by build/build.js -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICPC Notebook</title>
    <!-- MathJax -->
    <script>
        var MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$','$$']]
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- css -->
    <link rel="stylesheet" type="text/css" href="notebook.css" />
</head>
<body>
    <h1 id="title">ICPC Notebook</h1>
    <!-- 目次 -->
    <nav id="toc" role="doc-toc">
        <ol>
            
    <li><a class="section" href="#template">template</a></li>
    <ol>
    <li><a href="#hash.sh">hash.sh</a></li>
    <li><a href="#settings.sh">settings.sh</a></li>
    <li><a href="#template.hpp">template.hpp</a></li>
    </ol>
    <li><a class="section" href="#data-structure">data-structure</a></li>
    <ol>
    <li><a href="#2d_segtree.cpp">2d_segtree.cpp</a></li>
    <li><a href="#beats.md">beats.md</a></li>
    <li><a href="#beats_example.cpp">beats_example.cpp</a></li>
    <li><a href="#binary_trie.hpp">binary_trie.hpp</a></li>
    <li><a href="#cht_slope_monotone.hpp">cht_slope_monotone.hpp</a></li>
    <li><a href="#disjoint_sparse_table.hpp">disjoint_sparse_table.hpp</a></li>
    <li><a href="#lazy_segtree.hpp">lazy_segtree.hpp</a></li>
    <li><a href="#li_chao.hpp">li_chao.hpp</a></li>
    <li><a href="#persistent-array.hpp">persistent-array.hpp</a></li>
    <li><a href="#persistent-segtree.hpp">persistent-segtree.hpp</a></li>
    <li><a href="#persistent-uf.hpp">persistent-uf.hpp</a></li>
    <li><a href="#potential_dsu.hpp">potential_dsu.hpp</a></li>
    <li><a href="#range_set.hpp">range_set.hpp</a></li>
    <li><a href="#range_tree.hpp">range_tree.hpp</a></li>
    <li><a href="#segtree.hpp">segtree.hpp</a></li>
    <li><a href="#treap.hpp">treap.hpp</a></li>
    <li><a href="#undo_dsu.hpp">undo_dsu.hpp</a></li>
    <li><a href="#wavelet_matrix.hpp">wavelet_matrix.hpp</a></li>
    </ol>
    <li><a class="section" href="#math">math</a></li>
    <ol>
    <li><a href="#BinaryGCD.hpp">BinaryGCD.hpp</a></li>
    <li><a href="#ExtGCD.hpp">ExtGCD.hpp</a></li>
    <li><a href="#combination.hpp">combination.hpp</a></li>
    <li><a href="#crt.hpp">crt.hpp</a></li>
    <li><a href="#floor_sum.hpp">floor_sum.hpp</a></li>
    <li><a href="#fwt.hpp">fwt.hpp</a></li>
    <li><a href="#lagrange_polynomial.hpp">lagrange_polynomial.hpp</a></li>
    <li><a href="#min_of_mod_of_linear.hpp">min_of_mod_of_linear.hpp</a></li>
    <li><a href="#modinv.hpp">modinv.hpp</a></li>
    <li><a href="#modlog.hpp">modlog.hpp</a></li>
    <li><a href="#modsqrt.hpp">modsqrt.hpp</a></li>
    <li><a href="#primality.hpp">primality.hpp</a></li>
    <li><a href="#primitive-root.hpp">primitive-root.hpp</a></li>
    <li><a href="#rho.hpp">rho.hpp</a></li>
    </ol>
    <li><a class="section" href="#modint">modint</a></li>
    <ol>
    <li><a href="#BarrettReduction.hpp">BarrettReduction.hpp</a></li>
    <li><a href="#modint.hpp">modint.hpp</a></li>
    </ol>
    <li><a class="section" href="#FPS">FPS</a></li>
    <ol>
    <li><a href="#FFT.hpp">FFT.hpp</a></li>
    <li><a href="#barlekamp_massey.hpp">barlekamp_massey.hpp</a></li>
    <li><a href="#bostan_mori.hpp">bostan_mori.hpp</a></li>
    <li><a href="#fps.hpp">fps.hpp</a></li>
    <li><a href="#fps_sparse.hpp">fps_sparse.hpp</a></li>
    <li><a href="#relaxed_conv.hpp">relaxed_conv.hpp</a></li>
    </ol>
    <li><a class="section" href="#graph">graph</a></li>
    <ol>
    <li><a href="#bi_connected_components.hpp">bi_connected_components.hpp</a></li>
    <li><a href="#eulerian_trail.hpp">eulerian_trail.hpp</a></li>
    <li><a href="#low_link.hpp">low_link.hpp</a></li>
    <li><a href="#manhattan_mst.hpp">manhattan_mst.hpp</a></li>
    <li><a href="#max_flow.hpp">max_flow.hpp</a></li>
    <li><a href="#min_cost_flow.hpp">min_cost_flow.hpp</a></li>
    <li><a href="#scc.hpp">scc.hpp</a></li>
    <li><a href="#two_sat.hpp">two_sat.hpp</a></li>
    </ol>
    <li><a class="section" href="#graph/tree">graph/tree</a></li>
    <ol>
    <li><a href="#cartesian_tree.hpp">cartesian_tree.hpp</a></li>
    <li><a href="#dominator_tree.hpp">dominator_tree.hpp</a></li>
    <li><a href="#hld.hpp">hld.hpp</a></li>
    </ol>
    <li><a class="section" href="#flow">flow</a></li>
    <ol>
    <li><a href="#燃やす埋める.md">燃やす埋める.md</a></li>
    </ol>
    <li><a class="section" href="#string">string</a></li>
    <ol>
    <li><a href="#KMP.hpp">KMP.hpp</a></li>
    <li><a href="#Manacher.hpp">Manacher.hpp</a></li>
    <li><a href="#RollingHash.hpp">RollingHash.hpp</a></li>
    <li><a href="#SuffixArray.hpp">SuffixArray.hpp</a></li>
    <li><a href="#Zalgorithm.hpp">Zalgorithm.hpp</a></li>
    <li><a href="#aho_corasick.hpp">aho_corasick.hpp</a></li>
    <li><a href="#sa_is.hpp">sa_is.hpp</a></li>
    <li><a href="#trie.hpp">trie.hpp</a></li>
    </ol>
    <li><a class="section" href="#algorithm">algorithm</a></li>
    <ol>
    <li><a href="#3d_mo.hpp">3d_mo.hpp</a></li>
    <li><a href="#larsch.hpp">larsch.hpp</a></li>
    <li><a href="#min_plus_concave.hpp">min_plus_concave.hpp</a></li>
    <li><a href="#min_plus_conv.hpp">min_plus_conv.hpp</a></li>
    <li><a href="#mo.hpp">mo.hpp</a></li>
    <li><a href="#rollback_mo.hpp">rollback_mo.hpp</a></li>
    </ol>
    <li><a class="section" href="#geometry">geometry</a></li>
    <ol>
    <li><a href="#base.hpp">base.hpp</a></li>
    <li><a href="#convex_hull.hpp">convex_hull.hpp</a></li>
    <li><a href="#etc.hpp">etc.hpp</a></li>
    </ol>
    <li><a class="section" href="#memo">memo</a></li>
    <ol>
    <li><a href="#BIT二分探索.cpp">BIT二分探索.cpp</a></li>
    <li><a href="#Primes.md">Primes.md</a></li>
    <li><a href="#bigint.md">bigint.md</a></li>
    <li><a href="#ext.cpp">ext.cpp</a></li>
    <li><a href="#random.hpp">random.hpp</a></li>
    <li><a href="#set_compare.md">set_compare.md</a></li>
    <li><a href="#数式.md">数式.md</a></li>
    <li><a href="#牛ゲー.md">牛ゲー.md</a></li>
    </ol>
        </ol>
    </nav>

    
    <h2 class="section" id="template">template</h2>

    <div class="filename">
        <h2 id="hash.sh">hash.sh</h2>
    </div>
    <div class="content content-sh">
    <pre><code><span class="token comment"># 使い方: sh hash.sh -> コピペ -> Ctrl + D</span>
<span class="token comment"># コメント・空白・改行を削除して md5 でハッシュする</span>
g++ <span class="token parameter variable">-dD</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-fpreprocessed</span> - <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'[:space:]'</span> <span class="token operator">|</span> md5sum <span class="token operator">|</span> <span class="token function">cut</span> -c-6
</code></pre>
</div>

    <div class="filename">
        <h2 id="settings.sh">settings.sh</h2>
    </div>
    <div class="content content-sh">
    <pre><code><span class="token comment"># CLion の設定</span>
Settings → Build → CMake → Reload CMake Project
add_compile_options<span class="token punctuation">(</span>-D_GLIBCXX_DEBUG<span class="token punctuation">)</span>
<span class="token comment"># Caps Lock を Ctrl に変更</span>
setxkbmap <span class="token parameter variable">-option</span> ctrl:nocaps
</code></pre>
</div>

    <div class="filename">
        <h2 id="template.hpp">template.hpp</h2>
        md5: b929fd

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC <span class="token function">target</span><span class="token punctuation">(</span></span><span class="token string">"avx2"</span><span class="token expression"><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC <span class="token function">optimize</span><span class="token punctuation">(</span></span><span class="token string">"O3"</span><span class="token expression"><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">GCC <span class="token function">optimize</span><span class="token punctuation">(</span></span><span class="token string">"unroll-loops"</span><span class="token expression"><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">using</span> ll <span class="token operator">=</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ll INF <span class="token operator">=</span> LLONG_MAX <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">all</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token function">begin</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span></span>
<span class="token keyword">bool</span> <span class="token function">chmin</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">auto</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">></span> b <span class="token operator">?</span> a <span class="token operator">=</span> b<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">bool</span> <span class="token function">chmax</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">auto</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">&lt;</span> b <span class="token operator">?</span> a <span class="token operator">=</span> b<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">dout</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// your code here...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <h2 class="section" id="data-structure">data-structure</h2>

    <div class="filename">
        <h2 id="2d_segtree.cpp">2d_segtree.cpp</h2>
        md5: 5be105

    </div>
    <div class="content content-cpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">F</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">SegmentTree2D</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> h <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> W <span class="token operator">+</span> w<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">int</span> H<span class="token punctuation">,</span> W<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> seg<span class="token punctuation">;</span>
   <span class="token keyword">const</span> F f<span class="token punctuation">;</span>
   <span class="token keyword">const</span> T I<span class="token punctuation">;</span>

   <span class="token function">SegmentTree2D</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> F _f<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">f</span><span class="token punctuation">(</span>_f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">I</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">init</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      H <span class="token operator">=</span> W <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>H <span class="token operator">&lt;</span> h<span class="token punctuation">)</span> H <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>W <span class="token operator">&lt;</span> w<span class="token punctuation">)</span> W <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      seg<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> H <span class="token operator">*</span> W<span class="token punctuation">,</span> I<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h <span class="token operator">+</span> H<span class="token punctuation">,</span> w <span class="token operator">+</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> w <span class="token operator">=</span> W<span class="token punctuation">;</span> w <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">*</span> W<span class="token punctuation">;</span> w<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> h <span class="token operator">=</span> H <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> h<span class="token punctuation">;</span> h<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> h <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> h <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">*</span> H<span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> w <span class="token operator">=</span> W <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> w<span class="token punctuation">;</span> w<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> w <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   T <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h <span class="token operator">+</span> H<span class="token punctuation">,</span> w <span class="token operator">+</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   T <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h <span class="token operator">+</span> H<span class="token punctuation">,</span> w <span class="token operator">+</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      h <span class="token operator">+=</span> H<span class="token punctuation">,</span> w <span class="token operator">+=</span> W<span class="token punctuation">;</span>
      seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> h <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token punctuation">;</span> i <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> h<span class="token punctuation">;</span> h <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> w <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token punctuation">;</span> j <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   T <span class="token function">_inner_query</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w1<span class="token punctuation">,</span> <span class="token keyword">int</span> w2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T res <span class="token operator">=</span> I<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> w1 <span class="token operator">&lt;</span> w2<span class="token punctuation">;</span> w1 <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">,</span> w2 <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>w1 <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> w1<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>w2 <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">--</span>w2<span class="token punctuation">,</span> res <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> seg<span class="token punctuation">[</span><span class="token function">id</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> h1<span class="token punctuation">,</span> <span class="token keyword">int</span> w1<span class="token punctuation">,</span> <span class="token keyword">int</span> h2<span class="token punctuation">,</span> <span class="token keyword">int</span> w2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>h1 <span class="token operator">>=</span> h2 <span class="token operator">||</span> w1 <span class="token operator">>=</span> w2<span class="token punctuation">)</span> <span class="token keyword">return</span> I<span class="token punctuation">;</span>
      T res <span class="token operator">=</span> I<span class="token punctuation">;</span>
      h1 <span class="token operator">+=</span> H<span class="token punctuation">,</span> h2 <span class="token operator">+=</span> H<span class="token punctuation">,</span> w1 <span class="token operator">+=</span> W<span class="token punctuation">,</span> w2 <span class="token operator">+=</span> W<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> h1 <span class="token operator">&lt;</span> h2<span class="token punctuation">;</span> h1 <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">,</span> h2 <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>h1 <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">_inner_query</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> h1<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>h2 <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">--</span>h2<span class="token punctuation">,</span> res <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">_inner_query</span><span class="token punctuation">(</span>h2<span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="beats.md">beats.md</h2>
    </div>
    <div class="content content-md"><p>lazy_segtreeの一部を変更して作る</p>
<pre><code class="language-diff">void all_apply(int k, F f) {
    d[k] = mappin(f, d[k]);
-   if(k &lt; size) lz[k] = composition(f, lz[k]);
+   if(k &lt; size)){
+       lz[k] = composition(f, lz[k]);
+       if(d[k].fail)push(k), update(k);
+   }
}
</code></pre>
<ul>
<li><code>S</code>は<code>alcoder::lazy_segtree</code>空参照可能なメンバ変数<code>fail</code>を持つ</li>
<li><code>mapping</code>関数による<code>S</code>の元<code>x</code>への作用の結果を得る計算が(<code>x</code>の持つ情報の不足が原因で)失敗した時のみ，<code>mapping</code>関数が返す<code>S</code>のインスタンスの<code>fail</code>の値は<code>true</code>となる</li>
<li><code>mapping</code>関数による作用以外の部分で計算は失敗しない</li>
<li>要素数1の区間を管理する<code>S</code>の元に対する<code>mapping</code>は失敗してはならない</li>
</ul>
</div>

    <div class="filename">
        <h2 id="beats_example.cpp">beats_example.cpp</h2>
        md5: eb71ce

    </div>
    <div class="content content-cpp">
    <pre><code><span class="token comment">// 区間chmax, chmin, add 区間sum取得</span>
<span class="token keyword">namespace</span> RangeChMinMaxAddSum <span class="token punctuation">{</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Num</span><span class="token operator">></span> <span class="token keyword">inline</span> Num <span class="token function">second_lowest</span><span class="token punctuation">(</span>Num a<span class="token punctuation">,</span> Num a2<span class="token punctuation">,</span> Num c<span class="token punctuation">,</span> Num c2<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
   <span class="token comment">// a &lt; a2, c &lt; c2 のとき全引数を昇順ソートして二番目の値</span>
   <span class="token keyword">return</span> a <span class="token operator">==</span> c <span class="token operator">?</span> std<span class="token double-colon punctuation">::</span><span class="token function">min</span><span class="token punctuation">(</span>a2<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token operator">:</span> a2 <span class="token operator">&lt;=</span> c <span class="token operator">?</span> a2 <span class="token operator">:</span> c2 <span class="token operator">&lt;=</span> a <span class="token operator">?</span> c2 <span class="token operator">:</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Num</span><span class="token operator">></span> <span class="token keyword">inline</span> Num <span class="token function">second_highest</span><span class="token punctuation">(</span>Num a<span class="token punctuation">,</span> Num a2<span class="token punctuation">,</span> Num b<span class="token punctuation">,</span> Num b2<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
   <span class="token comment">// a > a2, b > b2 のとき全引数を降順ソートして二番目の値</span>
   <span class="token keyword">return</span> a <span class="token operator">==</span> b <span class="token operator">?</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>a2<span class="token punctuation">,</span> b2<span class="token punctuation">)</span> <span class="token operator">:</span> a2 <span class="token operator">>=</span> b <span class="token operator">?</span> a2 <span class="token operator">:</span> b2 <span class="token operator">>=</span> a <span class="token operator">?</span> b2 <span class="token operator">:</span> std<span class="token double-colon punctuation">::</span><span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">constexpr</span> ll BINF <span class="token operator">=</span> <span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> <span class="token number">61</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">{</span>
   ll lo<span class="token punctuation">,</span> hi<span class="token punctuation">,</span> lo2<span class="token punctuation">,</span> hi2<span class="token punctuation">,</span> sum<span class="token punctuation">;</span>  <span class="token comment">// 区間最小・最大値，区間最小・最大から二番目の値，区間総和</span>
   <span class="token keyword">unsigned</span> sz<span class="token punctuation">,</span> nlo<span class="token punctuation">,</span> nhi<span class="token punctuation">;</span>     <span class="token comment">// 区間要素数，区間最小・最大値をとる要素の個数</span>
   <span class="token keyword">bool</span> fail<span class="token punctuation">;</span>
   <span class="token function">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">lo</span><span class="token punctuation">(</span>BINF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token operator">-</span>BINF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lo2</span><span class="token punctuation">(</span>BINF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hi2</span><span class="token punctuation">(</span><span class="token operator">-</span>BINF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sz</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nlo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nhi</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">S</span><span class="token punctuation">(</span>ll x<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> sz_ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token operator">:</span> <span class="token function">lo</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hi</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lo2</span><span class="token punctuation">(</span>BINF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hi2</span><span class="token punctuation">(</span><span class="token operator">-</span>BINF<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>x <span class="token operator">*</span> sz_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sz</span><span class="token punctuation">(</span>sz_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nlo</span><span class="token punctuation">(</span>sz_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nhi</span><span class="token punctuation">(</span>sz_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

S <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

S <span class="token function">op</span><span class="token punctuation">(</span>S l<span class="token punctuation">,</span> S r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   S ret<span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>lo <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>lo<span class="token punctuation">,</span> r<span class="token punctuation">.</span>lo<span class="token punctuation">)</span><span class="token punctuation">,</span> ret<span class="token punctuation">.</span>hi <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>hi<span class="token punctuation">,</span> r<span class="token punctuation">.</span>hi<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>lo2 <span class="token operator">=</span> <span class="token function">second_lowest</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>lo<span class="token punctuation">,</span> l<span class="token punctuation">.</span>lo2<span class="token punctuation">,</span> r<span class="token punctuation">.</span>lo<span class="token punctuation">,</span> r<span class="token punctuation">.</span>lo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>hi2 <span class="token operator">=</span> <span class="token function">second_highest</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>hi<span class="token punctuation">,</span> l<span class="token punctuation">.</span>hi2<span class="token punctuation">,</span> r<span class="token punctuation">.</span>hi<span class="token punctuation">,</span> r<span class="token punctuation">.</span>hi2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>sum <span class="token operator">=</span> l<span class="token punctuation">.</span>sum <span class="token operator">+</span> r<span class="token punctuation">.</span>sum<span class="token punctuation">,</span> ret<span class="token punctuation">.</span>sz <span class="token operator">=</span> l<span class="token punctuation">.</span>sz <span class="token operator">+</span> r<span class="token punctuation">.</span>sz<span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>nlo <span class="token operator">=</span> l<span class="token punctuation">.</span>nlo <span class="token operator">*</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>lo <span class="token operator">&lt;=</span> r<span class="token punctuation">.</span>lo<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>nlo <span class="token operator">*</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>lo <span class="token operator">&lt;=</span> l<span class="token punctuation">.</span>lo<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>nhi <span class="token operator">=</span> l<span class="token punctuation">.</span>nhi <span class="token operator">*</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>hi <span class="token operator">>=</span> r<span class="token punctuation">.</span>hi<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>nhi <span class="token operator">*</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>hi <span class="token operator">>=</span> l<span class="token punctuation">.</span>hi<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">F</span> <span class="token punctuation">{</span>
   ll lb<span class="token punctuation">,</span> ub<span class="token punctuation">,</span> bias<span class="token punctuation">;</span>
   <span class="token function">F</span><span class="token punctuation">(</span>ll chmax_ <span class="token operator">=</span> <span class="token operator">-</span>BINF<span class="token punctuation">,</span> ll chmin_ <span class="token operator">=</span> BINF<span class="token punctuation">,</span> ll add <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">lb</span><span class="token punctuation">(</span>chmax_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ub</span><span class="token punctuation">(</span>chmin_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bias</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">static</span> F <span class="token function">chmin</span><span class="token punctuation">(</span>ll x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token operator">-</span>BINF<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token function">ll</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">static</span> F <span class="token function">chmax</span><span class="token punctuation">(</span>ll x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">F</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> BINF<span class="token punctuation">,</span> <span class="token function">ll</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">static</span> F <span class="token function">add</span><span class="token punctuation">(</span>ll x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token operator">-</span>BINF<span class="token punctuation">,</span> BINF<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

F <span class="token function">composition</span><span class="token punctuation">(</span>F fnew<span class="token punctuation">,</span> F fold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   F ret<span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>lb <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>fold<span class="token punctuation">.</span>lb <span class="token operator">+</span> fold<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> fnew<span class="token punctuation">.</span>ub<span class="token punctuation">)</span><span class="token punctuation">,</span> fnew<span class="token punctuation">.</span>lb<span class="token punctuation">)</span> <span class="token operator">-</span> fold<span class="token punctuation">.</span>bias<span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>ub <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>fold<span class="token punctuation">.</span>ub <span class="token operator">+</span> fold<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> fnew<span class="token punctuation">.</span>lb<span class="token punctuation">)</span><span class="token punctuation">,</span> fnew<span class="token punctuation">.</span>ub<span class="token punctuation">)</span> <span class="token operator">-</span> fold<span class="token punctuation">.</span>bias<span class="token punctuation">;</span>
   ret<span class="token punctuation">.</span>bias <span class="token operator">=</span> fold<span class="token punctuation">.</span>bias <span class="token operator">+</span> fnew<span class="token punctuation">.</span>bias<span class="token punctuation">;</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

F <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

S <span class="token function">mapping</span><span class="token punctuation">(</span>F f<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>sz <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>lo <span class="token operator">==</span> x<span class="token punctuation">.</span>hi <span class="token operator">or</span> f<span class="token punctuation">.</span>lb <span class="token operator">==</span> f<span class="token punctuation">.</span>ub <span class="token operator">or</span> f<span class="token punctuation">.</span>lb <span class="token operator">>=</span> x<span class="token punctuation">.</span>hi <span class="token operator">or</span> f<span class="token punctuation">.</span>ub <span class="token operator">&lt;=</span> x<span class="token punctuation">.</span>lo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">S</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>lo<span class="token punctuation">,</span> f<span class="token punctuation">.</span>lb<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>ub<span class="token punctuation">)</span> <span class="token operator">+</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> x<span class="token punctuation">.</span>sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>lo2 <span class="token operator">==</span> x<span class="token punctuation">.</span>hi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      x<span class="token punctuation">.</span>lo <span class="token operator">=</span> x<span class="token punctuation">.</span>hi2 <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>lo<span class="token punctuation">,</span> f<span class="token punctuation">.</span>lb<span class="token punctuation">)</span> <span class="token operator">+</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">;</span>
      x<span class="token punctuation">.</span>hi <span class="token operator">=</span> x<span class="token punctuation">.</span>lo2 <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>hi<span class="token punctuation">,</span> f<span class="token punctuation">.</span>ub<span class="token punctuation">)</span> <span class="token operator">+</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">;</span>
      x<span class="token punctuation">.</span>sum <span class="token operator">=</span> x<span class="token punctuation">.</span>lo <span class="token operator">*</span> x<span class="token punctuation">.</span>nlo <span class="token operator">+</span> x<span class="token punctuation">.</span>hi <span class="token operator">*</span> x<span class="token punctuation">.</span>nhi<span class="token punctuation">;</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>lb <span class="token operator">&lt;</span> x<span class="token punctuation">.</span>lo2 <span class="token operator">and</span> f<span class="token punctuation">.</span>ub <span class="token operator">></span> x<span class="token punctuation">.</span>hi2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll nxt_lo <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>lo<span class="token punctuation">,</span> f<span class="token punctuation">.</span>lb<span class="token punctuation">)</span><span class="token punctuation">,</span> nxt_hi <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>hi<span class="token punctuation">,</span> f<span class="token punctuation">.</span>ub<span class="token punctuation">)</span><span class="token punctuation">;</span>
      x<span class="token punctuation">.</span>sum <span class="token operator">+=</span> <span class="token punctuation">(</span>nxt_lo <span class="token operator">-</span> x<span class="token punctuation">.</span>lo<span class="token punctuation">)</span> <span class="token operator">*</span> x<span class="token punctuation">.</span>nlo <span class="token operator">-</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>hi <span class="token operator">-</span> nxt_hi<span class="token punctuation">)</span> <span class="token operator">*</span> x<span class="token punctuation">.</span>nhi <span class="token operator">+</span> f<span class="token punctuation">.</span>bias <span class="token operator">*</span> x<span class="token punctuation">.</span>sz<span class="token punctuation">;</span>
      x<span class="token punctuation">.</span>lo <span class="token operator">=</span> nxt_lo <span class="token operator">+</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> x<span class="token punctuation">.</span>hi <span class="token operator">=</span> nxt_hi <span class="token operator">+</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> x<span class="token punctuation">.</span>lo2 <span class="token operator">+=</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> x<span class="token punctuation">.</span>hi2 <span class="token operator">+=</span> f<span class="token punctuation">.</span>bias<span class="token punctuation">;</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   x<span class="token punctuation">.</span>fail <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">using</span> segtree <span class="token operator">=</span> lazy_segtree<span class="token operator">&lt;</span>S<span class="token punctuation">,</span> op<span class="token punctuation">,</span> e<span class="token punctuation">,</span> F<span class="token punctuation">,</span> mapping<span class="token punctuation">,</span> composition<span class="token punctuation">,</span> id<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// namespace RangeChMinMaxAddSum</span></code></pre>
</div>

    <div class="filename">
        <h2 id="binary_trie.hpp">binary_trie.hpp</h2>
        md5: af8046

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: b75bb1</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">int</span> MAX_LOG <span class="token operator">=</span> <span class="token number">32</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">BinaryTrie</span> <span class="token punctuation">{</span>
   <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
      array<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">></span> next<span class="token punctuation">;</span>
      <span class="token keyword">int</span> common<span class="token punctuation">;</span>
      T lazy<span class="token punctuation">;</span>
      <span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> next<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>Node<span class="token operator">></span> nodes<span class="token punctuation">;</span>
   <span class="token function">BinaryTrie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">apply_xor</span><span class="token punctuation">(</span>T val<span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">^=</span> val<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> nodes<span class="token punctuation">[</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">^=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>lazy<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> nxt <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
         nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">erase</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">min_element</span><span class="token punctuation">(</span>T val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      T nxt <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ind <span class="token operator">=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> nodes<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token punctuation">.</span>common <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> nxt <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">min_element</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>nxt <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// ddf699</span>

   T <span class="token function">max_element</span><span class="token punctuation">(</span>T val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">min_element</span><span class="token punctuation">(</span><span class="token operator">~</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 5e1a86</span>

   <span class="token keyword">int</span> <span class="token function">lower_bound_rank</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      T nxt <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">lower_bound_rank</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>nxt <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ret <span class="token operator">+=</span> nodes<span class="token punctuation">[</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 05b14c</span>

   <span class="token keyword">int</span> <span class="token function">upper_bound_rank</span><span class="token punctuation">(</span>T val<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_bound_rank</span><span class="token punctuation">(</span>val <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 70e301</span>

   T <span class="token function">kth_smallest</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> lower_ind <span class="token operator">=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> lower_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lower_ind <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> lower_cnt <span class="token operator">=</span> nodes<span class="token punctuation">[</span>lower_ind<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> lower_cnt<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">kth_smallest</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">kth_smallest</span><span class="token punctuation">(</span>k <span class="token operator">-</span> lower_cnt<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// b85845</span>

   T <span class="token function">kth_largest</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">kth_smallest</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>common <span class="token operator">-</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 1df41b</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span>T val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> b <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> b<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
         cur <span class="token operator">=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 2a3342</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 210f0e</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="cht_slope_monotone.hpp">cht_slope_monotone.hpp</h2>
        md5: 720828

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">CHT</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> P <span class="token operator">=</span> pair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">></span><span class="token punctuation">;</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> head<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>P<span class="token operator">></span> lines<span class="token punctuation">;</span>
   <span class="token comment">// 最小値(最大値)を求めるxが単調であるか</span>
   <span class="token keyword">bool</span> isMonotonicX<span class="token punctuation">;</span>
   function<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">(</span>T l<span class="token punctuation">,</span> T r<span class="token punctuation">)</span><span class="token operator">></span> comp<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token comment">// クエリが単調であった場合はflag = trueとする</span>
   <span class="token function">CHT</span><span class="token punctuation">(</span>
       <span class="token keyword">bool</span> flagX <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> function<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">(</span>T l<span class="token punctuation">,</span> T r<span class="token punctuation">)</span><span class="token operator">></span> compFunc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>T l<span class="token punctuation">,</span> T r<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> l <span class="token operator">>=</span> r<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token operator">:</span> <span class="token function">isMonotonicX</span><span class="token punctuation">(</span>flagX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">comp</span><span class="token punctuation">(</span>compFunc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">bool</span> <span class="token function">check</span><span class="token punctuation">(</span>P l1<span class="token punctuation">,</span> P l2<span class="token punctuation">,</span> P l3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l1 <span class="token operator">&lt;</span> l3<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>l1<span class="token punctuation">,</span> l3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>l3<span class="token punctuation">.</span>second <span class="token operator">-</span> l2<span class="token punctuation">.</span>second<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>l2<span class="token punctuation">.</span>first <span class="token operator">-</span> l1<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token punctuation">(</span>l2<span class="token punctuation">.</span>second <span class="token operator">-</span> l1<span class="token punctuation">.</span>second<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>l3<span class="token punctuation">.</span>first <span class="token operator">-</span> l2<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>T a<span class="token punctuation">,</span> T b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      P <span class="token function">line</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span> <span class="token operator">+</span> head <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>lines<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lines<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span> lines<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lines<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> T x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">*</span> x <span class="token operator">+</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   T <span class="token function">f</span><span class="token punctuation">(</span>P line<span class="token punctuation">,</span> T x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> line<span class="token punctuation">.</span>first <span class="token operator">*</span> x <span class="token operator">+</span> line<span class="token punctuation">.</span>second<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   T <span class="token function">get</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>isMonotonicX<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span> <span class="token operator">+</span> head <span class="token operator">&amp;&amp;</span> <span class="token function">comp</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>head <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>head<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> high <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">+</span> low<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">(</span><span class="token function">comp</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> low <span class="token operator">:</span> high<span class="token punctuation">)</span> <span class="token operator">=</span> mid<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="disjoint_sparse_table.hpp">disjoint_sparse_table.hpp</h2>
        md5: 3df31b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">SG</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">disjoint_sparse_table</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> S <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span>S<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>S<span class="token operator">>></span> st<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> lg<span class="token punctuation">;</span>

   <span class="token function">disjoint_sparse_table</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> b<span class="token operator">++</span><span class="token punctuation">;</span>
      st<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> shift <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>j <span class="token operator">+</span> shift<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> t <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> k <span class="token operator">>=</span> j<span class="token punctuation">;</span> k<span class="token operator">--</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> t<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> t <span class="token operator">+</span> shift<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      lg<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>lg<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> lg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> lg<span class="token punctuation">[</span>i <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">>=</span> <span class="token operator">--</span>r<span class="token punctuation">)</span> <span class="token keyword">return</span> st<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> b <span class="token operator">=</span> lg<span class="token punctuation">[</span>l <span class="token operator">^</span> r<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> st<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="lazy_segtree.hpp">lazy_segtree.hpp</h2>
        md5: caadbe

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: aa9fd6</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">unsigned</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> x <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">__builtin_ctz</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> <span class="token function">countr_zero_constexpr</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> x<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>op<span class="token punctuation">)</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>mapping<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>composition<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> F<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>id<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">lazy_segtree</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      log <span class="token operator">=</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      d <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> size<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lz <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>F<span class="token operator">></span></span></span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> d<span class="token punctuation">[</span>size <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      d<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> log<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> d<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      S sml <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> smr <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> sml <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> smr <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token operator">--</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l2 <span class="token operator">=</span> l<span class="token punctuation">,</span> r2 <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">all_apply</span><span class="token punctuation">(</span>l<span class="token operator">++</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token operator">--</span>r<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         l <span class="token operator">=</span> l2<span class="token punctuation">;</span>
         r <span class="token operator">=</span> r2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> log<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">G</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">max_right</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> G g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> _n<span class="token punctuation">)</span> <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token function">push</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
               l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  l<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> l <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token operator">-</span>l<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// d93691</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">G</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">min_left</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> G g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         r<span class="token operator">--</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>r <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token function">push</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
               r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  r<span class="token operator">--</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token operator">-</span>r<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// c9a7eb</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">,</span> size<span class="token punctuation">,</span> log<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> d<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>F<span class="token operator">></span> lz<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> d<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k<span class="token punctuation">,</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="li_chao.hpp">li_chao.hpp</h2>
        md5: 08f964

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">LiChaoTree</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n<span class="token punctuation">,</span> sz<span class="token punctuation">,</span> height<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> xs<span class="token punctuation">,</span> as<span class="token punctuation">,</span> bs<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>T a<span class="token punctuation">,</span> T b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;&lt;</span> h<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>sz <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> r <span class="token operator">=</span> l <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
         T xl <span class="token operator">=</span> xs<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> xm <span class="token operator">=</span> xs<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">bool</span> l_update <span class="token operator">=</span> a <span class="token operator">*</span> xl <span class="token operator">+</span> b <span class="token operator">&lt;</span> as<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> xl <span class="token operator">+</span> bs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">bool</span> m_update <span class="token operator">=</span> a <span class="token operator">*</span> xm <span class="token operator">+</span> b <span class="token operator">&lt;</span> as<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> xm <span class="token operator">+</span> bs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>m_update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">swap</span><span class="token punctuation">(</span>as<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">swap</span><span class="token punctuation">(</span>bs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>h <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>l_update <span class="token operator">!=</span> m_update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
            r <span class="token operator">=</span> m<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            k <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            l <span class="token operator">=</span> m<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         h<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token comment">// 最小値クエリのx座標や線分追加クエリの両端のx座標を先読みしてソートした配列</span>
   <span class="token function">LiChaoTree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> xs<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">n</span><span class="token punctuation">(</span>xs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">xs</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sz <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>sz <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>xs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         sz <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         height<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token operator">-></span>xs<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>sz<span class="token punctuation">,</span> xs<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      as<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>sz <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bs<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>sz <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_line</span><span class="token punctuation">(</span>T a<span class="token punctuation">,</span> T b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_segment</span><span class="token punctuation">(</span>T a<span class="token punctuation">,</span> T b<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      l <span class="token operator">+=</span> sz<span class="token punctuation">,</span> r <span class="token operator">+=</span> sz<span class="token punctuation">;</span>
      <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> l<span class="token operator">++</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">--</span>r<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
         l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">,</span> h<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// x = xs[i] における最小値を求める</span>
   T <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      T x <span class="token operator">=</span> xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> i <span class="token operator">+</span> sz<span class="token punctuation">;</span>
      T res <span class="token operator">=</span> as<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> x <span class="token operator">+</span> bs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         k <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         T tmp <span class="token operator">=</span> as<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> x <span class="token operator">+</span> bs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>tmp <span class="token operator">&lt;</span> res<span class="token punctuation">)</span> res <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="persistent-array.hpp">persistent-array.hpp</h2>
        md5: bb60a8

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">int</span> LOG<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">PersistentArray</span> <span class="token punctuation">{</span>
   <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
      T data<span class="token punctuation">;</span>
      Node<span class="token operator">*</span> child<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOG<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token function">Node</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   Node<span class="token operator">*</span> root<span class="token punctuation">;</span>
   <span class="token function">PersistentArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   T <span class="token function">get</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token operator">-></span>data<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span>t<span class="token operator">-></span>child<span class="token punctuation">[</span>k <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOG<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k <span class="token operator">>></span> LOG<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   pair<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">></span> <span class="token function">mutable_get</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      t <span class="token operator">=</span> t <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span><span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>t<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token operator">-></span>data<span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> p <span class="token operator">=</span> <span class="token function">mutable_get</span><span class="token punctuation">(</span>t<span class="token operator">-></span>child<span class="token punctuation">[</span>k <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOG<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k <span class="token operator">>></span> LOG<span class="token punctuation">)</span><span class="token punctuation">;</span>
      t<span class="token operator">-></span>child<span class="token punctuation">[</span>k <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOG<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>t<span class="token punctuation">,</span> p<span class="token punctuation">.</span>second<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T<span class="token operator">*</span> <span class="token function">mutable_get</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> ret <span class="token operator">=</span> <span class="token function">mutable_get</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> ret<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Node<span class="token operator">*</span> <span class="token function">build</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> t<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> data<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token punctuation">)</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         t<span class="token operator">-></span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
         <span class="token keyword">return</span> t<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">auto</span> p <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>t<span class="token operator">-></span>child<span class="token punctuation">[</span>k <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOG<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> k <span class="token operator">>></span> LOG<span class="token punctuation">)</span><span class="token punctuation">;</span>
      t<span class="token operator">-></span>child<span class="token punctuation">[</span>k <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> LOG<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>
      <span class="token keyword">return</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">build</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="persistent-segtree.hpp">persistent-segtree.hpp</h2>
        md5: b2594f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Monoid</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">PersistentSegmentTree</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> F <span class="token operator">=</span> function<span class="token operator">&lt;</span><span class="token function">Monoid</span><span class="token punctuation">(</span>Monoid<span class="token punctuation">,</span> Monoid<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">;</span>

   <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
      Monoid data<span class="token punctuation">;</span>
      Node <span class="token operator">*</span>l<span class="token punctuation">,</span> <span class="token operator">*</span>r<span class="token punctuation">;</span>

      <span class="token function">Node</span><span class="token punctuation">(</span><span class="token keyword">const</span> Monoid<span class="token operator">&amp;</span> data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">l</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">int</span> sz<span class="token punctuation">;</span>
   <span class="token keyword">const</span> F f<span class="token punctuation">;</span>
   <span class="token keyword">const</span> Monoid M1<span class="token punctuation">;</span>

   <span class="token function">PersistentSegmentTree</span><span class="token punctuation">(</span><span class="token keyword">const</span> F f<span class="token punctuation">,</span> <span class="token keyword">const</span> Monoid<span class="token operator">&amp;</span> M1<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">M1</span><span class="token punctuation">(</span>M1<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   Node<span class="token operator">*</span> <span class="token function">build</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Monoid<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Node<span class="token operator">*</span> <span class="token function">merge</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> l<span class="token punctuation">,</span> Node<span class="token operator">*</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>l<span class="token operator">-></span>data<span class="token punctuation">,</span> r<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      t<span class="token operator">-></span>l <span class="token operator">=</span> l<span class="token punctuation">;</span>
      t<span class="token operator">-></span>r <span class="token operator">=</span> r<span class="token punctuation">;</span>
      <span class="token keyword">return</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Node<span class="token operator">*</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Monoid<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">build</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Node<span class="token operator">*</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Monoid<span class="token operator">&amp;</span> x<span class="token punctuation">,</span> Node<span class="token operator">*</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&lt;=</span> a <span class="token operator">||</span> a <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> l<span class="token punctuation">)</span> <span class="token keyword">return</span> k<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">update</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> x<span class="token punctuation">,</span> k<span class="token operator">-></span>l<span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">update</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> x<span class="token punctuation">,</span> k<span class="token operator">-></span>r<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Node<span class="token operator">*</span> <span class="token function">update</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">const</span> Monoid<span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   Monoid <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> Node<span class="token operator">*</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&lt;=</span> a <span class="token operator">||</span> b <span class="token operator">&lt;=</span> l<span class="token punctuation">)</span> <span class="token keyword">return</span> M1<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> k<span class="token operator">-></span>data<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">query</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> k<span class="token operator">-></span>l<span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">query</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> k<span class="token operator">-></span>r<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Monoid <span class="token function">query</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="persistent-uf.hpp">persistent-uf.hpp</h2>
        md5: 8d972c

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">PersistentUnionFind</span> <span class="token punctuation">{</span>
   PersistentArray<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">></span> data<span class="token punctuation">;</span>

   <span class="token function">PersistentUnionFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token function">PersistentUnionFind</span><span class="token punctuation">(</span><span class="token keyword">int</span> sz<span class="token punctuation">)</span> <span class="token punctuation">{</span> data<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>sz<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> p <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> p <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">:</span> k<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">-</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">unite</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      x <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      y <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> u <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> v <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">&lt;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> a <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">mutable_get</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token operator">*</span>a <span class="token operator">+=</span> v<span class="token punctuation">;</span>
         <span class="token keyword">auto</span> b <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">mutable_get</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token operator">*</span>b <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> a <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">mutable_get</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token operator">*</span>a <span class="token operator">+=</span> u<span class="token punctuation">;</span>
         <span class="token keyword">auto</span> b <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">mutable_get</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token operator">*</span>b <span class="token operator">=</span> y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="potential_dsu.hpp">potential_dsu.hpp</h2>
        md5: b2e5eb

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 650ffa</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Abel</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">potential_dsu</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> T <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span>T<span class="token punctuation">;</span>
   <span class="token keyword">int</span> tCount<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> p<span class="token punctuation">,</span> rank<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> potential<span class="token punctuation">;</span>
   <span class="token keyword">int</span> N<span class="token punctuation">;</span>
   <span class="token function">potential_dsu</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      N <span class="token operator">=</span> size<span class="token punctuation">;</span>
      p<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rank<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      potential<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      tCount <span class="token operator">=</span> N<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">leader</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leader</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">// w[y] - w[x] = w</span>
   <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> T w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      w <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">get_potential</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      w <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token function">get_potential</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">link</span><span class="token punctuation">(</span><span class="token function">leader</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">leader</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">leader</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span>
      <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      potential<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>potential<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> potential<span class="token punctuation">[</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">get_potential</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">leader</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> potential<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// w[y] - w[x]</span>
   T <span class="token function">diff</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">get_potential</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token function">get_potential</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> tCount<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 154012</span>

   <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token operator">-</span>p<span class="token punctuation">[</span><span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 818fe7</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">leader_buf</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">group_size</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         group_size<span class="token punctuation">[</span>leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">result</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>group_size<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">remove_if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 92d7ce</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> T w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      tCount<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>rank<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> rank<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
         w <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>rank<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> rank<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> rank<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      tCount<span class="token operator">--</span><span class="token punctuation">;</span>
      potential<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> w<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*
struct Abel {
   using T = int;
   static T e() { return 0; }
   static T op(T a, T b) { return a + b; }
   static T inv(T a) { return -a; }
};

potential_dsu&lt;Abel> dsu(N);
*/</span></code></pre>
</div>

    <div class="filename">
        <h2 id="range_set.hpp">range_set.hpp</h2>
        md5: 1bc645

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">bool</span> margeAdjacent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">range_set</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">map</span><span class="token operator">&lt;</span><span class="token class-name">ll</span><span class="token punctuation">,</span> <span class="token class-name">ll</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
   <span class="token keyword">auto</span> <span class="token function">get</span><span class="token punctuation">(</span>ll p<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> it <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>it <span class="token operator">==</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">--</span>it<span class="token punctuation">)</span><span class="token operator">-></span>second <span class="token operator">&lt;</span> p<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> it<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> itl <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> itr <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>r <span class="token operator">+</span> margeAdjacent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">!=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">--</span>itl<span class="token punctuation">)</span><span class="token operator">-></span>second <span class="token operator">&lt;</span> l <span class="token operator">-</span> margeAdjacent<span class="token punctuation">)</span> <span class="token operator">++</span>itl<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">!=</span> itr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         l <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> itl<span class="token operator">-></span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
         r <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token function">prev</span><span class="token punctuation">(</span>itr<span class="token punctuation">)</span><span class="token operator">-></span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">erase</span><span class="token punctuation">(</span>itl<span class="token punctuation">,</span> itr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> itl <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> itr <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">!=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">--</span>itl<span class="token punctuation">)</span><span class="token operator">-></span>second <span class="token operator">&lt;</span> l<span class="token punctuation">)</span> <span class="token operator">++</span>itl<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">==</span> itr<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> tl <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> itl<span class="token operator">-></span>first<span class="token punctuation">)</span><span class="token punctuation">,</span> tr <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token function">prev</span><span class="token punctuation">(</span>itr<span class="token punctuation">)</span><span class="token operator">-></span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">erase</span><span class="token punctuation">(</span>itl<span class="token punctuation">,</span> itr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>tl <span class="token operator">&lt;</span> l<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>tl<span class="token punctuation">]</span> <span class="token operator">=</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> tr<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span>ll p<span class="token punctuation">,</span> ll q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> it <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> it <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> it<span class="token operator">-></span>first <span class="token operator">&lt;=</span> q <span class="token operator">&amp;&amp;</span> q <span class="token operator">&lt;=</span> it<span class="token operator">-></span>second<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="range_tree.hpp">range_tree.hpp</h2>
        md5: 7f74d5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">M</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">range_tree</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> S <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span>S<span class="token punctuation">;</span>
   <span class="token keyword">using</span> D <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span>D<span class="token punctuation">;</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token operator">>></span> ps<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>K<span class="token operator">></span> xs<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>K<span class="token operator">>></span> ys<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>D<span class="token operator">></span> ds<span class="token punctuation">;</span>
   <span class="token keyword">int</span> n<span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span>K x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> xs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> K y<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span> ys<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>K x<span class="token punctuation">,</span> K y<span class="token punctuation">)</span> <span class="token punctuation">{</span> ps<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sort</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ps<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
      xs<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">:</span> ps<span class="token punctuation">)</span> xs<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ys<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ds<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ys<span class="token punctuation">[</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">}</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">[</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>K x<span class="token punctuation">,</span> K y<span class="token punctuation">,</span> S a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> ps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> n<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">apply</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
         k <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span>K x1<span class="token punctuation">,</span> K y1<span class="token punctuation">,</span> K x2<span class="token punctuation">,</span> K y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      a <span class="token operator">+=</span> n<span class="token punctuation">;</span>
      b <span class="token operator">+=</span> n<span class="token punctuation">;</span>
      S l <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            l <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">prod</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">++</span>a<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">--</span>b<span class="token punctuation">;</span>
            r <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">prod</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         a <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         b <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* 使い方

// モノイド
struct M {
   using S = ll;  // データ(モノイド)の型
   using D = BIT;  // ノードに持たせるデータ構造の型
   static S op(S a, S b) { return a + b; } // Sの二項演算
   static S e() { return 0; }  // Sの単位元
   static D init(int n) { return BIT(n); }  // Dを長さnで初期化する関数
   static void apply(D&amp; bit, int k, const S&amp; v) { bit.add(k, v); } // D のk番目に v を適用する関数
   static S prod(D&amp; bit, int l, int r) { return bit.sum(l, r); } // D の[l, r) に対するクエリを行う関数
};

rt.add(x, y): 座標 (x, y) を追加
rt.build(): クエリを受け付ける準備をする
rt.apply(x, y, a): 座標 (x, y) に a を適用
rt.prod(x1, y1, x2, y2): 座標 x \in [x1, x2), y \in [y1, y2) の領域にクエリを行う
*/</span></code></pre>
</div>

    <div class="filename">
        <h2 id="segtree.hpp">segtree.hpp</h2>
        md5: d32488

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: bafcf8</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">unsigned</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> x <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">__builtin_ctz</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> <span class="token function">countr_zero_constexpr</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> x<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>op<span class="token punctuation">)</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">segtree</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      log <span class="token operator">=</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      d <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> size<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> d<span class="token punctuation">[</span>size <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      d<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> log<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">[</span>p <span class="token operator">+</span> size<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      S sml <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> smr <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>

      <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> sml <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> smr <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token operator">--</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">all_prod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">F</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">max_right</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> _n<span class="token punctuation">)</span> <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  l<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> l <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token operator">-</span>l<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// faa03f</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">F</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">min_left</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         r<span class="token operator">--</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>r <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  r<span class="token operator">--</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token operator">-</span>r<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// efa466</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">,</span> size<span class="token punctuation">,</span> log<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> d<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="treap.hpp">treap.hpp</h2>
        md5: fd1c1c

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: c8a607</span>
<span class="token comment">// mmを使う場合, 追記が必要</span>
<span class="token comment">// friend bool operator==(const mm&amp; a, const mm&amp; b) { return a.x == b.x; }</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>op<span class="token punctuation">)</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>mapping<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> S<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>composition<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> F<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>id<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">Treap</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   mt19937_64 mt<span class="token punctuation">;</span>
   uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">></span> rand<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> value<span class="token punctuation">,</span> acc<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>F<span class="token operator">></span> lazy<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> priority<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> cnt<span class="token punctuation">,</span> lch<span class="token punctuation">,</span> rch<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> lazy_rev<span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token function">new_node</span><span class="token punctuation">(</span>S v<span class="token punctuation">,</span> ll p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      priority<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cnt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy_rev<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lch<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rch<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> cnt<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   S <span class="token function">get_acc</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> acc<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
      cnt<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">get_acc</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">op</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_acc</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">int</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lazy_rev<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         lazy_rev<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token function">swap</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> lazy_rev<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>lazy_rev<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> lazy_rev<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>lazy_rev<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazy<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> lazy<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            acc<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> acc<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazy<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> lazy<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            acc<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> acc<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         value<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">push</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> r<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> l<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>priority<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> priority<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         rch<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         lch<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> lch<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> implicit_key <span class="token operator">=</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> implicit_key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
         lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>first<span class="token punctuation">,</span> <span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> k <span class="token operator">-</span> implicit_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
         rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>first<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> lazy<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 905a19 (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">_erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 92ef20 (Common)</span>

   <span class="token keyword">int</span> <span class="token function">erase_range</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 77074b (Common)</span>

   pair<span class="token operator">&lt;</span>S<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S ret <span class="token operator">=</span> acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">//  fe8e6c (Common)</span>

   <span class="token keyword">int</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> S v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      value<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 31b211 (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">_find</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> S x<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">bool</span> left <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">get_acc</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">==</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">op</span><span class="token punctuation">(</span>acc<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token function">find</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token operator">?</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>
                                             <span class="token operator">:</span> <span class="token function">find</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">op</span><span class="token punctuation">(</span>acc<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token function">find</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token operator">?</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">find</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>  <span class="token comment">// b0c65b (Common)</span>

   <span class="token keyword">int</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy_rev<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>lazy_rev<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 3f67e3 (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      t <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      t <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">,</span> l <span class="token operator">+</span> r <span class="token operator">-</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">reverse</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l <span class="token operator">+</span> r <span class="token operator">-</span> m<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// a5a67c (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">lower_search</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t <span class="token operator">=</span> lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ret <span class="token operator">+=</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            t <span class="token operator">=</span> rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 0ef7d9 (Ordered)</span>

   <span class="token keyword">int</span> <span class="token function">upper_search</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t <span class="token operator">=</span> lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ret <span class="token operator">+=</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            t <span class="token operator">=</span> rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// f91898 (Ordered)</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">Treap</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>S<span class="token operator">></span> V<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mt <span class="token operator">=</span> <span class="token function">mt19937_64</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">time_since_epoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rand <span class="token operator">=</span> <span class="token generic-function"><span class="token function">uniform_int_distribution</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1e18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> V<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">size_t</span><span class="token punctuation">(</span><span class="token function">get_cnt</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// f63788 (Common)</span>

   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> ind<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> ind<span class="token punctuation">,</span> <span class="token function">new_node</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// dc467c (UnOrdered)</span>

   <span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">new_node</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 7fa616 (Unordered)</span>

   <span class="token keyword">void</span> <span class="token function">ordered_insert</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ind <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>ind<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 539d77 (Ordered)</span>

   <span class="token comment">// Count elements in [lower, upper)</span>
   <span class="token keyword">int</span> <span class="token function">value_range_cnt</span><span class="token punctuation">(</span>S lower<span class="token punctuation">,</span> S upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lower<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> R <span class="token operator">-</span> L<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 2d4406 (Ordered)</span>

   <span class="token comment">// Sum of elements in [lower, upper)</span>
   S <span class="token function">value_range_prod</span><span class="token punctuation">(</span>S lower<span class="token punctuation">,</span> S upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lower<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>L <span class="token operator">==</span> R<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 27b9d4 (Ordered)</span>

   <span class="token comment">// erase element x cnt times (cnt = -1 -> erase all x)</span>
   <span class="token keyword">int</span> <span class="token function">erase_value</span><span class="token punctuation">(</span>S x<span class="token punctuation">,</span> <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">upper_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">chmin</span><span class="token punctuation">(</span>R<span class="token punctuation">,</span> L <span class="token operator">+</span> cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">erase_range</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> R <span class="token operator">-</span> L<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 5c60fd (Ordered)</span>

   <span class="token keyword">int</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 9731cc (Ordered)</span>

   <span class="token keyword">int</span> <span class="token function">upper_search</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">upper_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// ac5aa0 (Ordered)</span>

   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">apply</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 905a19 (Unordered)</span>

   <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> ind<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">_erase</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> ind<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// ff257f (Common)</span>

   <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// f9ff4a (Common)</span>

   <span class="token comment">// l .. r-1 -> r-1 .. l</span>
   <span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 40df7d (Unordered)</span>

   <span class="token comment">// l .. m-1, m .. r-1 -> m .. r-1, l .. m-1</span>
   <span class="token keyword">void</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">rotate</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// e21b85 (Unordered)</span>

   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> S v<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">set</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 4ae943 (Unordered)</span>

   <span class="token comment">// min k \in [l,r) such that op(tr[k], x) != x</span>
   <span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> S x<span class="token punctuation">,</span> <span class="token keyword">bool</span> left <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">_find</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> l<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> ret <span class="token operator">=</span> r<span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 4f1699 (Common)</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">S</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t<span class="token punctuation">,</span> rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> rt<span class="token punctuation">;</span>
      <span class="token keyword">return</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// c46ac4 (Common)</span>

   S <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> ind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> ind <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> ind<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S ret <span class="token operator">=</span> acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// d2546e (Common)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="undo_dsu.hpp">undo_dsu.hpp</h2>
        md5: f5d93b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: edf246</span>
<span class="token keyword">struct</span> <span class="token class-name">undo_dsu</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> p<span class="token punctuation">;</span>
   stack<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> history<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">undo_dsu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">undo_dsu</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">p</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= b &amp;&amp; b &lt; _n);</span>
      <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= b &amp;&amp; b &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">leader</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> a <span class="token operator">=</span> p<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p<span class="token punctuation">[</span>history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span> <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span> <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token keyword">int</span> snapshot <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> snapshot<span class="token punctuation">)</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token operator">-</span>p<span class="token punctuation">[</span><span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 818fe7</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="wavelet_matrix.hpp">wavelet_matrix.hpp</h2>
        md5: 208fa9

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: be292e</span>
<span class="token keyword">struct</span> <span class="token class-name">BitVector</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> vec<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">BitVector</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vec<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> vec<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> vec<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> vec<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> i <span class="token operator">-</span> vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">return</span> vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">int</span> bit_len <span class="token operator">=</span> <span class="token number">62</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">WaveletMatrix</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>BitVector<span class="token operator">></span> B<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span> acc<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> so<span class="token punctuation">;</span>
   map<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> sn<span class="token punctuation">;</span>
   <span class="token keyword">int</span> len<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">WaveletMatrix</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>T<span class="token operator">></span> vec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      len <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span></span></span><span class="token punctuation">(</span>bit_len<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      so <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>bit_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">v</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token generic-function"><span class="token function">b</span> <span class="token generic class-name"><span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         vector<span class="token operator">&lt;</span>T<span class="token operator">></span> cur<span class="token punctuation">;</span>
         cur<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
         vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">bi</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ll bit <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span></span></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>bit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               cur<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               bi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         so<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ll bit <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>bit <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               cur<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               bi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         B<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">BitVector</span><span class="token punctuation">(</span>bi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>B<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> acc<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            acc<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> acc<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         v <span class="token operator">=</span> cur<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> sn<span class="token punctuation">[</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   T <span class="token function">access</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> bit <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ret <span class="token operator">=</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> bit<span class="token punctuation">;</span>
         i <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> bit<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 3be264</span>

   <span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>sn<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> bit <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         i <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> bit<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> i <span class="token operator">-</span> sn<span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 88f41a</span>

   T <span class="token function">kthMin</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> cnt <span class="token operator">=</span> r <span class="token operator">-</span> l<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> l<span class="token punctuation">;</span>
            right <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            k <span class="token operator">-=</span> cnt<span class="token punctuation">;</span>
            left <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">;</span>
            right <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>
            ret <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 941aa0</span>

   T <span class="token function">kMinSum</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> cnt <span class="token operator">=</span> r <span class="token operator">-</span> l<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> l<span class="token punctuation">;</span>
            right <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            k <span class="token operator">-=</span> cnt<span class="token punctuation">;</span>
            ret <span class="token operator">+=</span> acc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> acc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>
            left <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">;</span>
            right <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// edb4f5</span>

   <span class="token keyword">int</span> <span class="token function">lessCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> T upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>upper <span class="token operator">>=</span> <span class="token punctuation">(</span><span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> bit_len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> cnt <span class="token operator">=</span> r <span class="token operator">-</span> l<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>upper <span class="token operator">>></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ret <span class="token operator">+=</span> cnt<span class="token punctuation">;</span>
            left <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">;</span>
            right <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> l<span class="token punctuation">;</span>
            right <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 029c6d</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="math">math</h2>

    <div class="filename">
        <h2 id="BinaryGCD.hpp">BinaryGCD.hpp</h2>
        md5: f3ab31

    </div>
    <div class="content content-hpp">
    <pre><code>u64 <span class="token function">ctz</span><span class="token punctuation">(</span>u64 x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
u64 <span class="token function">binary_gcd</span><span class="token punctuation">(</span>u64 x<span class="token punctuation">,</span> u64 y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>x <span class="token operator">||</span> <span class="token operator">!</span>y<span class="token punctuation">)</span> <span class="token keyword">return</span> x <span class="token operator">|</span> y<span class="token punctuation">;</span>
   u64 n <span class="token operator">=</span> <span class="token function">ctz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token function">ctz</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
   x <span class="token operator">>>=</span> n<span class="token punctuation">,</span> y <span class="token operator">>>=</span> m<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">></span> y<span class="token punctuation">)</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token function">ctz</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> y <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token function">ctz</span><span class="token punctuation">(</span>y <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> x <span class="token operator">&lt;&lt;</span> <span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="ExtGCD.hpp">ExtGCD.hpp</h2>
        md5: c3fa9b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// returns gcd(a, b) and assign x, y to integers</span>
<span class="token comment">// s.t. ax + by = gcd(a, b) and |x| + |y| is minimized</span>
ll <span class="token function">extgcd</span><span class="token punctuation">(</span>ll a<span class="token punctuation">,</span> ll b<span class="token punctuation">,</span> ll<span class="token operator">&amp;</span> x<span class="token punctuation">,</span> ll<span class="token operator">&amp;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// assert(a >= 0 &amp;&amp; b >= 0);</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token keyword">return</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">;</span>
   ll d <span class="token operator">=</span> <span class="token function">extgcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   y <span class="token operator">-=</span> a <span class="token operator">/</span> b <span class="token operator">*</span> x<span class="token punctuation">;</span>
   <span class="token keyword">return</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="combination.hpp">combination.hpp</h2>
        md5: 5a309a

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">Combination</span> <span class="token punctuation">{</span>
   ll C_MOD<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> fac<span class="token punctuation">,</span> finv<span class="token punctuation">,</span> inv<span class="token punctuation">;</span>
   <span class="token function">Combination</span><span class="token punctuation">(</span>ll n<span class="token punctuation">,</span> ll mod<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">C_MOD</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">2LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fac<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      finv<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      inv<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fac<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> fac<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> finv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> finv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> inv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         fac<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> fac<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> i <span class="token operator">%</span> mod<span class="token punctuation">;</span>
         inv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mod <span class="token operator">-</span> inv<span class="token punctuation">[</span>mod <span class="token operator">%</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>mod <span class="token operator">/</span> i<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
         finv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> finv<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> inv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">com</span><span class="token punctuation">(</span>ll n<span class="token punctuation">,</span> ll k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;</span> k <span class="token operator">||</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> k <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> fac<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>finv<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> finv<span class="token punctuation">[</span>n <span class="token operator">-</span> k<span class="token punctuation">]</span> <span class="token operator">%</span> C_MOD<span class="token punctuation">)</span> <span class="token operator">%</span> C_MOD<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="crt.hpp">crt.hpp</h2>
        md5: 338cb4

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// mが互いに素になるように前処理</span>
<span class="token comment">// lcm(m) % MODを返す</span>
<span class="token comment">// crtの解がなければ-1を返す</span>
ll <span class="token function">pre_garner</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> b<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> m<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll res <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ll g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> g <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/=</span> g<span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/=</span> g<span class="token punctuation">;</span>
         ll gi <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ll gj <span class="token operator">=</span> g <span class="token operator">/</span> gi<span class="token punctuation">;</span>
         <span class="token keyword">do</span> <span class="token punctuation">{</span>
            g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span>gi<span class="token punctuation">,</span> gj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            gi <span class="token operator">*=</span> g<span class="token punctuation">;</span>
            gj <span class="token operator">/=</span> g<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> gi<span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*=</span> gj<span class="token punctuation">;</span>
         b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         b<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>res <span class="token operator">*=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// m が互いに素であることが保証されている場合</span>
<span class="token comment">// b[i] = x (mod m[i]) となる最小の x \le 0 を求める</span>
ll <span class="token function">garner</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> b<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> m<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   m<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>MOD<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">coeffs</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">constants</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">-</span> constants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">modinv</span><span class="token punctuation">(</span>coeffs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> t <span class="token operator">+=</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token punctuation">(</span>constants<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> t <span class="token operator">*</span> coeffs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">(</span>coeffs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> constants<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="floor_sum.hpp">floor_sum.hpp</h2>
        md5: 0f7242

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">floor_sum</span><span class="token punctuation">(</span><span class="token keyword">const</span> ll<span class="token operator">&amp;</span> n<span class="token punctuation">,</span> <span class="token keyword">const</span> ll<span class="token operator">&amp;</span> m<span class="token punctuation">,</span> ll a<span class="token punctuation">,</span> ll b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">>=</span> m<span class="token punctuation">)</span> ret <span class="token operator">+=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">/</span> m<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> a <span class="token operator">%=</span> m<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">>=</span> m<span class="token punctuation">)</span> ret <span class="token operator">+=</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>b <span class="token operator">/</span> m<span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">%=</span> m<span class="token punctuation">;</span>
   ll y <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> n <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">/</span> m<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   ll x <span class="token operator">=</span> y <span class="token operator">*</span> m <span class="token operator">-</span> b<span class="token punctuation">;</span>
   ret <span class="token operator">+=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">;</span>
   ret <span class="token operator">+=</span> <span class="token function">floor_sum</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> a<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> x <span class="token operator">%</span> a<span class="token punctuation">)</span> <span class="token operator">%</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="fwt.hpp">fwt.hpp</h2>
        md5: b24224

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">fwt</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            T x <span class="token operator">=</span> f<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> f<span class="token punctuation">[</span>j <span class="token operator">|</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            f<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">,</span> f<span class="token punctuation">[</span>j <span class="token operator">|</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="lagrange_polynomial.hpp">lagrange_polynomial.hpp</h2>
        md5: 5e6e39

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> T <span class="token function">lagrange_polynomial</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> y<span class="token punctuation">,</span> ll t<span class="token punctuation">,</span> ll mod <span class="token operator">=</span> <span class="token number">1000000007</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> <span class="token keyword">return</span> y<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
   T <span class="token function">ret</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   Combination <span class="token function">comb</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">dp</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pd</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> dp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> pd<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T tmp <span class="token operator">=</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> pd<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> comb<span class="token punctuation">.</span>finv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> comb<span class="token punctuation">.</span>finv<span class="token punctuation">[</span>n <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      ret <span class="token operator">-=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">?</span> tmp <span class="token operator">:</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="min_of_mod_of_linear.hpp">min_of_mod_of_linear.hpp</h2>
        md5: 30d270

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// depends on floor_sum</span>
ll <span class="token function">min_of_mod_of_linear</span><span class="token punctuation">(</span>ll n<span class="token punctuation">,</span> ll m<span class="token punctuation">,</span> ll a<span class="token punctuation">,</span> ll b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll fsum <span class="token operator">=</span> <span class="token function">floor_sum</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ll le <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> ri <span class="token operator">=</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>ri <span class="token operator">-</span> le <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll mid <span class="token operator">=</span> <span class="token punctuation">(</span>le <span class="token operator">+</span> ri<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">floor_sum</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">+</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> fsum <span class="token operator">+</span> n<span class="token punctuation">)</span> ri <span class="token operator">=</span> mid<span class="token punctuation">;</span>
      <span class="token keyword">else</span> le <span class="token operator">=</span> mid<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ri<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="modinv.hpp">modinv.hpp</h2>
        md5: a0de19

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">modinv</span><span class="token punctuation">(</span>ll a<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll b <span class="token operator">=</span> MOD<span class="token punctuation">,</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll t <span class="token operator">=</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
      a <span class="token operator">-=</span> t <span class="token operator">*</span> b<span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      u <span class="token operator">-=</span> t <span class="token operator">*</span> v<span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   u <span class="token operator">%=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> u <span class="token operator">+=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">return</span> u<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="modlog.hpp">modlog.hpp</h2>
        md5: 74b856

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// depends on modpow and modinv</span>
<span class="token comment">// a^x ≡ b (mod. m) となる最小の正の整数 x を求める</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token function">modlog</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> a<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a <span class="token operator">%=</span> m<span class="token punctuation">,</span> b <span class="token operator">%=</span> m<span class="token punctuation">;</span>

   <span class="token comment">// calc sqrt{M}</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> le <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> ri <span class="token operator">=</span> m<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>ri <span class="token operator">-</span> le <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">long</span> <span class="token keyword">long</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>le <span class="token operator">+</span> ri<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>mid <span class="token operator">*</span> mid <span class="token operator">>=</span> m<span class="token punctuation">)</span> ri <span class="token operator">=</span> mid<span class="token punctuation">;</span>
      <span class="token keyword">else</span> le <span class="token operator">=</span> mid<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> sqrtM <span class="token operator">=</span> ri<span class="token punctuation">;</span>

   <span class="token comment">// {a^0, a^1, a^2, ..., a^sqrt(m)}</span>
   map<span class="token operator">&lt;</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token operator">></span> apow<span class="token punctuation">;</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> r <span class="token operator">=</span> a<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sqrtM<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>apow<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> apow<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token punctuation">(</span>r <span class="token operator">*=</span> a<span class="token punctuation">)</span> <span class="token operator">%=</span> m<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// check each A^p</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> A <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span><span class="token function">modinv</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">,</span> sqrtM<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
   r <span class="token operator">=</span> b<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> q <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> q <span class="token operator">&lt;</span> sqrtM<span class="token punctuation">;</span> <span class="token operator">++</span>q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> q <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> q <span class="token operator">*</span> sqrtM<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>apow<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> q <span class="token operator">*</span> sqrtM <span class="token operator">+</span> apow<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">(</span>r <span class="token operator">*=</span> A<span class="token punctuation">)</span> <span class="token operator">%=</span> m<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// no solutions</span>
   <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="modsqrt.hpp">modsqrt.hpp</h2>
        md5: bf9df0

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">int</span> <span class="token function">Legendre</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> a<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> ret <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token function">modsqrt</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> n<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">long</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> Q <span class="token operator">=</span> p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> S <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>Q <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">++</span>S<span class="token punctuation">;</span>
      Q <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>S <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">modpow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   default_random_engine generator<span class="token punctuation">;</span>
   uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token operator">></span> <span class="token function">distribution</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> z <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">Legendre</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> z <span class="token operator">=</span> <span class="token function">distribution</span><span class="token punctuation">(</span>generator<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> c <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> Q<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> R <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token punctuation">(</span>Q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> t <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> Q<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> <span class="token keyword">long</span> M <span class="token operator">=</span> S<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">long</span> <span class="token keyword">long</span> i<span class="token punctuation">;</span>
      <span class="token keyword">long</span> <span class="token keyword">long</span> t2 <span class="token operator">=</span> t<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         t2 <span class="token operator">=</span> t2 <span class="token operator">*</span> t2 <span class="token operator">%</span> p<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>t2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">long</span> <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>M <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      R <span class="token operator">=</span> R <span class="token operator">*</span> b <span class="token operator">%</span> p<span class="token punctuation">;</span>
      t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> b <span class="token operator">%</span> p<span class="token punctuation">)</span> <span class="token operator">*</span> b <span class="token operator">%</span> p<span class="token punctuation">;</span>
      c <span class="token operator">=</span> b <span class="token operator">*</span> b <span class="token operator">%</span> p<span class="token punctuation">;</span>
      M <span class="token operator">=</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> R<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="primality.hpp">primality.hpp</h2>
        md5: d6eb6a

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">bool</span> <span class="token function">is_prime</span><span class="token punctuation">(</span>ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> N <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   ll s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   ll d <span class="token operator">=</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>d <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      s<span class="token operator">++</span><span class="token punctuation">;</span>
      d <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> tests <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> a <span class="token operator">:</span> tests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">==</span> N<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      ll X <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> d<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>X <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>X <span class="token operator">!=</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         X <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
         r<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>X <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> r <span class="token operator">==</span> s<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="primitive-root.hpp">primitive-root.hpp</h2>
        md5: a7c93d

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// depends on modpow</span>
<span class="token keyword">int</span> <span class="token function">primitive_root</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">167772161</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">469762049</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">754974721</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">11</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token operator">==</span> <span class="token number">998244353</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> divs<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   divs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> x <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">*</span>i <span class="token operator">&lt;=</span> x<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         divs<span class="token punctuation">[</span>cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> x <span class="token operator">/=</span> i<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> divs<span class="token punctuation">[</span>cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> g <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">;</span> g<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">bool</span> ok <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">modpow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ok <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token keyword">return</span> g<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="rho.hpp">rho.hpp</h2>
        md5: 820144

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">find_prime_factor</span><span class="token punctuation">(</span>ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> i128 <span class="token operator">=</span> __int128_t<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>ll c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ll a<span class="token punctuation">)</span> <span class="token operator">-></span> ll <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">modpow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">+</span> c<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      ll y <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
      ll g <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      i128 q <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      ll ys <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      ll x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         x <span class="token operator">=</span> y<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">*</span> r <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            k<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> r <span class="token operator">&amp;&amp;</span> g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ys <span class="token operator">=</span> y<span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">min</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> r <span class="token operator">-</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
               q <span class="token operator">*=</span> <span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
               q <span class="token operator">%=</span> N<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token function">ll</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
            k <span class="token operator">+=</span> b<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         k <span class="token operator">=</span> r<span class="token punctuation">;</span>
         r <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>g <span class="token operator">==</span> N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         g <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         y <span class="token operator">=</span> ys<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>g <span class="token operator">==</span> N<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_prime</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> g<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_prime</span><span class="token punctuation">(</span>N <span class="token operator">/</span> g<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> N <span class="token operator">/</span> g<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">find_prime_factor</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">factorize</span><span class="token punctuation">(</span>ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> ret<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_prime</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> N <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll p <span class="token operator">=</span> <span class="token function">find_prime_factor</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>N <span class="token operator">%</span> p <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         N <span class="token operator">/=</span> p<span class="token punctuation">;</span>
         s<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      ret<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ret<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <h2 class="section" id="modint">modint</h2>

    <div class="filename">
        <h2 id="BarrettReduction.hpp">BarrettReduction.hpp</h2>
        md5: 2ca7f3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// using u64 = uint64_t;</span>
<span class="token keyword">struct</span> <span class="token class-name">Barrett</span> <span class="token punctuation">{</span>  <span class="token comment">// mod &lt; 2^32</span>
   u64 m<span class="token punctuation">,</span> im<span class="token punctuation">;</span>
   <span class="token function">Barrett</span><span class="token punctuation">(</span>u64 mod<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">im</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1ULL</span> <span class="token operator">/</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token comment">// input: a * b &lt; 2^64, output: a * b % mod</span>
   u64 <span class="token function">mul</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      a <span class="token operator">*=</span> b<span class="token punctuation">;</span>
      u64 x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__uint128_t<span class="token punctuation">)</span>a <span class="token operator">*</span> im<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">64</span><span class="token punctuation">;</span>
      a <span class="token operator">-=</span> x <span class="token operator">*</span> m<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span>a <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> a <span class="token operator">+=</span> m<span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="modint.hpp">modint.hpp</h2>
        md5: eb2b53

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">const</span> ll mod <span class="token operator">=</span> <span class="token number">998244353</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">mm</span> <span class="token punctuation">{</span>
   ll x<span class="token punctuation">;</span>
   <span class="token function">mm</span><span class="token punctuation">(</span>ll x_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>x_ <span class="token operator">%</span> mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> x <span class="token operator">+=</span> mod<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span>mm a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">-</span>a<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">/</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 4 行コピペ  Alt + Shift + クリックで複数カーソル</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">-=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">/=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   mm <span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   mm <span class="token function">pow</span><span class="token punctuation">(</span>ll b<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      mm a <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> c <span class="token operator">*=</span> a<span class="token punctuation">;</span>
         a <span class="token operator">*=</span> a<span class="token punctuation">;</span>
         b <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> c<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <h2 class="section" id="FPS">FPS</h2>

    <div class="filename">
        <h2 id="FFT.hpp">FFT.hpp</h2>
        md5: 6e60c3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// {998244353, 3}, {1811939329, 13}, {2013265921, 31}</span>
mm g <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// 原始根</span>
<span class="token keyword">void</span> <span class="token function">fft</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> lg <span class="token operator">=</span> <span class="token function">__lg</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> lg<span class="token punctuation">)</span> <span class="token operator">==</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">b</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> l <span class="token operator">&lt;=</span> lg<span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll w <span class="token operator">=</span> n <span class="token operator">>></span> l<span class="token punctuation">;</span>
      mm s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">>></span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>ll u <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> u <span class="token operator">&lt;</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> u <span class="token operator">+=</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> d <span class="token operator">&lt;</span> w<span class="token punctuation">;</span> d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mm x <span class="token operator">=</span> a<span class="token punctuation">[</span>u <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> d<span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> a<span class="token punctuation">[</span>u <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> w <span class="token operator">|</span> d<span class="token punctuation">]</span> <span class="token operator">*</span> s<span class="token punctuation">;</span>
            b<span class="token punctuation">[</span>u <span class="token operator">|</span> d<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
            b<span class="token punctuation">[</span>n <span class="token operator">>></span> <span class="token number">1</span> <span class="token operator">|</span> u <span class="token operator">|</span> d<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         s <span class="token operator">*=</span> r<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">conv</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> a<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> b<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   size_t s <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// if(min(sz(a), sz(b)) &lt;= 60) 愚直に掛け算</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   b<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   mm inv <span class="token operator">=</span> <span class="token function">mm</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> inv<span class="token punctuation">;</span>
   <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token function">all</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="barlekamp_massey.hpp">barlekamp_massey.hpp</h2>
        md5: 50177f

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">BerlekampMassey</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token operator">&amp;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> b<span class="token punctuation">,</span> c<span class="token punctuation">;</span>
   b<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   c<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   b<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   c<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   mm y <span class="token operator">=</span> <span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> ed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> ed <span class="token operator">&lt;=</span> N<span class="token punctuation">;</span> ed<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mm x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> x <span class="token operator">+=</span> c<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> s<span class="token punctuation">[</span>ed <span class="token operator">-</span> l <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      b<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      m<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      mm freq <span class="token operator">=</span> x <span class="token operator">/</span> y<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> tmp <span class="token operator">=</span> c<span class="token punctuation">;</span>
         c<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">-</span> l<span class="token punctuation">,</span> <span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> c<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">-=</span> freq <span class="token operator">*</span> b<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         b <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
         y <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> c<span class="token punctuation">[</span>l <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">-=</span> freq <span class="token operator">*</span> b<span class="token punctuation">[</span>m <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="bostan_mori.hpp">bostan_mori.hpp</h2>
        md5: dbb7af

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// find [x^N] P(x)/Q(x), O(K log K log N)</span>
<span class="token comment">// deg(Q(x)) = K, deg(P(x)) &lt; K, Q[0] = 1</span>
mm <span class="token function">BostanMori</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> P<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> Q<span class="token punctuation">,</span> ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token keyword">int</span> d <span class="token operator">=</span> Q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> N<span class="token punctuation">;</span> N <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> Q_neg <span class="token operator">=</span> Q<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> Q_neg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      P <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>P<span class="token punctuation">,</span> Q_neg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Q <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span> Q_neg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> N <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> P<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> P<span class="token punctuation">[</span>i <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> P<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> Q<span class="token punctuation">[</span>i <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      P<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>d <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Q<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> P<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="fps.hpp">fps.hpp</h2>
        md5: 930ad2

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">using</span> vm <span class="token operator">=</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token punctuation">;</span>
vm <span class="token function">pre</span><span class="token punctuation">(</span>vm f<span class="token punctuation">,</span> <span class="token keyword">int</span> sz<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">vm</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
vm <span class="token function">inv</span><span class="token punctuation">(</span>vm f<span class="token punctuation">,</span> <span class="token keyword">int</span> deg <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>deg <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> deg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deg<span class="token punctuation">;</span> i <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm ff <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">conv</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">pre</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> sz <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sz<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> res<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> res<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      sz <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>sz<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>sz<span class="token punctuation">)</span><span class="token punctuation">;</span>
      sz <span class="token operator">=</span> ff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sz<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> res<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-=</span> ff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      res <span class="token operator">=</span> <span class="token function">pre</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   res<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">diff</span><span class="token punctuation">(</span>vm f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">res</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> res<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">intg</span><span class="token punctuation">(</span>vm f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">res</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> res<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">log</span><span class="token punctuation">(</span>vm f<span class="token punctuation">,</span> <span class="token keyword">int</span> deg <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>deg <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> deg <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm res <span class="token operator">=</span> <span class="token function">intg</span><span class="token punctuation">(</span><span class="token function">conv</span><span class="token punctuation">(</span><span class="token function">diff</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">inv</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> deg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">exp</span><span class="token punctuation">(</span>vm f<span class="token punctuation">,</span> <span class="token keyword">int</span> deg <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   vm <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>deg <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> deg <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deg<span class="token punctuation">;</span> i <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm ff1 <span class="token operator">=</span> <span class="token function">pre</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vm ff2 <span class="token operator">=</span> <span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ff1<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>ff1<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ff2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ff1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> sz <span class="token operator">=</span> ff2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sz<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> ff1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-=</span> ff2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      res <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">pre</span><span class="token punctuation">(</span>ff1<span class="token punctuation">,</span> i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   res<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">taylor_shift</span><span class="token punctuation">(</span>vm f<span class="token punctuation">,</span> mm a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">fac</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">inv</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">finv</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fac<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> fac<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>
      inv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>inv<span class="token punctuation">[</span>mod <span class="token operator">%</span> i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>mod <span class="token operator">/</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      finv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> finv<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> inv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> fac<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   std<span class="token double-colon punctuation">::</span><span class="token function">reverse</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> a <span class="token operator">*</span> inv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   f <span class="token operator">=</span> <span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">conv</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">reverse</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> finv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="fps_sparse.hpp">fps_sparse.hpp</h2>
        md5: a351bf

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">using</span> vm <span class="token operator">=</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token punctuation">;</span>
vm <span class="token function">fps_inv_sparse</span><span class="token punctuation">(</span>vm<span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> mm<span class="token operator">>></span> dat<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   mm g0 <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   g<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> g0<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mm rhs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> fk<span class="token punctuation">]</span> <span class="token operator">:</span> dat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">></span> i<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         rhs <span class="token operator">-=</span> fk <span class="token operator">*</span> g<span class="token punctuation">[</span>i <span class="token operator">-</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      g<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rhs <span class="token operator">*</span> g0<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> g<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">fps_exp_sparse</span><span class="token punctuation">(</span>vm<span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> N <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> mm<span class="token operator">>></span> dat<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">mm</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">*</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">F</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   F<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mm rhs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> fk<span class="token punctuation">]</span> <span class="token operator">:</span> dat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">></span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         rhs <span class="token operator">+=</span> fk <span class="token operator">*</span> F<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      F<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> rhs <span class="token operator">*</span> <span class="token function">mm</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> F<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">fps_log_sparse</span><span class="token punctuation">(</span>vm<span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> N <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> mm<span class="token operator">>></span> dat<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">F</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span>N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mm rhs <span class="token operator">=</span> <span class="token function">mm</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> f<span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>i<span class="token punctuation">,</span> fi<span class="token punctuation">]</span> <span class="token operator">:</span> dat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">></span> n<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         rhs <span class="token operator">-=</span> fi <span class="token operator">*</span> g<span class="token punctuation">[</span>n <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      g<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> rhs<span class="token punctuation">;</span>
      F<span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> rhs <span class="token operator">*</span> <span class="token function">mm</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> F<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
vm <span class="token function">fps_pow_product</span><span class="token punctuation">(</span>vm<span class="token operator">&amp;</span> f<span class="token punctuation">,</span> vm<span class="token operator">&amp;</span> g<span class="token punctuation">,</span> mm n<span class="token punctuation">,</span> mm m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> N <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">using</span> P <span class="token operator">=</span> pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> mm<span class="token operator">></span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>P<span class="token operator">></span> dat_f<span class="token punctuation">,</span> dat_g<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat_f<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>g<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat_g<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">a</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">b</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>i<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">:</span> dat_f<span class="token punctuation">)</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>j<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">:</span> dat_g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">+</span> j <span class="token operator">>=</span> N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         mm xy <span class="token operator">=</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">+</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">)</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">+=</span> xy<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> i <span class="token operator">+</span> j <span class="token operator">&amp;&amp;</span> i <span class="token operator">+</span> j <span class="token operator">&lt;=</span> N<span class="token punctuation">)</span> b<span class="token punctuation">[</span>i <span class="token operator">+</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-=</span> xy <span class="token operator">*</span> <span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token function">mm</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> m <span class="token operator">*</span> <span class="token function">mm</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span>P<span class="token operator">></span> dat_a<span class="token punctuation">,</span> dat_b<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat_a<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> dat_b<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vm <span class="token function">F</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">df</span><span class="token punctuation">(</span>N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   F<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mm v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>i<span class="token punctuation">,</span> ai<span class="token punctuation">]</span> <span class="token operator">:</span> dat_a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">></span> n<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         v <span class="token operator">+=</span> ai <span class="token operator">*</span> df<span class="token punctuation">[</span>n <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>i<span class="token punctuation">,</span> bi<span class="token punctuation">]</span> <span class="token operator">:</span> dat_b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">></span> n<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         v <span class="token operator">+=</span> bi <span class="token operator">*</span> F<span class="token punctuation">[</span>n <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      df<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>v<span class="token punctuation">;</span>
      F<span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">mm</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> F<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="relaxed_conv.hpp">relaxed_conv.hpp</h2>
        md5: 33c76b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">RelaxedConvolution</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> N<span class="token punctuation">,</span> pos<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> buf<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">></span> event<span class="token punctuation">;</span>
   <span class="token keyword">void</span> <span class="token function">dfs1</span><span class="token punctuation">(</span><span class="token keyword">int</span> le<span class="token punctuation">,</span> <span class="token keyword">int</span> ri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ri <span class="token operator">-</span> le <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         event<span class="token punctuation">[</span>le<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>le<span class="token punctuation">,</span> le <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>le <span class="token operator">+</span> ri<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      event<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>le<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> mid <span class="token operator">-</span> le<span class="token punctuation">,</span> ri <span class="token operator">-</span> le<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      event<span class="token punctuation">[</span>ri<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mid<span class="token punctuation">,</span> ri<span class="token punctuation">,</span> mid <span class="token operator">-</span> le<span class="token punctuation">,</span> ri <span class="token operator">-</span> le<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs1</span><span class="token punctuation">(</span>le<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs1</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> ri<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">dfs2</span><span class="token punctuation">(</span><span class="token keyword">int</span> le<span class="token punctuation">,</span> <span class="token keyword">int</span> ri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ri <span class="token operator">-</span> le <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         event<span class="token punctuation">[</span>le<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> le<span class="token punctuation">,</span> le <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>le <span class="token operator">+</span> ri<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      event<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mid <span class="token operator">-</span> le<span class="token punctuation">,</span> ri <span class="token operator">-</span> le<span class="token punctuation">,</span> le<span class="token punctuation">,</span> mid<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      event<span class="token punctuation">[</span>ri<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mid <span class="token operator">-</span> le<span class="token punctuation">,</span> ri <span class="token operator">-</span> le<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> ri<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs2</span><span class="token punctuation">(</span>le<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs2</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> ri<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         event<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">int</span> mid <span class="token operator">=</span> len <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      event<span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>mid<span class="token punctuation">,</span> len<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> len<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs1</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs2</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">RelaxedConvolution</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      N <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>N <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> N <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      f<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      g<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      buf<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      event<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   T <span class="token function">get</span><span class="token punctuation">(</span>T x<span class="token punctuation">,</span> T y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      f<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">,</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>fl<span class="token punctuation">,</span> fr<span class="token punctuation">,</span> gl<span class="token punctuation">,</span> gr<span class="token punctuation">]</span> <span class="token operator">:</span> event<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">{</span>f<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> fl<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> fr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">{</span>g<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> gl<span class="token punctuation">,</span> g<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> gr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">auto</span> ret <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> sz <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sz<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">+</span> fl <span class="token operator">+</span> gl <span class="token operator">>=</span> N<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            buf<span class="token punctuation">[</span>i <span class="token operator">+</span> fl <span class="token operator">+</span> gl<span class="token punctuation">]</span> <span class="token operator">+=</span> ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> buf<span class="token punctuation">[</span>pos<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="graph">graph</h2>

    <div class="filename">
        <h2 id="bi_connected_components.hpp">bi_connected_components.hpp</h2>
        md5: 9883af

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">BiConnectedComponents</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">LowLink</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>bridge<span class="token punctuation">;</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>g<span class="token punctuation">;</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>low<span class="token punctuation">;</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>ord<span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> comp<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> tree<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> group<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      comp<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      group<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> group<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      tree<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> bridge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         tree<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         tree<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">explicit</span> <span class="token function">BiConnectedComponents</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">LowLink</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">build</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> used<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> tmp<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> pre<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>pre <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ord<span class="token punctuation">[</span>pre<span class="token punctuation">]</span> <span class="token operator">>=</span> low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> comp<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> comp<span class="token punctuation">[</span>pre<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> comp<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="eulerian_trail.hpp">eulerian_trail.hpp</h2>
        md5: 89bed1

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 72bf84</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">bool</span> directed<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">EulerianTrail</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">></span> G<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> es<span class="token punctuation">;</span>
   <span class="token keyword">int</span> M<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> usedV<span class="token punctuation">,</span> usedE<span class="token punctuation">,</span> deg<span class="token punctuation">;</span>

   <span class="token function">EulerianTrail</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">G</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">deg</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">usedV</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      es<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      G<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>directed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         deg<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
         deg<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         G<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token punctuation">;</span>
         deg<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
         deg<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      M<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> st<span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ord<span class="token punctuation">;</span>
      st<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> i <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">;</span>
         usedV<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ord<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> e <span class="token operator">=</span> G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>usedE<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            usedE<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>directed <span class="token operator">&amp;&amp;</span> es<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">!=</span> i<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>es<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> es<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      ord<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ord<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ord<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">enumerate_et</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>directed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> deg<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> deg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      usedE<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> ret<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> usedV<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         ret<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">go</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// a9700f</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">enumerate_semi_et</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dsu <span class="token function">d</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> es<span class="token punctuation">)</span> d<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>first<span class="token punctuation">,</span> p<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> group<span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">leader</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> ret<span class="token punctuation">;</span>
      usedE<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> vs <span class="token operator">:</span> group<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>vs<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> latte <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> malta <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>directed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> vs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>deg<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
               <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>deg<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>latte <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                  latte <span class="token operator">=</span> p<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> vs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>deg<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>latte <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> latte <span class="token operator">=</span> p<span class="token punctuation">;</span>
                  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>malta <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> malta <span class="token operator">=</span> p<span class="token punctuation">;</span>
                  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         ret<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">go</span><span class="token punctuation">(</span>latte <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> vs<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> latte<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> ret<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 97a2af</span>

   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">get_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> es<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// c83977</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="low_link.hpp">low_link.hpp</h2>
        md5: 862a6c

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">LowLink</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> g<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ord<span class="token punctuation">,</span> low<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> articulation<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> visited<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> bridge<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> pre<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      visited<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      ord<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">bool</span> isArticulation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> beet <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>to <span class="token operator">==</span> pre <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">exchange</span><span class="token punctuation">(</span>beet<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cnt<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">chmin</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            isArticulation <span class="token operator">|=</span> pre <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> low<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">>=</span> ord<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ord<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">&lt;</span> low<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> bridge<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token function">chmin</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> ord<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      isArticulation <span class="token operator">|=</span> pre <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> cnt <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>isArticulation<span class="token punctuation">)</span> articulation<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> n <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token operator">-></span>g <span class="token operator">=</span> g<span class="token punctuation">;</span>
      ord<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      low<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      visited<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token function">LowLink</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">build</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="manhattan_mst.hpp">manhattan_mst.hpp</h2>
        md5: 8b7b06

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// 候補の辺を O(N) 本に減らす。MST時は追加でsort, UF等の必要あり。</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> vector<span class="token operator">&lt;</span>tuple<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">manhattan_mst</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>T<span class="token operator">></span> xs<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span> ys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>xs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>tuple<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> ret<span class="token punctuation">;</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>xs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">ord</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">iota</span><span class="token punctuation">(</span>ord<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ord<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> s <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> xs<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> ys<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token function">sort</span><span class="token punctuation">(</span>ord<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ord<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>

         map<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> idx<span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">:</span> ord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> idx<span class="token punctuation">.</span><span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token operator">-</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> idx<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">=</span> idx<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">int</span> j <span class="token operator">=</span> it<span class="token operator">-></span>second<span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> xs<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> ys<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
               ret<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> xs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">abs</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> ys<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            idx<span class="token punctuation">[</span><span class="token operator">-</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">swap</span><span class="token punctuation">(</span>xs<span class="token punctuation">,</span> ys<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="max_flow.hpp">max_flow.hpp</h2>
        md5: a7f1d5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 9927a4</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Cap</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">mf_graph</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">mf_graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">mf_graph</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">,</span> Cap cap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pos<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>from<span class="token punctuation">,</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> from_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> to_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>from <span class="token operator">==</span> to<span class="token punctuation">)</span> to_id<span class="token operator">++</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>to<span class="token punctuation">,</span> to_id<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>from<span class="token punctuation">,</span> from_id<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> m<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Cap <span class="token function">flow</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> Cap flow_limit <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cap<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">level</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">iter</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> que<span class="token punctuation">;</span>
      <span class="token keyword">auto</span> bfs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         level<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> e <span class="token operator">:</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> level<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
               level<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> level<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>to <span class="token operator">==</span> t<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
               que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> dfs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> self<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">,</span> Cap up<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> s<span class="token punctuation">)</span> <span class="token keyword">return</span> up<span class="token punctuation">;</span>
         Cap res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> level_v <span class="token operator">=</span> level<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;</span> i <span class="token operator">=</span> iter<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _edge<span class="token operator">&amp;</span> e <span class="token operator">=</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>level_v <span class="token operator">&lt;=</span> level<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">||</span> g<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            Cap d <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> e<span class="token punctuation">.</span>to<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>up <span class="token operator">-</span> res<span class="token punctuation">,</span> g<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">+=</span> d<span class="token punctuation">;</span>
            g<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">-=</span> d<span class="token punctuation">;</span>
            res <span class="token operator">+=</span> d<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> up<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      Cap flow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>flow <span class="token operator">&lt;</span> flow_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>level<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>flow <span class="token operator">&lt;</span> flow_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Cap f <span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>dfs<span class="token punctuation">,</span> t<span class="token punctuation">,</span> flow_limit <span class="token operator">-</span> flow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>f<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            flow <span class="token operator">+=</span> f<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">min_cut</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">visited</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> que<span class="token punctuation">;</span>
      que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      visited<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> e <span class="token operator">:</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cap <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>visited<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               visited<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
               que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> visited<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 8735cf</span>

   <span class="token keyword">struct</span> <span class="token class-name">edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> from<span class="token punctuation">,</span> to<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">,</span> flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 9fe107</span>

   edge <span class="token function">get_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> edge<span class="token punctuation">{</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>to<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>cap <span class="token operator">+</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// ad4299</span>

   vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> <span class="token function">edges</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> result<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">get_edge</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 5948b8</span>

   <span class="token keyword">void</span> <span class="token function">change_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> Cap new_cap<span class="token punctuation">,</span> Cap new_flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      _e<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_cap <span class="token operator">-</span> new_flow<span class="token punctuation">;</span>
      _re<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 558c35</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   <span class="token keyword">struct</span> <span class="token class-name">_edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> to<span class="token punctuation">,</span> rev<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> pos<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>_edge<span class="token operator">>></span> g<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="min_cost_flow.hpp">min_cost_flow.hpp</h2>
        md5: 17d51b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 4e9f1c</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Cap</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Cost</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">mcf_graph</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">mcf_graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">mcf_graph</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">,</span> Cap cap<span class="token punctuation">,</span> Cost cost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pos<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>from<span class="token punctuation">,</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> from_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> to_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>from <span class="token operator">==</span> to<span class="token punctuation">)</span> to_id<span class="token operator">++</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>to<span class="token punctuation">,</span> to_id<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>from<span class="token punctuation">,</span> from_id<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> m<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   pair<span class="token operator">&lt;</span>Cap<span class="token punctuation">,</span> Cost<span class="token operator">></span> <span class="token function">flow</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> Cap flow_limit <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cap<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">slope</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">,</span> flow_limit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>Cap<span class="token punctuation">,</span> Cost<span class="token operator">>></span> <span class="token function">slope</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> Cap flow_limit <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cap<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span>Cost<span class="token operator">></span> <span class="token function">dual</span><span class="token punctuation">(</span>_n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dist</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">pv</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pe</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">vis</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> dual_ref <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cost<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>pe<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>vis<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">struct</span> <span class="token class-name">Q</span> <span class="token punctuation">{</span>
            Cost key<span class="token punctuation">;</span>
            <span class="token keyword">int</span> to<span class="token punctuation">;</span>
            <span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> Q<span class="token operator">&amp;</span> r<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key <span class="token operator">></span> r<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
         priority_queue<span class="token operator">&lt;</span>Q<span class="token operator">></span> que<span class="token punctuation">;</span>
         dist<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Q<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> que<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">;</span>
            que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> t<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">auto</span> e <span class="token operator">=</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token operator">!</span>e<span class="token punctuation">.</span>cap<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
               Cost cost <span class="token operator">=</span> e<span class="token punctuation">.</span>cost <span class="token operator">-</span> dual<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">+</span> dual<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmin</span><span class="token punctuation">(</span>dist<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+</span> cost<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  pv<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
                  pe<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                  que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Q<span class="token punctuation">{</span>dist<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>to<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>vis<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> v <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> v<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> dual<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">-=</span> dist<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">-</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      Cap flow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      Cap cost <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> prev_cost_per_flow <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>Cap<span class="token punctuation">,</span> Cost<span class="token operator">>></span> result<span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>flow<span class="token punctuation">,</span> cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>flow <span class="token operator">&lt;</span> flow_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">dual_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         Cap c <span class="token operator">=</span> flow_limit <span class="token operator">-</span> flow<span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">=</span> t<span class="token punctuation">;</span> v <span class="token operator">!=</span> s<span class="token punctuation">;</span> v <span class="token operator">=</span> pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> c <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">[</span>pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>pe<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">=</span> t<span class="token punctuation">;</span> v <span class="token operator">!=</span> s<span class="token punctuation">;</span> v <span class="token operator">=</span> pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">=</span> g<span class="token punctuation">[</span>pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>pe<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>cap <span class="token operator">-=</span> c<span class="token punctuation">;</span>
            g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">+=</span> c<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         Cost d <span class="token operator">=</span> <span class="token operator">-</span>dual<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>
         flow <span class="token operator">+=</span> c<span class="token punctuation">;</span>
         cost <span class="token operator">+=</span> c <span class="token operator">*</span> d<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>prev_cost_per_flow <span class="token operator">==</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span> result<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
         result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>flow<span class="token punctuation">,</span> cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         prev_cost_per_flow <span class="token operator">=</span> d<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">struct</span> <span class="token class-name">edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> from<span class="token punctuation">,</span> to<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">,</span> flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 9fe107</span>

   edge <span class="token function">get_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">edge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>to<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>cap <span class="token operator">+</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// d7bd7e</span>

   vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> <span class="token function">edges</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> result<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">get_edge</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 5948b8</span>

   <span class="token keyword">void</span> <span class="token function">change_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> Cap new_cap<span class="token punctuation">,</span> Cap new_flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      _e<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_cap <span class="token operator">-</span> new_flow<span class="token punctuation">;</span>
      _re<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 558c35</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   <span class="token keyword">struct</span> <span class="token class-name">_edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> to<span class="token punctuation">,</span> rev<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">;</span>
      Cost cost<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> pos<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>_edge<span class="token operator">>></span> g<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="scc.hpp">scc.hpp</h2>
        md5: 9f5fd6

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 3085f6</span>
<span class="token keyword">struct</span> <span class="token class-name">scc_graph</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">explicit</span> <span class="token function">scc_graph</span><span class="token punctuation">(</span><span class="token keyword">int</span> _n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">n</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">G</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rG</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">comp</span><span class="token punctuation">(</span>_n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">visited</span><span class="token punctuation">(</span>_n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= from &amp;&amp; from &lt; n);</span>
      <span class="token comment">// assert(0 &lt;= to &amp;&amp; to &lt; n);</span>
      G<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      rG<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">scc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>visited<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      order<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      comp_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>order<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">rdfs</span><span class="token punctuation">(</span>order<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> comp_size<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">v</span><span class="token punctuation">(</span>comp_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> v<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> v<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">get_comp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> comp<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// bdafc0</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">dag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">res</span><span class="token punctuation">(</span>comp_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> j <span class="token operator">:</span> G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> comp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> res<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> comp_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 312650</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> G<span class="token punctuation">,</span> rG<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> order<span class="token punctuation">,</span> comp<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> visited<span class="token punctuation">;</span>
   <span class="token keyword">int</span> n<span class="token punctuation">,</span> comp_size<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> G<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      order<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">rdfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      comp<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> rG<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">rdfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="two_sat.hpp">two_sat.hpp</h2>
        md5: 681721

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">two_sat</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">two_sat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">scc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">two_sat</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">scc</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_answer</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_clause</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">bool</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">,</span> <span class="token keyword">bool</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scc<span class="token punctuation">.</span><span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token punctuation">(</span>f <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token punctuation">(</span>g <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scc<span class="token punctuation">.</span><span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token punctuation">(</span>g <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token punctuation">(</span>f <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">satisfiable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scc<span class="token punctuation">.</span><span class="token function">scc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> comp <span class="token operator">=</span> scc<span class="token punctuation">.</span><span class="token function">get_comp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">==</span> comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         _answer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _answer<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> _answer<span class="token punctuation">;</span>
   scc_graph scc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="graph/tree">graph/tree</h2>

    <div class="filename">
        <h2 id="cartesian_tree.hpp">cartesian_tree.hpp</h2>
        md5: ac77a5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">cartesian_tree</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> root<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> par<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">;</span>

   <span class="token function">cartesian_tree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">par</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> st<span class="token punctuation">;</span>
      <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> prev <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">[</span>st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">></span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            prev <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>prev <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> par<span class="token punctuation">[</span>prev<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> par<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      root <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> root <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> right<span class="token punctuation">[</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">else</span> left<span class="token punctuation">[</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="dominator_tree.hpp">dominator_tree.hpp</h2>
        md5: 1c5d94

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">DominatorTree</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">DominatorTree</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g_<span class="token punctuation">,</span> <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">g</span><span class="token punctuation">(</span>g_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>g<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      par<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      idom<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      semi<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ord<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      UnionFind <span class="token function">uf</span><span class="token punctuation">(</span>semi<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">dfs</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> to <span class="token operator">:</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span>semi<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> rg<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">bucket</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">U</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ord<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> x <span class="token operator">=</span> ord<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">:</span> rg<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            v <span class="token operator">=</span> uf<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>semi<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">></span> semi<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> semi<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> semi<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         bucket<span class="token punctuation">[</span>ord<span class="token punctuation">[</span>semi<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">:</span> bucket<span class="token punctuation">[</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> U<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> uf<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
         bucket<span class="token punctuation">[</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         uf<span class="token punctuation">.</span><span class="token function">link</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ord<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> x <span class="token operator">=</span> ord<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> u <span class="token operator">=</span> U<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
         idom<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> semi<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> semi<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">?</span> semi<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">:</span> idom<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ord<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> x <span class="token operator">=</span> ord<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         idom<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> ord<span class="token punctuation">[</span>idom<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      idom<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> idom<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> g<span class="token punctuation">,</span> rg<span class="token punctuation">;</span>

   <span class="token keyword">struct</span> <span class="token class-name">UnionFind</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> semi<span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> par<span class="token punctuation">,</span> m<span class="token punctuation">;</span>

      <span class="token keyword">explicit</span> <span class="token function">UnionFind</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> semi<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">semi</span><span class="token punctuation">(</span>semi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">par</span><span class="token punctuation">(</span>semi<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m</span><span class="token punctuation">(</span>semi<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>par<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>par<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> v<span class="token punctuation">)</span> <span class="token keyword">return</span> v<span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>semi<span class="token punctuation">[</span>m<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">></span> semi<span class="token punctuation">[</span>m<span class="token punctuation">[</span>par<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> m<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> m<span class="token punctuation">[</span>par<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> par<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">int</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">find</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> m<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span> par<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ord<span class="token punctuation">,</span> par<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> idom<span class="token punctuation">,</span> semi<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      semi<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ord<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ord<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> to <span class="token operator">:</span> g<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span>semi<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
         par<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> idx<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="hld.hpp">hld.hpp</h2>
        md5: 10247f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">class</span> <span class="token class-name">HLDcomposition</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> V<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> G<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> stsize<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> pathtop<span class="token punctuation">,</span> in<span class="token punctuation">,</span> out<span class="token punctuation">;</span>
   <span class="token keyword">int</span> root<span class="token punctuation">;</span>
   <span class="token keyword">void</span> <span class="token function">build_stsize</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stsize<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> parent<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> v <span class="token operator">:</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">swap</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">build_stsize</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>
         stsize<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+=</span> stsize<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>stsize<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">></span> stsize<span class="token punctuation">[</span>G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build_path</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> tm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> tm<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         pathtop<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> pathtop<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">:</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">build_path</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      out<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> tm<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      G<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> _root <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      root <span class="token operator">=</span> _root<span class="token punctuation">;</span>
      <span class="token keyword">int</span> tm <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">build_stsize</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pathtop<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
      <span class="token function">build_path</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> in<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">lca</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> pa <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>pa <span class="token operator">!=</span> pb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            a <span class="token operator">=</span> parent<span class="token punctuation">[</span>pa<span class="token punctuation">]</span><span class="token punctuation">,</span> pa <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            b <span class="token operator">=</span> parent<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">subtree_query</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>in<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> out<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">>></span> <span class="token function">path_query</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> pf <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">,</span> pt <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">using</span> T <span class="token operator">=</span> tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span><span class="token punctuation">;</span>
      deque<span class="token operator">&lt;</span>T<span class="token operator">></span> front<span class="token punctuation">,</span> back<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>pf <span class="token operator">!=</span> pt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>pf<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>pt<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            front<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>pf<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            from <span class="token operator">=</span> parent<span class="token punctuation">[</span>pf<span class="token punctuation">]</span><span class="token punctuation">,</span> pf <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            back<span class="token punctuation">.</span><span class="token function">push_front</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>pt<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            to <span class="token operator">=</span> parent<span class="token punctuation">[</span>pt<span class="token punctuation">]</span><span class="token punctuation">,</span> pt <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> front<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> front<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>T<span class="token operator">></span> ret<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>front<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>front<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         front<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>back<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>back<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         back<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token function">HLDcomposition</span><span class="token punctuation">(</span><span class="token keyword">int</span> node_size<span class="token punctuation">)</span>
       <span class="token operator">:</span> <span class="token function">V</span><span class="token punctuation">(</span>node_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">G</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stsize</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">parent</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pathtop</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">in</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">out</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="flow">flow</h2>

    <div class="filename">
        <h2 id="燃やす埋める.md">燃やす埋める.md</h2>
    </div>
    <div class="content content-md"><table>
<thead>
<tr>
<th>変形前の制約</th>
<th>変形後の制約</th>
</tr>
</thead>
<tbody><tr>
<td>$x, y, \dots$ がすべて $0$ のとき $z$ 得る</td>
<td>無条件で $z$ 得る; $(S, w, z), (w, x, \infty), (w, y, \infty)$</td>
</tr>
<tr>
<td>$x, y, \dots$ がすべて $1$ のとき $z$ 得る</td>
<td>無条件で $z$ 得る; $(w, T, z), (x, w, \infty), (y, w, \infty)$</td>
</tr>
</tbody></table>
</div>

    <h2 class="section" id="string">string</h2>

    <div class="filename">
        <h2 id="KMP.hpp">KMP.hpp</h2>
        md5: 298f79

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// kmp[i] := max{ l ≤ i | s[:l] == s[(i+1)-l:i+1] }</span>
<span class="token comment">// abacaba -> 0010123</span>
<span class="token keyword">auto</span> <span class="token function">KMP</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">p</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll g <span class="token operator">=</span> p<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">)</span> g <span class="token operator">=</span> p<span class="token punctuation">[</span>g <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> g <span class="token operator">+</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="Manacher.hpp">Manacher.hpp</h2>
        md5: 20c548

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// 各位置での回文半径を求める</span>
<span class="token comment">// aaabaaa -> 1214121</span>
<span class="token comment">// 偶数長の回文を含めて直径を知るには，N+1 個の $ を挿入して 1 を引く</span>
<span class="token comment">// $a$a$a$b$a$a$a$ -> 123432181234321</span>
<span class="token keyword">auto</span> <span class="token function">manacher</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">r</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">>=</span> j <span class="token operator">&amp;&amp;</span> i <span class="token operator">+</span> j <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i <span class="token operator">-</span> j<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> j<span class="token operator">++</span><span class="token punctuation">;</span>
      r<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>
      ll k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">>=</span> k <span class="token operator">&amp;&amp;</span> i <span class="token operator">+</span> k <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> k <span class="token operator">+</span> r<span class="token punctuation">[</span>i <span class="token operator">-</span> k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         r<span class="token punctuation">[</span>i <span class="token operator">+</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">[</span>i <span class="token operator">-</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
         k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      i <span class="token operator">+=</span> k<span class="token punctuation">,</span> j <span class="token operator">-=</span> k<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="RollingHash.hpp">RollingHash.hpp</h2>
        md5: 7403a8

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// using u64 = uint64_t;</span>
<span class="token keyword">const</span> u64 mod <span class="token operator">=</span> INF<span class="token punctuation">;</span>
u64 <span class="token function">add</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a <span class="token operator">+=</span> b<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">>=</span> mod<span class="token punctuation">)</span> a <span class="token operator">-=</span> mod<span class="token punctuation">;</span>
   <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
u64 <span class="token function">mul</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">auto</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>__uint128_t<span class="token punctuation">)</span>a <span class="token operator">*</span> b<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>c <span class="token operator">>></span> <span class="token number">61</span><span class="token punctuation">,</span> c <span class="token operator">&amp;</span> mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
random_device rnd<span class="token punctuation">;</span>
<span class="token keyword">const</span> u64 r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>u64<span class="token punctuation">)</span><span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">32</span> <span class="token operator">|</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">RH</span> <span class="token punctuation">{</span>
   ll n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>u64<span class="token operator">></span> hs<span class="token punctuation">,</span> pw<span class="token punctuation">;</span>
   <span class="token function">RH</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hs</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pw</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         pw<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
         hs<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span>hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   u64 <span class="token function">get</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>hs<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> mod <span class="token operator">-</span> <span class="token function">mul</span><span class="token punctuation">(</span>hs<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> pw<span class="token punctuation">[</span>r <span class="token operator">-</span> l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="SuffixArray.hpp">SuffixArray.hpp</h2>
        md5: cbf1dc

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// returns pair{sa, lcp}</span>
<span class="token comment">// sa 長さ n : s[sa[0]:] &lt; s[sa[1]:] &lt; … &lt; s[sa[n-1]:]</span>
<span class="token comment">// lcp 長さ n-1 : lcp[i] = LCP(s[sa[i]:], s[sa[i+1]:])</span>
<span class="token keyword">auto</span> <span class="token function">SA</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lim <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
   <span class="token comment">// assert(lim > ranges::max(s));</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">sa</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lcp</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ws</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> lim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rk</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>ll j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> p <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1LL</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lim <span class="token operator">=</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p <span class="token operator">=</span> j<span class="token punctuation">;</span>
      <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> j<span class="token punctuation">)</span> y<span class="token punctuation">[</span>p<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> j<span class="token punctuation">;</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> ws<span class="token punctuation">[</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lim<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> ws<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> ws<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> n<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">)</span> sa<span class="token punctuation">[</span><span class="token operator">--</span>ws<span class="token punctuation">[</span>x<span class="token punctuation">[</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      p <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      x<span class="token punctuation">[</span>sa<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ll a <span class="token operator">=</span> sa<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         x<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">==</span> y<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> y<span class="token punctuation">[</span>a <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">==</span> y<span class="token punctuation">[</span>b <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> p <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> p<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> rk<span class="token punctuation">[</span>sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> lcp<span class="token punctuation">[</span>rk<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> k<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i <span class="token operator">+</span> k<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>sa<span class="token punctuation">[</span>rk<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> k<span class="token punctuation">]</span><span class="token punctuation">)</span> k<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   sa<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   lcp<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>lcp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> pair<span class="token punctuation">{</span>sa<span class="token punctuation">,</span> lcp<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="Zalgorithm.hpp">Zalgorithm.hpp</h2>
        md5: 6388f3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// Z[i] := LCP(s, s[i:])</span>
<span class="token comment">// abacaba -> 7010301</span>
<span class="token keyword">auto</span> <span class="token function">Z</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">z</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll<span class="token operator">&amp;</span> x <span class="token operator">=</span> z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">&lt;</span> r <span class="token operator">?</span> <span class="token function">min</span><span class="token punctuation">(</span>r <span class="token operator">-</span> i<span class="token punctuation">,</span> z<span class="token punctuation">[</span>i <span class="token operator">-</span> l<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">+</span> x <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> x<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">+</span> x <span class="token operator">></span> r<span class="token punctuation">)</span> l <span class="token operator">=</span> i<span class="token punctuation">,</span> r <span class="token operator">=</span> i <span class="token operator">+</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="aho_corasick.hpp">aho_corasick.hpp</h2>
        md5: f30f1f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 822702</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> char_size<span class="token punctuation">,</span> <span class="token keyword">int</span> margin<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">AhoCorasick</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">Trie</span><span class="token operator">&lt;</span><span class="token class-name">char_size</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">margin</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> Trie<span class="token operator">&lt;</span>char_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> margin<span class="token operator">></span><span class="token double-colon punctuation">::</span>Trie<span class="token punctuation">;</span>

   <span class="token keyword">const</span> <span class="token keyword">int</span> FAIL <span class="token operator">=</span> char_size<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> correct<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">bool</span> heavy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      correct<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> correct<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> que<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> char_size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            que<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span><span class="token operator">&amp;</span> now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> fail <span class="token operator">=</span> now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span><span class="token punctuation">;</span>
         correct<span class="token punctuation">[</span>que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> correct<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> char_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>heavy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">auto</span><span class="token operator">&amp;</span> u <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">;</span>
                  <span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">;</span>
                  vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> accept<span class="token punctuation">;</span>
                  <span class="token function">set_union</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">all</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">back_inserter</span><span class="token punctuation">(</span>accept<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  u <span class="token operator">=</span> accept<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               que<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">;</span>
      now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c <span class="token operator">-</span> margin<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 68ef6b</span>

   unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">,</span> visit_cnt<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> c <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c <span class="token operator">-</span> margin<span class="token punctuation">]</span><span class="token punctuation">;</span>
         visit_cnt<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>now<span class="token punctuation">,</span> cnt<span class="token punctuation">]</span> <span class="token operator">:</span> visit_cnt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span> res<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+=</span> cnt<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 36fe6c</span>

   pair<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c <span class="token operator">-</span> margin<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>correct<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">,</span> now<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 43ccad</span>

   pair<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> c <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> <span class="token punctuation">[</span>cnt<span class="token punctuation">,</span> nxt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">move</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
         res <span class="token operator">+=</span> cnt<span class="token punctuation">;</span>
         now <span class="token operator">=</span> nxt<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>res<span class="token punctuation">,</span> now<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// b1949a</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="sa_is.hpp">sa_is.hpp</h2>
        md5: 162db6

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sa_is</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sa</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">ls</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> ls<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sum_l</span><span class="token punctuation">(</span>upper <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum_s</span><span class="token punctuation">(</span>upper <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> sum_s<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> sum_l<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> upper<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum_s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> sum_l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> upper<span class="token punctuation">)</span> sum_l<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> sum_s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">auto</span> induce <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> lms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">buf</span><span class="token punctuation">(</span>upper <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sum_s<span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> d <span class="token operator">:</span> lms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         sa<span class="token punctuation">[</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sum_l<span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sa<span class="token punctuation">[</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">>=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ls<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> sa<span class="token punctuation">[</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sum_l<span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">>=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> sa<span class="token punctuation">[</span><span class="token operator">--</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">lms_map</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> lms_map<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> m<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> lms<span class="token punctuation">;</span>
   lms<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> lms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">induce</span><span class="token punctuation">(</span>lms<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> sorted_lms<span class="token punctuation">;</span>
      sorted_lms<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">:</span> sa<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>lms_map<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> sorted_lms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">rec_s</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> rec_upper <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      rec_s<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>sorted_lms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> sorted_lms<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> r <span class="token operator">=</span> sorted_lms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> end_l <span class="token operator">=</span> <span class="token punctuation">(</span>lms_map<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token operator">?</span> lms<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> n<span class="token punctuation">;</span>
         <span class="token keyword">int</span> end_r <span class="token operator">=</span> <span class="token punctuation">(</span>lms_map<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token operator">?</span> lms<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> n<span class="token punctuation">;</span>
         <span class="token keyword">bool</span> same <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>end_l <span class="token operator">-</span> l <span class="token operator">!=</span> end_r <span class="token operator">-</span> r<span class="token punctuation">)</span> same <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> end_l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
               l<span class="token operator">++</span><span class="token punctuation">;</span>
               r<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> n <span class="token operator">||</span> s<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> same <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>same<span class="token punctuation">)</span> rec_upper<span class="token operator">++</span><span class="token punctuation">;</span>
         rec_s<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>sorted_lms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> rec_upper<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">auto</span> rec_sa <span class="token operator">=</span> <span class="token function">sa_is</span><span class="token punctuation">(</span>rec_s<span class="token punctuation">,</span> rec_upper<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> sorted_lms<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> lms<span class="token punctuation">[</span>rec_sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token function">induce</span><span class="token punctuation">(</span>sorted_lms<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> sa<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="trie.hpp">trie.hpp</h2>
        md5: 09415e

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> char_size<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">TrieNode</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> nxt<span class="token punctuation">[</span>char_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> exist<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> accept<span class="token punctuation">;</span>

   <span class="token function">TrieNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">exist</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">memset</span><span class="token punctuation">(</span>nxt<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>nxt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> char_size<span class="token punctuation">,</span> <span class="token keyword">int</span> margin<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">Trie</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> Node <span class="token operator">=</span> TrieNode<span class="token operator">&lt;</span>char_size<span class="token operator">></span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span>Node<span class="token operator">></span> nodes<span class="token punctuation">;</span>
   <span class="token keyword">int</span> root<span class="token punctuation">;</span>
   <span class="token function">Trie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">update_direct</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">update_child</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">,</span> <span class="token keyword">int</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">++</span>nodes<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>exist<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> str_index<span class="token punctuation">,</span> <span class="token keyword">int</span> node_index<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>str_index <span class="token operator">==</span> <span class="token function">size</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">update_direct</span><span class="token punctuation">(</span>node_index<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> <span class="token keyword">int</span> c <span class="token operator">=</span> str<span class="token punctuation">[</span>str_index<span class="token punctuation">]</span> <span class="token operator">-</span> margin<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">add</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> str_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">update_child</span><span class="token punctuation">(</span>node_index<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> id <span class="token operator">=</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>exist<span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> str_index<span class="token punctuation">,</span> <span class="token keyword">int</span> node_index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> idx <span class="token operator">:</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>str_index <span class="token operator">==</span> <span class="token function">size</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> <span class="token keyword">int</span> c <span class="token operator">=</span> str<span class="token punctuation">[</span>str_index<span class="token punctuation">]</span> <span class="token operator">-</span> margin<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token function">query</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> f<span class="token punctuation">,</span> str_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">query</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>exist<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="algorithm">algorithm</h2>

    <div class="filename">
        <h2 id="3d_mo.hpp">3d_mo.hpp</h2>
        md5: 85daf7

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">Mo_3D</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> width<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> index<span class="token punctuation">,</span> order<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> v<span class="token punctuation">;</span>
   function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span> add<span class="token punctuation">,</span> del<span class="token punctuation">;</span>

   <span class="token function">Mo_3D</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> Q<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">order</span><span class="token punctuation">(</span>Q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">v</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token punctuation">{</span> width <span class="token operator">=</span> <span class="token generic-function"><span class="token function">max</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">pow</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> idx<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      left<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      right<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> add<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> del<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> rem<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> add_query<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> del_query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token operator">-></span>add <span class="token operator">=</span> add<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token operator">-></span>del <span class="token operator">=</span> del<span class="token punctuation">;</span>
      order<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>left<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">/</span> width <span class="token operator">!=</span> left<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">)</span> <span class="token keyword">return</span> left<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">&lt;</span> left<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>right<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">/</span> width <span class="token operator">!=</span> right<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>right<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>left<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">/</span> width <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token keyword">bool</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">&lt;</span> index<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>right<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">/</span> width <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> idx <span class="token operator">:</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>time <span class="token operator">&lt;</span> index<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">add_query</span><span class="token punctuation">(</span>time<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>time <span class="token operator">></span> index<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">del_query</span><span class="token punctuation">(</span><span class="token operator">--</span>time<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nl <span class="token operator">></span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">distribute</span><span class="token punctuation">(</span><span class="token operator">--</span>nl<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nr <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">distribute</span><span class="token punctuation">(</span>nr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nl <span class="token operator">&lt;</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">distribute</span><span class="token punctuation">(</span>nl<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nr <span class="token operator">></span> right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">distribute</span><span class="token punctuation">(</span><span class="token operator">--</span>nr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">rem</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">distribute</span><span class="token punctuation">(</span><span class="token keyword">int</span> idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">del</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token function">add</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>v<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="larsch.hpp">larsch.hpp</h2>
        md5: 2594bb

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">monge_shortest_path</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   T INF <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">dp</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> INF<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">x</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> check <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>from <span class="token operator">>=</span> to<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      T cost <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">+</span> cost <span class="token operator">&lt;</span> dp<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> dp<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">+</span> cost<span class="token punctuation">,</span> x<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> from<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> dfs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> rc<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> x<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> x<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">check</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">rc</span><span class="token punctuation">(</span>rc<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">check</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">rc</span><span class="token punctuation">(</span>rc<span class="token punctuation">,</span> m<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dfs</span><span class="token punctuation">(</span>dfs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> dp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// [min, max] は閉区間を入力する</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> get_min <span class="token operator">=</span> <span class="token boolean">true</span><span class="token operator">></span> pair<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> T<span class="token operator">></span> <span class="token function">golden_section_search</span><span class="token punctuation">(</span><span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token function">T</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">,</span> ll min<span class="token punctuation">,</span> ll max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>min <span class="token operator">&lt;=</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
   ll a <span class="token operator">=</span> min <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
   <span class="token punctuation">{</span>
      ll s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> t <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>t <span class="token operator">&lt;</span> max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>s <span class="token operator">+=</span> t<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      x <span class="token operator">=</span> a <span class="token operator">+</span> t <span class="token operator">-</span> s<span class="token punctuation">,</span> b <span class="token operator">=</span> a <span class="token operator">+</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   T fx <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> fy<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll y <span class="token operator">=</span> a <span class="token operator">+</span> b <span class="token operator">-</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>max <span class="token operator">&lt;</span> y <span class="token operator">||</span> <span class="token punctuation">(</span>fy <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> get_min <span class="token operator">?</span> fx <span class="token operator">&lt;</span> fy <span class="token operator">:</span> fx <span class="token operator">></span> fy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         b <span class="token operator">=</span> a<span class="token punctuation">;</span>
         a <span class="token operator">=</span> y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         a <span class="token operator">=</span> x<span class="token punctuation">;</span>
         x <span class="token operator">=</span> y<span class="token punctuation">;</span>
         fx <span class="token operator">=</span> fy<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> fx<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// upper : max abs(辺数を 1 増減させたときのコストの変化)</span>
ll <span class="token function">monge_d_edge_shortest_path</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> D<span class="token punctuation">,</span> ll upper<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token function">ll</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> T <span class="token operator">=</span> __int128_t<span class="token punctuation">;</span>
   upper <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ll x<span class="token punctuation">)</span> <span class="token operator">-></span> T <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> g <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">)</span> <span class="token operator">-></span> T <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span> <span class="token operator">+</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      T cost <span class="token operator">=</span> <span class="token generic-function"><span class="token function">monge_shortest_path</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cost <span class="token operator">-</span> T<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">*</span> D <span class="token operator">*</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> <span class="token punctuation">[</span>_<span class="token punctuation">,</span> res<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">golden_section_search</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>dp<span class="token punctuation">,</span> <span class="token operator">-</span>upper<span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">enumerate_monge_d</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token function">ll</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">,</span> ll unreached <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> <span class="token number">62</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> T <span class="token operator">=</span> __int128_t<span class="token punctuation">;</span>
   T INF <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">ans</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> unreached<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">dp</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> INF<span class="token punctuation">)</span><span class="token punctuation">;</span>
   dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> d <span class="token operator">&lt;=</span> N<span class="token punctuation">;</span> d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> midx <span class="token operator">=</span>
          <span class="token generic-function"><span class="token function">monotone_minima</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token operator">-></span> T <span class="token punctuation">{</span> <span class="token keyword">return</span> i <span class="token operator">&lt;</span> j <span class="token operator">?</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token operator">:</span> INF<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> N<span class="token punctuation">;</span> i <span class="token operator">>=</span> d<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>midx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>midx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ans<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="min_plus_concave.hpp">min_plus_concave.hpp</h2>
        md5: c4cd24

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// b is concave</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">minplus_conv_concave</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> h <span class="token operator">=</span> n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> w <span class="token operator">=</span> n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">ymin</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ymax</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">xmin</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">xmax</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> m<span class="token punctuation">;</span> x <span class="token operator">&lt;</span> h<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> ymin<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">-</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span> h <span class="token operator">-</span> m<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> ymax<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
   <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>xmin<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>xmax<span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">c</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> INF<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// if long long</span>
   <span class="token keyword">auto</span> rec <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> rec<span class="token punctuation">,</span> <span class="token keyword">int</span> x1<span class="token punctuation">,</span> <span class="token keyword">int</span> x2<span class="token punctuation">,</span> <span class="token keyword">int</span> y1<span class="token punctuation">,</span> <span class="token keyword">int</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ymax<span class="token punctuation">[</span>x1<span class="token punctuation">]</span> <span class="token operator">>=</span> y2 <span class="token operator">and</span> y1 <span class="token operator">>=</span> ymin<span class="token punctuation">[</span>x2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">[</span>y2 <span class="token operator">-</span> j<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>x1 <span class="token operator">+</span> i <span class="token operator">-</span> y2 <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token keyword">auto</span> jmin <span class="token operator">=</span> <span class="token generic-function"><span class="token function">monotone_minima</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y2 <span class="token operator">-</span> y1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> A<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> x1<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> x2<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">chmin</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">A</span><span class="token punctuation">(</span>i <span class="token operator">-</span> x1<span class="token punctuation">,</span> jmin<span class="token punctuation">[</span>i <span class="token operator">-</span> x1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> x1<span class="token punctuation">;</span> x <span class="token operator">&lt;=</span> x2<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>ymin<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> <span class="token function">min</span><span class="token punctuation">(</span>ymax<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">chmin</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span>x <span class="token operator">-</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1 <span class="token operator">></span> y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> xm <span class="token operator">=</span> <span class="token punctuation">(</span>x1 <span class="token operator">+</span> x2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> ny2 <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>ymax<span class="token punctuation">[</span>xm<span class="token punctuation">]</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> ny1 <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>ymin<span class="token punctuation">[</span>xm<span class="token punctuation">]</span><span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>y1 <span class="token operator">&lt;=</span> ny2<span class="token punctuation">)</span> <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> xm<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> ny2<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ny1 <span class="token operator">&lt;=</span> y2<span class="token punctuation">)</span> <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> xm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x2<span class="token punctuation">,</span> ny1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> ym <span class="token operator">=</span> <span class="token punctuation">(</span>y1 <span class="token operator">+</span> y2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> nx2 <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>xmax<span class="token punctuation">[</span>ym<span class="token punctuation">]</span><span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> nx1 <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>xmin<span class="token punctuation">[</span>ym<span class="token punctuation">]</span><span class="token punctuation">,</span> x1<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>x1 <span class="token operator">&lt;=</span> nx2<span class="token punctuation">)</span> <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> nx2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> ym<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nx1 <span class="token operator">&lt;=</span> x2<span class="token punctuation">)</span> <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> nx1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> ym <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="min_plus_conv.hpp">min_plus_conv.hpp</h2>
        md5: f2bb6c

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">F</span><span class="token operator">></span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">monotone_minima</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">const</span> F<span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> T<span class="token operator">>></span> <span class="token function">dp</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token function">pair</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> rec <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> rec<span class="token punctuation">,</span> <span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">></span> d<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>u <span class="token operator">+</span> d<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>idx<span class="token punctuation">,</span> mi<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">;</span>
      idx <span class="token operator">=</span> l<span class="token punctuation">,</span> mi <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> r<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmin</span><span class="token punctuation">(</span>mi<span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> idx <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> u<span class="token punctuation">,</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ret<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>idx<span class="token punctuation">,</span> val<span class="token punctuation">]</span> <span class="token operator">:</span> dp<span class="token punctuation">)</span> ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span>  <span class="token comment">// B is convex. if both A and B are convex, do greedy.</span>
vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">minplus_conv</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> A<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> A<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> B<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> m <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">C</span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">const</span> ll inf <span class="token operator">=</span> INF<span class="token punctuation">;</span>
   <span class="token keyword">auto</span> select <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token operator">-></span> T <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token keyword">return</span> inf<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">-</span> j <span class="token operator">>=</span> m<span class="token punctuation">)</span> <span class="token keyword">return</span> inf<span class="token punctuation">;</span>
      <span class="token keyword">return</span> A<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> B<span class="token punctuation">[</span>i <span class="token operator">-</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> J <span class="token operator">=</span> <span class="token generic-function"><span class="token function">monotone_minima</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> select<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T x <span class="token operator">=</span> A<span class="token punctuation">[</span>J<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> B<span class="token punctuation">[</span>i <span class="token operator">-</span> J<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> inf <span class="token operator">&amp;&amp;</span> y <span class="token operator">&lt;</span> inf<span class="token punctuation">)</span> C<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> C<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="mo.hpp">mo.hpp</h2>
        md5: 62406b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">Mo</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> width<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> order<span class="token punctuation">;</span>
   <span class="token function">Mo</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> Q<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">order</span><span class="token punctuation">(</span>Q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      width <span class="token operator">=</span> <span class="token generic-function"><span class="token function">max</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token operator">*</span> N <span class="token operator">/</span> <span class="token generic-function"><span class="token function">max</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>Q <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      left<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      right<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> add_left<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> add_right<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> delete_left<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> delete_right<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> rem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> ablock <span class="token operator">=</span> left<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> bblock <span class="token operator">=</span> left<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ablock <span class="token operator">!=</span> bblock<span class="token punctuation">)</span> <span class="token keyword">return</span> ablock <span class="token operator">&lt;</span> bblock<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token punctuation">(</span>ablock <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> right<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">></span> right<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">:</span> right<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> nl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> nr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> idx <span class="token operator">:</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nl <span class="token operator">></span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">add_left</span><span class="token punctuation">(</span><span class="token operator">--</span>nl<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nr <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">add_right</span><span class="token punctuation">(</span>nr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nl <span class="token operator">&lt;</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">delete_left</span><span class="token punctuation">(</span>nl<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nr <span class="token operator">></span> right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">delete_right</span><span class="token punctuation">(</span><span class="token operator">--</span>nr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">rem</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="rollback_mo.hpp">rollback_mo.hpp</h2>
        md5: 8d34d2

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">Mo_rollback</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> width<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> order<span class="token punctuation">;</span>
   <span class="token function">Mo_rollback</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> Q<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">order</span><span class="token punctuation">(</span>Q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      width <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      left<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      right<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> add_left<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> add_right<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> rem<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> reset<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> snapshot<span class="token punctuation">,</span>
            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> rollback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> ablock <span class="token operator">=</span> left<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> bblock <span class="token operator">=</span> left<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ablock <span class="token operator">!=</span> bblock<span class="token punctuation">)</span> <span class="token keyword">return</span> ablock <span class="token operator">&lt;</span> bblock<span class="token punctuation">;</span>
         <span class="token keyword">return</span> right<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> idx <span class="token operator">:</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">-</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">&lt;</span> width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">add_right</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">rem</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">int</span> nr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> last_block <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> idx <span class="token operator">:</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">-</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">&lt;</span> width<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> block <span class="token operator">=</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">/</span> width<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>block <span class="token operator">!=</span> last_block<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            nr <span class="token operator">=</span> <span class="token punctuation">(</span>block <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> width<span class="token punctuation">;</span>
            last_block <span class="token operator">=</span> block<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>nr <span class="token operator">&lt;</span> right<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">add_right</span><span class="token punctuation">(</span>nr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>block <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">>=</span> left<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">add_left</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">rem</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="geometry">geometry</h2>

    <div class="filename">
        <h2 id="base.hpp">base.hpp</h2>
        md5: 9ca2e3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">using</span> Point <span class="token operator">=</span> complex<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">using</span> Line <span class="token operator">=</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">X</span> <span class="token expression"><span class="token function">real</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Y</span> <span class="token expression"><span class="token function">imag</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">const</span> <span class="token keyword">double</span> EPS <span class="token operator">=</span> <span class="token number">1e-10</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>X <span class="token operator">*</span> b<span class="token punctuation">.</span>X <span class="token operator">+</span> a<span class="token punctuation">.</span>Y <span class="token operator">*</span> b<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>X <span class="token operator">*</span> b<span class="token punctuation">.</span>Y <span class="token operator">-</span> a<span class="token punctuation">.</span>Y <span class="token operator">*</span> b<span class="token punctuation">.</span>X<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="convex_hull.hpp">convex_hull.hpp</h2>
        md5: 17af99

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> <span class="token function">convex_hull</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">,</span> <span class="token keyword">bool</span> collinear <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ps<span class="token punctuation">;</span>
   <span class="token function">sort</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">&amp;</span>EPS<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>X <span class="token operator">-</span> b<span class="token punctuation">.</span>X<span class="token punctuation">)</span> <span class="token operator">></span> EPS <span class="token operator">?</span> a<span class="token punctuation">.</span>X <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>X <span class="token operator">:</span> a<span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> <span class="token function">hull</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> th <span class="token operator">=</span> collinear <span class="token operator">?</span> <span class="token operator">-</span>EPS <span class="token operator">:</span> EPS<span class="token punctuation">;</span>
   <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> th<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         hull<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">int</span> t <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">>=</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> th<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         hull<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   hull<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> hull<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="etc.hpp">etc.hpp</h2>
        md5: 093f7a

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// 1: a-bから見てa-cが反時計回り -1: a-bから見てa-cが時計回り</span>
<span class="token comment">// 0: a-c-bがこの順で直線</span>
<span class="token comment">// 2: c-a-bの順で直線 -2: a-b-cの順で直線</span>
<span class="token keyword">int</span> <span class="token function">ccw</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">,</span> c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">,</span> c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">,</span> c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">norm</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">norm</span><span class="token punctuation">(</span>c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">-</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 6f1927</span>
Point <span class="token function">projection</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">double</span> t <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>p <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">norm</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> t <span class="token operator">*</span> <span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// b9dbd7</span>
Point <span class="token function">reflection</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> l<span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// 65ba76</span>
<span class="token keyword">bool</span> <span class="token function">isinterPL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// e9d393</span>
<span class="token keyword">bool</span> <span class="token function">isinterPS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">ccw</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>          <span class="token comment">// 79c17b</span>
<span class="token keyword">bool</span> <span class="token function">isinterLL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> EPS <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// b58dbd</span>
<span class="token keyword">bool</span> <span class="token function">isinterSS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">norm</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">isinterPS</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">norm</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">isinterPS</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">ccw</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">ccw</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">ccw</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">ccw</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// a499ea</span>
<span class="token keyword">double</span> <span class="token function">distancePL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// c77772</span>
<span class="token keyword">double</span> <span class="token function">distancePS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   Point h <span class="token operator">=</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isinterPS</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 3bd780</span>
<span class="token keyword">double</span> <span class="token function">distanceLL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isinterLL</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">distancePL</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// ab4ace</span>
<span class="token keyword">double</span> <span class="token function">distanceSS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isinterSS</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token function">distancePS</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">distancePS</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">distancePS</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">distancePS</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// c284e5</span>
<span class="token comment">// if(ans){ x = p->X; y = q->Y} else {cout &lt;&lt; "not cross"}</span>
optional<span class="token operator">&lt;</span>Point<span class="token operator">></span> <span class="token function">crosspoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">double</span> d <span class="token operator">=</span> <span class="token function">cross</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> nullopt<span class="token punctuation">;</span>
   <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cross</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 687c0c</span>
<span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">double</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> res <span class="token operator">+=</span> <span class="token function">cross</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token function">size</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 3b832b</span>
<span class="token keyword">bool</span> <span class="token function">is_convex</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ccw</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 52fb34</span>
tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">diameter</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> si <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">></span> ps<span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">.</span>Y<span class="token punctuation">)</span> si <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> ps<span class="token punctuation">[</span>sj<span class="token punctuation">]</span><span class="token punctuation">.</span>Y<span class="token punctuation">)</span> sj <span class="token operator">=</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">double</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> i <span class="token operator">=</span> si<span class="token punctuation">,</span> j <span class="token operator">=</span> sj<span class="token punctuation">;</span>
   <span class="token keyword">int</span> ri <span class="token operator">=</span> i<span class="token punctuation">,</span> rj <span class="token operator">=</span> j<span class="token punctuation">;</span>
   <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmax</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ri <span class="token operator">=</span> i<span class="token punctuation">;</span>
         rj <span class="token operator">=</span> j<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">;</span>
      <span class="token keyword">else</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">!=</span> si <span class="token operator">||</span> j <span class="token operator">!=</span> sj<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>res<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>ri<span class="token punctuation">,</span> rj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>ri<span class="token punctuation">,</span> rj<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// cae9ad</span>
<span class="token comment">// 2: inside, 1: border, 0: outside</span>
<span class="token keyword">int</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">bool</span> in <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Point a <span class="token operator">=</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">,</span> b <span class="token operator">=</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>Y <span class="token operator">></span> b<span class="token punctuation">.</span>Y<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>Y <span class="token operator">&lt;=</span> EPS <span class="token operator">&amp;&amp;</span> EPS <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>Y <span class="token operator">&amp;&amp;</span> <span class="token function">cross</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>EPS<span class="token punctuation">)</span> in <span class="token operator">=</span> <span class="token operator">!</span>in<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS <span class="token operator">&amp;&amp;</span> <span class="token function">dot</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> in <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// fd7e87</span>
tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">closest_pair</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token keyword">double</span> INF <span class="token operator">=</span> <span class="token number">1e18</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>INF<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">using</span> P <span class="token operator">=</span> pair<span class="token operator">&lt;</span>Point<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>P<span class="token operator">></span> <span class="token function">V</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> V<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> P<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> P<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">-</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">-</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">.</span>second <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> rec <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> self<span class="token punctuation">,</span> <span class="token keyword">auto</span> it<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">-></span> tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>INF<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> x <span class="token operator">=</span> it<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>d1<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> b1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> it<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>d2<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> b2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> it <span class="token operator">+</span> m<span class="token punctuation">,</span> n <span class="token operator">-</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> d<span class="token punctuation">;</span>
      <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>d1 <span class="token operator">&lt;</span> d2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         d <span class="token operator">=</span> d1<span class="token punctuation">;</span>
         a <span class="token operator">=</span> a1<span class="token punctuation">;</span>
         b <span class="token operator">=</span> b1<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         d <span class="token operator">=</span> d2<span class="token punctuation">;</span>
         a <span class="token operator">=</span> a2<span class="token punctuation">;</span>
         b <span class="token operator">=</span> b2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">inplace_merge</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> it <span class="token operator">+</span> m<span class="token punctuation">,</span> it <span class="token operator">+</span> n<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> P<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> P<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>P<span class="token operator">></span> vec<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">>=</span> d<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">double</span> dx <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">-</span> vec<span class="token punctuation">[</span><span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span> <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span> dy <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">-</span> vec<span class="token punctuation">[</span><span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span> <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dy <span class="token operator">>=</span> d<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmin</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               a <span class="token operator">=</span> it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
               b <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span> <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         vec<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>d<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> <span class="token punctuation">[</span>d<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> V<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>d<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 12a9dc</span></code></pre>
</div>

    <h2 class="section" id="memo">memo</h2>

    <div class="filename">
        <h2 id="BIT二分探索.cpp">BIT二分探索.cpp</h2>
        md5: 694e3b

    </div>
    <div class="content content-cpp">
    <pre><code><span class="token comment">// minimize i s.t. sum(i) >= w</span>
<span class="token keyword">int</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span>ll w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>w <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> N <span class="token operator">=</span> <span class="token function">si</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token function">__lg</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token punctuation">;</span> k <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">+</span> k <span class="token operator">&lt;=</span> N <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>x <span class="token operator">+</span> k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w <span class="token operator">-=</span> a<span class="token punctuation">[</span>x <span class="token operator">+</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
        x <span class="token operator">+=</span> k<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="Primes.md">Primes.md</h2>
    </div>
    <div class="content content-md"><h4>高度合成数</h4>
<table>
<thead>
<tr>
<th>$≤n$</th>
<th>$10^3$</th>
<th>$10^4$</th>
<th>$10^6$</th>
<th>$10^9$</th>
<th>$10^{12}$</th>
<th>$10^{16}$</th>
<th>$10^{18}$</th>
</tr>
</thead>
<tbody><tr>
<td>$x$</td>
<td>840</td>
<td>7560</td>
<td>720720</td>
<td>735135500</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>$d^0(x)$</td>
<td>32</td>
<td>64</td>
<td>240</td>
<td>1344</td>
<td>10752</td>
<td>41472</td>
<td>103680</td>
</tr>
</tbody></table>
</div>

    <div class="filename">
        <h2 id="bigint.md">bigint.md</h2>
    </div>
    <div class="content content-md"><pre><code class="language-cpp">#include &lt;boost/multiprecision/cpp_int.hpp&gt;
namespace mp = boost::multiprecision;
mp::cpp_int x = 1;
</code></pre>
<p>または</p>
<pre><code class="language-cpp">using namespace boost::multiprecision;
cpp_int x;
x.assign(&quot;123&quot;);
</code></pre>
</div>

    <div class="filename">
        <h2 id="ext.cpp">ext.cpp</h2>
        md5: 64e006

    </div>
    <div class="content content-cpp">
    <pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/pb_ds/assoc_container.hpp></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/pb_ds/tree_policy.hpp></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/pb_ds/priority_queue.hpp></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/rope></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> __gnu_pbds<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> __gnu_cxx<span class="token punctuation">;</span>  <span class="token comment">// for ext/rope</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   tree<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> null_type<span class="token punctuation">,</span> less<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">,</span> rb_tree_tag<span class="token punctuation">,</span> tree_order_statistics_node_update<span class="token operator">></span> tree<span class="token punctuation">;</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// 1 10</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1 6 10</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1 6 7 10</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1 4 6 7 10</span>
   tree<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 1 4 7 10</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span><span class="token function">order_of_key</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5未満の要素数</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token operator">*</span>tree<span class="token punctuation">.</span><span class="token function">find_by_order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0-indexedで2番目の要素</span>

   gp_hash_table<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> m<span class="token punctuation">;</span>
   m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
   m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
   m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

   __gnu_pbds<span class="token double-colon punctuation">::</span>priority_queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> greater<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">,</span> rc_binomial_heap_tag<span class="token operator">></span> pq<span class="token punctuation">;</span>
   <span class="token keyword">auto</span> it <span class="token operator">=</span> pq<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
   pq<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 1 10</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pq<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10 20</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pq<span class="token punctuation">.</span><span class="token function">erase_if</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 20</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pq<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// empty</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// access, insert, erase: O(log n)</span>
   rope<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> v<span class="token punctuation">;</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2 1</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2 3 1</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2 3 4 1</span>
   v<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 2 1</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="random.hpp">random.hpp</h2>
        md5: b4f59b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">rng</span> <span class="token punctuation">{</span>
   mt19937 mt<span class="token punctuation">;</span>
   <span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">mt</span><span class="token punctuation">(</span><span class="token number">58</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// [a, b]</span>
      uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">dist</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="set_compare.md">set_compare.md</h2>
    </div>
    <div class="content content-md"><pre><code class="language-cpp">   auto comp = [&amp;](const int a, const int b) {return a &gt; b;};
   set&lt;int, decltype(comp)&gt; st{comp};
</code></pre>
</div>

    <div class="filename">
        <h2 id="数式.md">数式.md</h2>
    </div>
    <div class="content content-md"><h3>攪乱順列</h3>
<p>$$a_n = (n - 1) (a_{n-1} + a_{n-2})$$
$$a_n = n! \sum_{k=2}^{n} \frac{(-1)^k }{(k!)}$$ </p>
<h3>オイラーの五角数定理</h3>
<p>$$ \prod_{k=1}^{\infty} (1 - x^n) = \sum_{n=-\infty}^{\infty} (-1)^n x^{n(3n-1)/2} $$</p>
<h3>メビウスの反転公式</h3>
<p>$$ g(n) = \sum_{d|n} f(d) $$
$$ f(n) = \sum_{d|n} g(d) \mu(\frac{n}{d})$$</p>
<h3>ピックの定理</h3>
<p>$i$ は内部、 $b$ は線上
$$S = i + \frac{b}{2} - 1$$</p>
<h3>行列木定理</h3>
<ul>
<li><p>$n$ 頂点 $m$ 辺のグラフの(ラベル付き)全域木の個数</p>
</li>
<li><p>ラプラシアン行列の任意の余因子の行列式の $(-1)^{i + j}$ 倍</p>
</li>
</ul>
<h3>LGV公式</h3>
<ul>
<li><p>DAGおよび始点集合 $A$ と終点集合 $B$ が与えられる。整合的であるとき、これらを始点・終点とするパスの組であって、どの $2$ のパスも頂点を共有しないものの個数 </p>
</li>
<li><p>整合的: $2$ つの始点 $a_i &lt; a_j \in A$ と $2$ つの終点 $b_i &gt; b_j \in B$ があるとき、 $a_i$ から $b_j$ のパスと $a_j$ から $b_i$ のパスは必ず交わる </p>
</li>
<li><p>$x_{i,j}$ を $a_i$ から $b_j$ に向かうパスの個数として、$X=(x_{i, j})$ の行列式</p>
</li>
</ul>
<h3>LP双対</h3>
<p>強双対性 : $\max \lbrace cx | x \geq 0, Ax \leq b \rbrace = \min \lbrace yb | y \geq 0, yA \geq c \rbrace$</p>
<h3>Tutte行列</h3>
<p>完全マッチング存在条件</p>
<p>\begin{eqnarray}
A_{i, j} = 
\begin{cases}
    x_{i, j} &amp; \text{if} (i, j) \in E ~ \text{and} ~ i &lt; j \\
    -x_{i, j} &amp; \text{if}  (i, j) \in E ~ \text{and} ~ i &gt; j \\
    0 &amp; \text{otherwise}
\end{cases}
\end{eqnarray}</p>
<p>の行列式が多項式として0</p>
<h3>ラグランジュの反転公式</h3>
<ul>
<li>$F$ と $G$ が互いに逆関数、つまり $G(F(x)) = F(G(x)) = x$</li>
</ul>
<p>$$ [x^n]G(x) = \frac{1}{n} [x^{n-1}] \left( \frac{x}{F(x)} \right)^n
$$</p>
<h3>繰り返し文字列</h3>
<p>$X, Y$ は空でない有限文字列</p>
<ul>
<li><p>$X^\infty = Y^\infty \iff XY = YX$</p>
</li>
<li><p>$lcp(X^\infty, Y^\infty) = lcp(XY, YX)$</p>
</li>
<li><p>$X^\infty &lt; Y \iff XY &lt; Y$</p>
</li>
</ul>
<h3>負の二項定理</h3>
<p>$$ (1-x)^{-n} = \sum_{k=0}^{\infty} \binom{k+n-1}{n-1} x^k $$</p>
<h3>傾き1の2本の直線の間を通る最短経路</h3>
<p>$y=x+s$ と $y=x+t$ の間を通る(直線上の点は通れる)、$(a,b)$ から $(c,d)$ への最短経路の個数は</p>
<p>$$\sum_k \left(\binom{c+d-a-b}{c-a-k(t-s+2)} - \binom{c+d-a-b}{c-b-k(t-s+2)+t+1}\right)$$</p>
<h3>フック長の公式</h3>
<p>$$d_\lambda = \frac{n!}{\prod h_{\lambda}(i,j)}$$</p>
<h3>other</h3>
<ul>
<li>異なる自然数に分割する方法の個数と奇数に分割する方法の個数が等しい</li>
</ul>
</div>

    <div class="filename">
        <h2 id="牛ゲー.md">牛ゲー.md</h2>
    </div>
    <div class="content content-md"><p>$ x_i - x_j \leq M $ のとき</p>
<pre><code class="language-cpp">G[j].push_back({M, i})
</code></pre>
</div>

</body>
</html>
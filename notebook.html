<!DOCTYPE html>
<!-- generated by build/build.js -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICPC Notebook</title>
    <!-- MathJax -->
    <script>
        var MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- css -->
    <link rel="stylesheet" type="text/css" href="notebook.css" />
</head>
<body>
    <h1 id="title">ICPC Notebook</h1>
    <!-- 目次 -->
    <nav id="toc" role="doc-toc">
        <ol>
            
    <li><a class="section" href="#template">template</a></li>
    <ol>
    <li><a href="#hash.sh">hash.sh</a></li>
    <li><a href="#settings.sh">settings.sh</a></li>
    <li><a href="#template.hpp">template.hpp</a></li>
    </ol>
    <li><a class="section" href="#data-structure">data-structure</a></li>
    <ol>
    <li><a href="#2dBIT.hpp">2dBIT.hpp</a></li>
    <li><a href="#BIT.hpp">BIT.hpp</a></li>
    <li><a href="#FastSet.hpp">FastSet.hpp</a></li>
    <li><a href="#binary_trie.hpp">binary_trie.hpp</a></li>
    <li><a href="#ch_segtree.hpp">ch_segtree.hpp</a></li>
    <li><a href="#disjoint_sparse_table.hpp">disjoint_sparse_table.hpp</a></li>
    <li><a href="#dsu.hpp">dsu.hpp</a></li>
    <li><a href="#lazy_segtree.hpp">lazy_segtree.hpp</a></li>
    <li><a href="#potential_dsu.hpp">potential_dsu.hpp</a></li>
    <li><a href="#range_set.hpp">range_set.hpp</a></li>
    <li><a href="#range_tree.hpp">range_tree.hpp</a></li>
    <li><a href="#segtree.hpp">segtree.hpp</a></li>
    <li><a href="#sparse_table.hpp">sparse_table.hpp</a></li>
    <li><a href="#treap.hpp">treap.hpp</a></li>
    <li><a href="#undo_dsu.hpp">undo_dsu.hpp</a></li>
    <li><a href="#wavelet_matrix.hpp">wavelet_matrix.hpp</a></li>
    </ol>
    <li><a class="section" href="#math">math</a></li>
    <ol>
    <li><a href="#BinaryGCD.hpp">BinaryGCD.hpp</a></li>
    <li><a href="#ExtGCD.hpp">ExtGCD.hpp</a></li>
    <li><a href="#crt.hpp">crt.hpp</a></li>
    <li><a href="#eratos.hpp">eratos.hpp</a></li>
    <li><a href="#factorize.hpp">factorize.hpp</a></li>
    <li><a href="#floor_sum.hpp">floor_sum.hpp</a></li>
    <li><a href="#modinv.hpp">modinv.hpp</a></li>
    <li><a href="#modpow.hpp">modpow.hpp</a></li>
    <li><a href="#primality.hpp">primality.hpp</a></li>
    <li><a href="#rho.hpp">rho.hpp</a></li>
    </ol>
    <li><a class="section" href="#modint">modint</a></li>
    <ol>
    <li><a href="#BarrettReduction.hpp">BarrettReduction.hpp</a></li>
    <li><a href="#modint.hpp">modint.hpp</a></li>
    </ol>
    <li><a class="section" href="#FPS">FPS</a></li>
    <ol>
    <li><a href="#FFT.hpp">FFT.hpp</a></li>
    <li><a href="#FFT_fast.hpp">FFT_fast.hpp</a></li>
    </ol>
    <li><a class="section" href="#graph">graph</a></li>
    <ol>
    <li><a href="#bi_connected_components.hpp">bi_connected_components.hpp</a></li>
    <li><a href="#eulerian_trail.hpp">eulerian_trail.hpp</a></li>
    <li><a href="#low_link.hpp">low_link.hpp</a></li>
    <li><a href="#max_flow.hpp">max_flow.hpp</a></li>
    <li><a href="#min_cost_flow.hpp">min_cost_flow.hpp</a></li>
    <li><a href="#scc.hpp">scc.hpp</a></li>
    <li><a href="#topological_sort.hpp">topological_sort.hpp</a></li>
    <li><a href="#two_sat.hpp">two_sat.hpp</a></li>
    </ol>
    <li><a class="section" href="#graph/tree">graph/tree</a></li>
    <ol>
    <li><a href="#cartesian_tree.hpp">cartesian_tree.hpp</a></li>
    <li><a href="#hld.hpp">hld.hpp</a></li>
    <li><a href="#offline_lca.hpp">offline_lca.hpp</a></li>
    <li><a href="#rerooting.hpp">rerooting.hpp</a></li>
    </ol>
    <li><a class="section" href="#flow">flow</a></li>
    <ol>
    <li><a href="#燃やす埋める.md">燃やす埋める.md</a></li>
    </ol>
    <li><a class="section" href="#string">string</a></li>
    <ol>
    <li><a href="#KMP.hpp">KMP.hpp</a></li>
    <li><a href="#Manacher.hpp">Manacher.hpp</a></li>
    <li><a href="#RollingHash.hpp">RollingHash.hpp</a></li>
    <li><a href="#SuffixArray.hpp">SuffixArray.hpp</a></li>
    <li><a href="#Zalgorithm.hpp">Zalgorithm.hpp</a></li>
    <li><a href="#aho_corasick.hpp">aho_corasick.hpp</a></li>
    <li><a href="#sa_is.hpp">sa_is.hpp</a></li>
    <li><a href="#trie.hpp">trie.hpp</a></li>
    </ol>
    <li><a class="section" href="#algorithm">algorithm</a></li>
    <ol>
    <li><a href="#doubling.hpp">doubling.hpp</a></li>
    <li><a href="#doubling_monoid.hpp">doubling_monoid.hpp</a></li>
    </ol>
    <li><a class="section" href="#geometry">geometry</a></li>
    <ol>
    <li><a href="#base.hpp">base.hpp</a></li>
    <li><a href="#convex_hull.hpp">convex_hull.hpp</a></li>
    <li><a href="#etc.hpp">etc.hpp</a></li>
    </ol>
    <li><a class="section" href="#memo">memo</a></li>
    <ol>
    <li><a href="#Primes.md">Primes.md</a></li>
    <li><a href="#ext.cpp">ext.cpp</a></li>
    <li><a href="#priority_queue.md">priority_queue.md</a></li>
    </ol>
        </ol>
    </nav>

    
    <h2 class="section" id="template">template</h2>

    <div class="filename">
        <h2 id="hash.sh">hash.sh</h2>
    </div>
    <div class="content content-sh">
    <pre><code><span class="token comment"># 使い方: sh hash.sh -> コピペ -> Ctrl + D</span>
<span class="token comment"># コメント・空白・改行を削除して md5 でハッシュする</span>
g++ <span class="token parameter variable">-dD</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-P</span> <span class="token parameter variable">-fpreprocessed</span> - <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'[:space:]'</span> <span class="token operator">|</span> md5sum <span class="token operator">|</span> <span class="token function">cut</span> -c-6
</code></pre>
</div>

    <div class="filename">
        <h2 id="settings.sh">settings.sh</h2>
    </div>
    <div class="content content-sh">
    <pre><code><span class="token comment"># CLion の設定</span>
Settings → Build → CMake → Reload CMake Project
add_compile_options<span class="token punctuation">(</span>-D_GLIBCXX_DEBUG<span class="token punctuation">)</span>
<span class="token comment"># Caps Lock を Ctrl に変更</span>
setxkbmap <span class="token parameter variable">-option</span> ctrl:nocaps
</code></pre>
</div>

    <div class="filename">
        <h2 id="template.hpp">template.hpp</h2>
        md5: 015ba5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">using</span> ll <span class="token operator">=</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ll INF <span class="token operator">=</span> LLONG_MAX <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">all</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token function">begin</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span></span>
<span class="token keyword">bool</span> <span class="token function">chmin</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">auto</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">></span> b <span class="token operator">?</span> a <span class="token operator">=</span> b<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">bool</span> <span class="token function">chmax</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">auto</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">&lt;</span> b <span class="token operator">?</span> a <span class="token operator">=</span> b<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// your code here...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <h2 class="section" id="data-structure">data-structure</h2>

    <div class="filename">
        <h2 id="2dBIT.hpp">2dBIT.hpp</h2>
        md5: a0e12e

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">BinaryIndexedTree2D</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> H<span class="token punctuation">,</span> W<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span> bit<span class="token punctuation">;</span>

   <span class="token function">BinaryIndexedTree2D</span><span class="token punctuation">(</span><span class="token keyword">int</span> H<span class="token punctuation">,</span> <span class="token keyword">int</span> W<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">H</span><span class="token punctuation">(</span>H<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">W</span><span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">bit</span><span class="token punctuation">(</span>H <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>W <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> T w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> x <span class="token operator">>=</span> H <span class="token operator">||</span> y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> y <span class="token operator">>=</span> W<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">++</span>y<span class="token punctuation">,</span> <span class="token operator">++</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> a <span class="token operator">&lt;=</span> H<span class="token punctuation">;</span> a <span class="token operator">+=</span> a <span class="token operator">&amp;</span> <span class="token operator">-</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> y<span class="token punctuation">;</span> b <span class="token operator">&lt;=</span> W<span class="token punctuation">;</span> b <span class="token operator">+=</span> b <span class="token operator">&amp;</span> <span class="token operator">-</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span> bit<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">+=</span> w<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">imos</span><span class="token punctuation">(</span><span class="token keyword">int</span> x1<span class="token punctuation">,</span> <span class="token keyword">int</span> y1<span class="token punctuation">,</span> <span class="token keyword">int</span> x2<span class="token punctuation">,</span> <span class="token keyword">int</span> y2<span class="token punctuation">,</span> T w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">add</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> <span class="token operator">-</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> <span class="token operator">-</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> x <span class="token operator">>=</span> H <span class="token operator">||</span> y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> y <span class="token operator">>=</span> W<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">>=</span> H<span class="token punctuation">)</span> x <span class="token operator">=</span> H <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">>=</span> W<span class="token punctuation">)</span> y <span class="token operator">=</span> W <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">++</span>y<span class="token punctuation">,</span> <span class="token operator">++</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> a <span class="token operator">-=</span> a <span class="token operator">&amp;</span> <span class="token operator">-</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> y<span class="token punctuation">;</span> b <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">-=</span> b <span class="token operator">&amp;</span> <span class="token operator">-</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span> ret <span class="token operator">+=</span> bit<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> x1<span class="token punctuation">,</span> <span class="token keyword">int</span> y1<span class="token punctuation">,</span> <span class="token keyword">int</span> x2<span class="token punctuation">,</span> <span class="token keyword">int</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">sum</span><span class="token punctuation">(</span>x1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">sum</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>x1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> y1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="BIT.hpp">BIT.hpp</h2>
        md5: 4dd117

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">BIT</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> a<span class="token punctuation">;</span>
   <span class="token function">BIT</span><span class="token punctuation">(</span>ll n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">a</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>ll i<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// A[i] += x</span>
      i<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
         i <span class="token operator">+=</span> i <span class="token operator">&amp;</span> <span class="token operator">-</span>i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">sum</span><span class="token punctuation">(</span>ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         s <span class="token operator">+=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span>
         r <span class="token operator">-=</span> r <span class="token operator">&amp;</span> <span class="token operator">-</span>r<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> s<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">sum</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// sum of A[l, r)</span>
      <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">sum</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="FastSet.hpp">FastSet.hpp</h2>
        md5: 5c5532

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// using u64 = uint64_t;</span>
<span class="token keyword">const</span> u64 B <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">FastSet</span> <span class="token punctuation">{</span>
   u64 n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>u64<span class="token operator">>></span> a<span class="token punctuation">;</span>
   <span class="token function">FastSet</span><span class="token punctuation">(</span>u64 n_<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">n</span><span class="token punctuation">(</span>n_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">do</span> a<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>n_ <span class="token operator">=</span> <span class="token punctuation">(</span>n_ <span class="token operator">+</span> B <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>n_ <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// bool operator[](ll i) const { return a[0][i / B] >> (i % B) &amp; 1; }</span>
   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span>ll i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         v<span class="token punctuation">[</span>i <span class="token operator">/</span> B<span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token number">1ULL</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>
         i <span class="token operator">/=</span> B<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span>ll i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         v<span class="token punctuation">[</span>i <span class="token operator">/</span> B<span class="token punctuation">]</span> <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1ULL</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>i <span class="token operator">/</span> B<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         i <span class="token operator">/=</span> B<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">next</span><span class="token punctuation">(</span>ll i<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// i を超える最⼩の要素</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         i<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">/</span> B <span class="token operator">>=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         u64 d <span class="token operator">=</span> a<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">/</span> B<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span>i <span class="token operator">%</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i <span class="token operator">+=</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>h<span class="token operator">--</span><span class="token punctuation">)</span> i <span class="token operator">=</span> i <span class="token operator">*</span> B <span class="token operator">+</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         i <span class="token operator">/=</span> B<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   ll <span class="token function">prev</span><span class="token punctuation">(</span>ll i<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// i より小さい最⼤の要素</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         i<span class="token operator">--</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         u64 d <span class="token operator">=</span> a<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">/</span> B<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token operator">~</span>i <span class="token operator">%</span> B<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i <span class="token operator">-=</span> <span class="token function">countl_zero</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>h<span class="token operator">--</span><span class="token punctuation">)</span> i <span class="token operator">=</span> i <span class="token operator">*</span> B <span class="token operator">+</span> <span class="token function">__lg</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> i<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         i <span class="token operator">/=</span> B<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="binary_trie.hpp">binary_trie.hpp</h2>
        md5: af8046

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: b75bb1</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">int</span> MAX_LOG <span class="token operator">=</span> <span class="token number">32</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">BinaryTrie</span> <span class="token punctuation">{</span>
   <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
      array<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">></span> next<span class="token punctuation">;</span>
      <span class="token keyword">int</span> common<span class="token punctuation">;</span>
      T lazy<span class="token punctuation">;</span>
      <span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> next<span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>Node<span class="token operator">></span> nodes<span class="token punctuation">;</span>
   <span class="token function">BinaryTrie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">apply_xor</span><span class="token punctuation">(</span>T val<span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">^=</span> val<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> nodes<span class="token punctuation">[</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">^=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>lazy<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> nxt <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
         nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">erase</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">min_element</span><span class="token punctuation">(</span>T val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      T nxt <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ind <span class="token operator">=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> nodes<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token punctuation">.</span>common <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> nxt <span class="token operator">^=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">min_element</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>nxt <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// ddf699</span>

   T <span class="token function">max_element</span><span class="token punctuation">(</span>T val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">min_element</span><span class="token punctuation">(</span><span class="token operator">~</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 5e1a86</span>

   <span class="token keyword">int</span> <span class="token function">lower_bound_rank</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      T nxt <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">lower_bound_rank</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>nxt <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ret <span class="token operator">+=</span> nodes<span class="token punctuation">[</span>nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 05b14c</span>

   <span class="token keyword">int</span> <span class="token function">upper_bound_rank</span><span class="token punctuation">(</span>T val<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_bound_rank</span><span class="token punctuation">(</span>val <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 70e301</span>

   T <span class="token function">kth_smallest</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> lower_ind <span class="token operator">=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> lower_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lower_ind <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> lower_cnt <span class="token operator">=</span> nodes<span class="token punctuation">[</span>lower_ind<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> lower_cnt<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">kth_smallest</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">kth_smallest</span><span class="token punctuation">(</span>k <span class="token operator">-</span> lower_cnt<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token function">T</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// b85845</span>

   T <span class="token function">kth_largest</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">kth_smallest</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>common <span class="token operator">-</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 1df41b</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span>T val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> MAX_LOG <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> b <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> b<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
         cur <span class="token operator">=</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token punctuation">(</span>val <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> nodes<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 2a3342</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>common<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 210f0e</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="ch_segtree.hpp">ch_segtree.hpp</h2>
        md5: 9f5307

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">class</span> <span class="token class-name">ch_segtree</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">const</span> ll inf <span class="token operator">=</span> <span class="token number">1e18</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> n<span class="token punctuation">,</span> n0<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> max_v<span class="token punctuation">,</span> smax_v<span class="token punctuation">,</span> max_c<span class="token punctuation">,</span> min_v<span class="token punctuation">,</span> smin_v<span class="token punctuation">,</span> min_c<span class="token punctuation">,</span> sum<span class="token punctuation">,</span> len<span class="token punctuation">,</span> ladd<span class="token punctuation">,</span> lval<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">update_node_max</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> max_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> inf <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">update_node_min</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> min_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> inf <span class="token operator">&amp;&amp;</span> lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> k<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> inf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">updateall</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">updateall</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> inf<span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>ladd<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">addall</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> ladd<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">addall</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> ladd<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ladd<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update_node_max</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update_node_min</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update_node_max</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update_node_min</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         max_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> max_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> smax_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         max_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> max_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>smax_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> max_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         max_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> max_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> max_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>smax_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> smax_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         min_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>smin_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         min_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> smin_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         min_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> min_c<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>smin_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> smin_v<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">_update_min</span><span class="token punctuation">(</span>ll x<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a <span class="token operator">||</span> max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b <span class="token operator">&amp;&amp;</span> smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">update_node_max</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_update_min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_update_min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">_update_max</span><span class="token punctuation">(</span>ll x<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a <span class="token operator">||</span> x <span class="token operator">&lt;=</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">update_node_min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_update_max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_update_max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">addall</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span>inf<span class="token punctuation">)</span> smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
      min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> inf<span class="token punctuation">)</span> smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>

      sum<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> len<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">!=</span> inf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         ladd<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">updateall</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      smax_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>inf<span class="token punctuation">;</span>
      min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      smin_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> inf<span class="token punctuation">;</span>
      max_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> min_c<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>

      sum<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">*</span> len<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      lval<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      ladd<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">_add_val</span><span class="token punctuation">(</span>ll x<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">addall</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_add_val</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_add_val</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">_update_val</span><span class="token punctuation">(</span>ll x<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">updateall</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_update_val</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_update_val</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   ll <span class="token function">_query_max</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">-</span>inf<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> max_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ll lv <span class="token operator">=</span> <span class="token function">_query_max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ll rv <span class="token operator">=</span> <span class="token function">_query_max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span>lv<span class="token punctuation">,</span> rv<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   ll <span class="token function">_query_min</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> inf<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> min_v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ll lv <span class="token operator">=</span> <span class="token function">_query_min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ll rv <span class="token operator">=</span> <span class="token function">_query_min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span>lv<span class="token punctuation">,</span> rv<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   ll <span class="token function">_query_sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> l <span class="token operator">||</span> r <span class="token operator">&lt;=</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> sum<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token function">push</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ll lv <span class="token operator">=</span> <span class="token function">_query_sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ll rv <span class="token operator">=</span> <span class="token function">_query_sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> lv <span class="token operator">+</span> rv<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token comment">/// @brief セグ木を配列の内容で初期化する</span>
   <span class="token comment">/// @param a セグ木の初期値</span>
   <span class="token function">ch_segtree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      n0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>n0 <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> n0 <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>

      max_v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      smax_v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      max_c<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      min_v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      smin_v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      min_c<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sum<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      len<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ladd<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lval<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n0 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">*</span> n0<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> ladd<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> lval<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> inf<span class="token punctuation">;</span>
      len<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> n0<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n0 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> len<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>len<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> min_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         smax_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>inf<span class="token punctuation">;</span>
         smin_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> inf<span class="token punctuation">;</span>
         max_c<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> min_c<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n0<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> smax_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>inf<span class="token punctuation">;</span>
         min_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> smin_v<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> inf<span class="token punctuation">;</span>
         max_c<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> min_c<span class="token punctuation">[</span>n0 <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n0 <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/// @brief p番目の要素にアクセス</span>
   <span class="token comment">/// @param p アクセスする要素のインデックス(0-indexed)</span>
   <span class="token comment">/// @return p番目の要素</span>
   ll <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">prod_sum</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief p番目の要素をxに変更</span>
   <span class="token comment">/// @param p 変更する要素のインデックス(0-indexed)</span>
   <span class="token comment">/// @param x 変更後の値</span>
   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">apply_update</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)でv[i]←min(v[i],x)</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @param x minをとる値</span>
   <span class="token keyword">void</span> <span class="token function">apply_chmin</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_update_min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)でv[i]←max(v[i],x)</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @param x maxをとる値</span>
   <span class="token keyword">void</span> <span class="token function">apply_chmax</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_update_max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)でv[i]←v[i]+x</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @param x 加算する値</span>
   <span class="token keyword">void</span> <span class="token function">apply_add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_add_val</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)でv[i]←x</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @param x 更新する値</span>
   <span class="token keyword">void</span> <span class="token function">apply_update</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> ll x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">_update_val</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)の最大値を取得</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @return 区間[a,b)の最大値</span>
   ll <span class="token function">prod_max</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">_query_max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)の最小値を取得</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @return 区間[a,b)の最小値</span>
   ll <span class="token function">prod_min</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">_query_min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">/// @brief 区間[a,b)の和を取得</span>
   <span class="token comment">/// @param a 区間の左端(inclusive)</span>
   <span class="token comment">/// @param b 区間の右端(exclusive)</span>
   <span class="token comment">/// @return 区間[a,b)の和</span>
   ll <span class="token function">prod_sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">_query_sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="disjoint_sparse_table.hpp">disjoint_sparse_table.hpp</h2>
        md5: 3df31b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">SG</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">disjoint_sparse_table</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> S <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span>S<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>S<span class="token operator">>></span> st<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> lg<span class="token punctuation">;</span>

   <span class="token function">disjoint_sparse_table</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> b<span class="token operator">++</span><span class="token punctuation">;</span>
      st<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> shift <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> shift <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>j <span class="token operator">+</span> shift<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> t <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> k <span class="token operator">>=</span> j<span class="token punctuation">;</span> k<span class="token operator">--</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> t<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> t <span class="token operator">+</span> shift<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      lg<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>lg<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> lg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> lg<span class="token punctuation">[</span>i <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">>=</span> <span class="token operator">--</span>r<span class="token punctuation">)</span> <span class="token keyword">return</span> st<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> b <span class="token operator">=</span> lg<span class="token punctuation">[</span>l <span class="token operator">^</span> r<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">SG</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> st<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="dsu.hpp">dsu.hpp</h2>
        md5: b55e78

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: d569f4</span>
<span class="token keyword">struct</span> <span class="token class-name">dsu</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> p<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">dsu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">dsu</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">p</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= b &amp;&amp; b &lt; _n);</span>
      <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= b &amp;&amp; b &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">leader</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">;</span>
      <span class="token keyword">int</span> x <span class="token operator">=</span> a<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> x <span class="token operator">=</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> t <span class="token operator">=</span> p<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
         p<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
         a <span class="token operator">=</span> t<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token operator">-</span>p<span class="token punctuation">[</span><span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 818fe7</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">leader_buf</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">group_size</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         group_size<span class="token punctuation">[</span>leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">result</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>group_size<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">remove_if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// bf3a1e</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="lazy_segtree.hpp">lazy_segtree.hpp</h2>
        md5: c86cef

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 918715</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">unsigned</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> x <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">__builtin_ctz</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> <span class="token function">countr_zero_constexpr</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> x<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>op<span class="token punctuation">)</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>mapping<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>composition<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> F<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>id<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">lazy_segtree</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">lazy_segtree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      log <span class="token operator">=</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      d <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> size<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lz <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>F<span class="token operator">></span></span></span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> d<span class="token punctuation">[</span>size <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= p &amp;&amp; p &lt; _n);</span>
      p <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      d<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> log<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= p &amp;&amp; p &lt; _n);</span>
      p <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> d<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= l &amp;&amp; l &lt;= r &amp;&amp; r &lt;= _n);</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      S sml <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> smr <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> sml <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> smr <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token operator">--</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">assert</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> l <span class="token operator">&lt;=</span> r <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> _n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l2 <span class="token operator">=</span> l<span class="token punctuation">,</span> r2 <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">all_apply</span><span class="token punctuation">(</span>l<span class="token operator">++</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token operator">--</span>r<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
            l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         l <span class="token operator">=</span> l2<span class="token punctuation">;</span>
         r <span class="token operator">=</span> r2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> log<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">G</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">max_right</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> G g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= l &amp;&amp; l &lt;= _n);</span>
      <span class="token comment">// assert(g(e()));</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> _n<span class="token punctuation">)</span> <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>l <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token function">push</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
               l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  l<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> l <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token operator">-</span>l<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// d93691</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">G</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">min_left</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> G g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= r &amp;&amp; r &lt;= _n);</span>
      <span class="token comment">// assert(g(e()));</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> log<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         r<span class="token operator">--</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>r <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token function">push</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
               r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  r<span class="token operator">--</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token operator">-</span>r<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// c9a7eb</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">,</span> size<span class="token punctuation">,</span> log<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> d<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>F<span class="token operator">></span> lz<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> d<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k<span class="token punctuation">,</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">all_apply</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lz<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="potential_dsu.hpp">potential_dsu.hpp</h2>
        md5: b2e5eb

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 650ffa</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Abel</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">potential_dsu</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> T <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span>T<span class="token punctuation">;</span>
   <span class="token keyword">int</span> tCount<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> p<span class="token punctuation">,</span> rank<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>T<span class="token operator">></span> potential<span class="token punctuation">;</span>
   <span class="token keyword">int</span> N<span class="token punctuation">;</span>
   <span class="token function">potential_dsu</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      N <span class="token operator">=</span> size<span class="token punctuation">;</span>
      p<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rank<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      potential<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      tCount <span class="token operator">=</span> N<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">leader</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leader</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token comment">// w[y] - w[x] = w</span>
   <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> T w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      w <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">get_potential</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      w <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token function">get_potential</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">link</span><span class="token punctuation">(</span><span class="token function">leader</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">leader</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">leader</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span>
      <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      potential<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>potential<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> potential<span class="token punctuation">[</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   T <span class="token function">get_potential</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">leader</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> potential<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// w[y] - w[x]</span>
   T <span class="token function">diff</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">get_potential</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token function">get_potential</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> tCount<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// 154012</span>

   <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token operator">-</span>p<span class="token punctuation">[</span><span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 818fe7</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">leader_buf</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">group_size</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         group_size<span class="token punctuation">[</span>leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">result</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>group_size<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>leader_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">remove_if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 92d7ce</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">link</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> T w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      tCount<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>rank<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> rank<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
         w <span class="token operator">=</span> <span class="token class-name">Abel</span><span class="token double-colon punctuation">::</span><span class="token function">inv</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>rank<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> rank<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> rank<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      tCount<span class="token operator">--</span><span class="token punctuation">;</span>
      potential<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> w<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*
struct Abel {
   using T = int;
   static T e() { return 0; }
   static T op(T a, T b) { return a + b; }
   static T inv(T a) { return -a; }
};

potential_dsu&lt;Abel> dsu(N);
*/</span></code></pre>
</div>

    <div class="filename">
        <h2 id="range_set.hpp">range_set.hpp</h2>
        md5: 1bc645

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">bool</span> margeAdjacent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">range_set</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">map</span><span class="token operator">&lt;</span><span class="token class-name">ll</span><span class="token punctuation">,</span> <span class="token class-name">ll</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
   <span class="token keyword">auto</span> <span class="token function">get</span><span class="token punctuation">(</span>ll p<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> it <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>it <span class="token operator">==</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">--</span>it<span class="token punctuation">)</span><span class="token operator">-></span>second <span class="token operator">&lt;</span> p<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> it<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> itl <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> itr <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>r <span class="token operator">+</span> margeAdjacent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">!=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">--</span>itl<span class="token punctuation">)</span><span class="token operator">-></span>second <span class="token operator">&lt;</span> l <span class="token operator">-</span> margeAdjacent<span class="token punctuation">)</span> <span class="token operator">++</span>itl<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">!=</span> itr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         l <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> itl<span class="token operator">-></span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
         r <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token function">prev</span><span class="token punctuation">(</span>itr<span class="token punctuation">)</span><span class="token operator">-></span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">erase</span><span class="token punctuation">(</span>itl<span class="token punctuation">,</span> itr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> itl <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> itr <span class="token operator">=</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">!=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">--</span>itl<span class="token punctuation">)</span><span class="token operator">-></span>second <span class="token operator">&lt;</span> l<span class="token punctuation">)</span> <span class="token operator">++</span>itl<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>itl <span class="token operator">==</span> itr<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> tl <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> itl<span class="token operator">-></span>first<span class="token punctuation">)</span><span class="token punctuation">,</span> tr <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token function">prev</span><span class="token punctuation">(</span>itr<span class="token punctuation">)</span><span class="token operator">-></span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">erase</span><span class="token punctuation">(</span>itl<span class="token punctuation">,</span> itr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>tl <span class="token operator">&lt;</span> l<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>tl<span class="token punctuation">]</span> <span class="token operator">=</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> tr<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tr<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span>ll p<span class="token punctuation">,</span> ll q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> it <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> it <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> it<span class="token operator">-></span>first <span class="token operator">&lt;=</span> q <span class="token operator">&amp;&amp;</span> q <span class="token operator">&lt;=</span> it<span class="token operator">-></span>second<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="range_tree.hpp">range_tree.hpp</h2>
        md5: 7f74d5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">M</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">range_tree</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> S <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span>S<span class="token punctuation">;</span>
   <span class="token keyword">using</span> D <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span>D<span class="token punctuation">;</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token operator">>></span> ps<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>K<span class="token operator">></span> xs<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>K<span class="token operator">>></span> ys<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>D<span class="token operator">></span> ds<span class="token punctuation">;</span>
   <span class="token keyword">int</span> n<span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span>K x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">-</span> xs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> K y<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span> ys<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>K x<span class="token punctuation">,</span> K y<span class="token punctuation">)</span> <span class="token punctuation">{</span> ps<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sort</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ps<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
      xs<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">:</span> ps<span class="token punctuation">)</span> xs<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ys<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ds<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ys<span class="token punctuation">[</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">}</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">[</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>K x<span class="token punctuation">,</span> K y<span class="token punctuation">,</span> S a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> ps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> n<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">apply</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
         k <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span>K x1<span class="token punctuation">,</span> K y1<span class="token punctuation">,</span> K x2<span class="token punctuation">,</span> K y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      a <span class="token operator">+=</span> n<span class="token punctuation">;</span>
      b <span class="token operator">+=</span> n<span class="token punctuation">;</span>
      S l <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            l <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">prod</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">++</span>a<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">--</span>b<span class="token punctuation">;</span>
            r <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">prod</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">id</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         a <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         b <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">op</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* 使い方

// モノイド
struct M {
   using S = ll;  // データ(モノイド)の型
   using D = BIT;  // ノードに持たせるデータ構造の型
   static S op(S a, S b) { return a + b; } // Sの二項演算
   static S e() { return 0; }  // Sの単位元
   static D init(int n) { return BIT(n); }  // Dを長さnで初期化する関数
   static void apply(D&amp; bit, int k, const S&amp; v) { bit.add(k, v); } // D のk番目に v を適用する関数
   static S prod(D&amp; bit, int l, int r) { return bit.sum(l, r); } // D の[l, r) に対するクエリを行う関数
};

rt.add(x, y): 座標 (x, y) を追加
rt.build(): クエリを受け付ける準備をする
rt.apply(x, y, a): 座標 (x, y) に a を適用
rt.prod(x1, y1, x2, y2): 座標 x \in [x1, x2), y \in [y1, y2) の領域にクエリを行う
*/</span></code></pre>
</div>

    <div class="filename">
        <h2 id="segtree.hpp">segtree.hpp</h2>
        md5: d32488

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: bafcf8</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">unsigned</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> x <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">__builtin_ctz</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">constexpr</span> <span class="token keyword">int</span> <span class="token function">countr_zero_constexpr</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> x<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>op<span class="token punctuation">)</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">segtree</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">segtree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>S<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      log <span class="token operator">=</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      d <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> size<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> d<span class="token punctuation">[</span>size <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= p &amp;&amp; p &lt; _n);</span>
      p <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      d<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> log<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">update</span><span class="token punctuation">(</span>p <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= p &amp;&amp; p &lt; _n);</span>
      <span class="token keyword">return</span> d<span class="token punctuation">[</span>p <span class="token operator">+</span> size<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= l &amp;&amp; l &lt;= r &amp;&amp; r &lt;= _n);</span>
      S sml <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> smr <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>

      <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> sml <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> smr <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token operator">--</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span>sml<span class="token punctuation">,</span> smr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   S <span class="token function">all_prod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">F</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">max_right</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= l &amp;&amp; l &lt;= _n);</span>
      <span class="token comment">// assert(f(e()));</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> _n<span class="token punctuation">)</span> <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
      l <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> l <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  l<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> l <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>sm<span class="token punctuation">,</span> d<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         l<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&amp;</span> <span class="token operator">-</span>l<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> _n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// faa03f</span>

   <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">F</span><span class="token operator">></span> <span class="token keyword">int</span> <span class="token function">min_left</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= r &amp;&amp; r &lt;= _n);</span>
      <span class="token comment">// assert(f(e()));</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      r <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      S sm <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
         r<span class="token operator">--</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>r <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> r <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  r<span class="token operator">--</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> size<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         sm <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token operator">-</span>r<span class="token punctuation">)</span> <span class="token operator">!=</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// efa466</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">,</span> size<span class="token punctuation">,</span> log<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> d<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span> d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="sparse_table.hpp">sparse_table.hpp</h2>
        md5: f3812e

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">auto</span> op<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">sparse_table</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span> st<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> lg<span class="token punctuation">;</span>

   <span class="token function">sparse_table</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> b<span class="token operator">++</span><span class="token punctuation">;</span>
      st<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> st<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> st<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> st<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      lg<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>lg<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> lg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> lg<span class="token punctuation">[</span>i <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">inline</span> T <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> b <span class="token operator">=</span> lg<span class="token punctuation">[</span>r <span class="token operator">-</span> l<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">op</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> st<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>r <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="treap.hpp">treap.hpp</h2>
        md5: fd1c1c

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: c8a607</span>
<span class="token comment">// mmを使う場合, 追記が必要</span>
<span class="token comment">// friend bool operator==(const mm&amp; a, const mm&amp; b) { return a.x == b.x; }</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>op<span class="token punctuation">)</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token function">S</span> <span class="token punctuation">(</span><span class="token operator">*</span>mapping<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> S<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>composition<span class="token punctuation">)</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span> F<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">F</span> <span class="token punctuation">(</span><span class="token operator">*</span>id<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">Treap</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   mt19937_64 mt<span class="token punctuation">;</span>
   uniform_int_distribution<span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">></span> rand<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> value<span class="token punctuation">,</span> acc<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>F<span class="token operator">></span> lazy<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> priority<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> cnt<span class="token punctuation">,</span> lch<span class="token punctuation">,</span> rch<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> lazy_rev<span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token function">new_node</span><span class="token punctuation">(</span>S v<span class="token punctuation">,</span> ll p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      priority<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cnt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy_rev<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      lch<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rch<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> cnt<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   S <span class="token function">get_acc</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> acc<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
      cnt<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token function">get_acc</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">op</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_acc</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">int</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lazy_rev<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         lazy_rev<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token function">swap</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> lazy_rev<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>lazy_rev<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> lazy_rev<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>lazy_rev<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazy<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> lazy<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            acc<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> acc<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazy<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> lazy<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            acc<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> acc<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         value<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         lazy<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">push</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> r<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> l<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>priority<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> priority<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         rch<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         lch<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> lch<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">update</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> implicit_key <span class="token operator">=</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> implicit_key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
         lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>first<span class="token punctuation">,</span> <span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> k <span class="token operator">-</span> implicit_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
         rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> s <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>first<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">composition</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> lazy<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 905a19 (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">_erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 92ef20 (Common)</span>

   <span class="token keyword">int</span> <span class="token function">erase_range</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 77074b (Common)</span>

   pair<span class="token operator">&lt;</span>S<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S ret <span class="token operator">=</span> acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">//  fe8e6c (Common)</span>

   <span class="token keyword">int</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">,</span> S v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">push</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      value<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
      <span class="token function">update</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 31b211 (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">_find</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> S x<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">bool</span> left <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token function">get_acc</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">==</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">op</span><span class="token punctuation">(</span>acc<span class="token punctuation">[</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token function">find</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token operator">?</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span>
                                             <span class="token operator">:</span> <span class="token function">find</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">op</span><span class="token punctuation">(</span>acc<span class="token punctuation">[</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token function">find</span><span class="token punctuation">(</span>rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">op</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> x<span class="token punctuation">)</span> <span class="token operator">?</span> offset <span class="token operator">+</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">find</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>  <span class="token comment">// b0c65b (Common)</span>

   <span class="token keyword">int</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      lazy_rev<span class="token punctuation">[</span>t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>lazy_rev<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 3f67e3 (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      t <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      t <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l<span class="token punctuation">,</span> l <span class="token operator">+</span> r <span class="token operator">-</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">reverse</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> l <span class="token operator">+</span> r <span class="token operator">-</span> m<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// a5a67c (Unordered)</span>

   <span class="token keyword">int</span> <span class="token function">lower_search</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;=</span> value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t <span class="token operator">=</span> lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ret <span class="token operator">+=</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            t <span class="token operator">=</span> rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 0ef7d9 (Ordered)</span>

   <span class="token keyword">int</span> <span class="token function">upper_search</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> value<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t <span class="token operator">=</span> lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            ret <span class="token operator">+=</span> <span class="token function">get_cnt</span><span class="token punctuation">(</span>lch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            t <span class="token operator">=</span> rch<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// f91898 (Ordered)</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Treap</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>S<span class="token operator">></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">Treap</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>S<span class="token operator">></span> V<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mt <span class="token operator">=</span> <span class="token function">mt19937_64</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">time_since_epoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rand <span class="token operator">=</span> <span class="token generic-function"><span class="token function">uniform_int_distribution</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1e18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> V<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">size_t</span><span class="token punctuation">(</span><span class="token function">get_cnt</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// f63788 (Common)</span>

   <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> ind<span class="token punctuation">,</span> S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> ind<span class="token punctuation">,</span> <span class="token function">new_node</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// dc467c (UnOrdered)</span>

   <span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">new_node</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 7fa616 (Unordered)</span>

   <span class="token keyword">void</span> <span class="token function">ordered_insert</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ind <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>ind<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 539d77 (Ordered)</span>

   <span class="token comment">// Count elements in [lower, upper)</span>
   <span class="token keyword">int</span> <span class="token function">value_range_cnt</span><span class="token punctuation">(</span>S lower<span class="token punctuation">,</span> S upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lower<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> R <span class="token operator">-</span> L<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 2d4406 (Ordered)</span>

   <span class="token comment">// Sum of elements in [lower, upper)</span>
   S <span class="token function">value_range_prod</span><span class="token punctuation">(</span>S lower<span class="token punctuation">,</span> S upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lower<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>L <span class="token operator">==</span> R<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 27b9d4 (Ordered)</span>

   <span class="token comment">// erase element x cnt times (cnt = -1 -> erase all x)</span>
   <span class="token keyword">int</span> <span class="token function">erase_value</span><span class="token punctuation">(</span>S x<span class="token punctuation">,</span> <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> L <span class="token operator">=</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> R <span class="token operator">=</span> <span class="token function">upper_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">chmin</span><span class="token punctuation">(</span>R<span class="token punctuation">,</span> L <span class="token operator">+</span> cnt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">erase_range</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> R <span class="token operator">-</span> L<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 5c60fd (Ordered)</span>

   <span class="token keyword">int</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">lower_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 9731cc (Ordered)</span>

   <span class="token keyword">int</span> <span class="token function">upper_search</span><span class="token punctuation">(</span>S x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">upper_search</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// ac5aa0 (Ordered)</span>

   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> F f<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">apply</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 905a19 (Unordered)</span>

   <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> ind<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">_erase</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> ind<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// ff257f (Common)</span>

   <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// f9ff4a (Common)</span>

   <span class="token comment">// l .. r-1 -> r-1 .. l</span>
   <span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 40df7d (Unordered)</span>

   <span class="token comment">// l .. m-1, m .. r-1 -> m .. r-1, l .. m-1</span>
   <span class="token keyword">void</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">rotate</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// e21b85 (Unordered)</span>

   <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> S v<span class="token punctuation">)</span> <span class="token punctuation">{</span> root <span class="token operator">=</span> <span class="token function">set</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 4ae943 (Unordered)</span>

   <span class="token comment">// min k \in [l,r) such that op(tr[k], x) != x</span>
   <span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> S x<span class="token punctuation">,</span> <span class="token keyword">bool</span> left <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> tt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t2<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> r <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">_find</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span> x<span class="token punctuation">,</span> l<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> ret <span class="token operator">=</span> r<span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 4f1699 (Common)</span>

   S <span class="token function">prod</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">S</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t<span class="token punctuation">,</span> rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> rt<span class="token punctuation">;</span>
      <span class="token keyword">return</span> t<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// c46ac4 (Common)</span>

   S <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> ind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>tt<span class="token punctuation">,</span> t3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> ind <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>tt<span class="token punctuation">,</span> ind<span class="token punctuation">)</span><span class="token punctuation">;</span>
      S ret <span class="token operator">=</span> acc<span class="token punctuation">[</span>t2<span class="token punctuation">]</span><span class="token punctuation">;</span>
      root <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">,</span> t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// d2546e (Common)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="undo_dsu.hpp">undo_dsu.hpp</h2>
        md5: f5d93b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: edf246</span>
<span class="token keyword">struct</span> <span class="token class-name">undo_dsu</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> p<span class="token punctuation">;</span>
   stack<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> history<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">undo_dsu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token keyword">explicit</span> <span class="token function">undo_dsu</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">p</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= b &amp;&amp; b &lt; _n);</span>
      <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token function">leader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span>p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> p<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">+=</span> p<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token keyword">return</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">same</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= b &amp;&amp; b &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">leader</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> a <span class="token operator">=</span> p<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p<span class="token punctuation">[</span>history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span> <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span> <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
      history<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token keyword">int</span> snapshot <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> snapshot<span class="token punctuation">)</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= a &amp;&amp; a &lt; _n);</span>
      <span class="token keyword">return</span> <span class="token operator">-</span>p<span class="token punctuation">[</span><span class="token function">leader</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 818fe7</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="wavelet_matrix.hpp">wavelet_matrix.hpp</h2>
        md5: 208fa9

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: be292e</span>
<span class="token keyword">struct</span> <span class="token class-name">BitVector</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> vec<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">BitVector</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vec<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> vec<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> vec<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> vec<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> i <span class="token operator">-</span> vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">return</span> vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">int</span> bit_len <span class="token operator">=</span> <span class="token number">62</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">WaveletMatrix</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>BitVector<span class="token operator">></span> B<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span> acc<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> so<span class="token punctuation">;</span>
   map<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> sn<span class="token punctuation">;</span>
   <span class="token keyword">int</span> len<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">WaveletMatrix</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>T<span class="token operator">></span> vec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      len <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      acc <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span></span></span><span class="token punctuation">(</span>bit_len<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      so <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>bit_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">v</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token generic-function"><span class="token function">b</span> <span class="token generic class-name"><span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         vector<span class="token operator">&lt;</span>T<span class="token operator">></span> cur<span class="token punctuation">;</span>
         cur<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
         vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">bi</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ll bit <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span></span></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>bit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               cur<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               bi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         so<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ll bit <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>bit <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               cur<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               bi<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         B<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">BitVector</span><span class="token punctuation">(</span>bi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>B<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> acc<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            acc<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> acc<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         v <span class="token operator">=</span> cur<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> sn<span class="token punctuation">[</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   T <span class="token function">access</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> bit <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ret <span class="token operator">=</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> bit<span class="token punctuation">;</span>
         i <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> bit<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 3be264</span>

   <span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span>T val<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>sn<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> bit <span class="token operator">=</span> <span class="token punctuation">(</span>val <span class="token operator">>></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         i <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> bit<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> i <span class="token operator">-</span> sn<span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 88f41a</span>

   T <span class="token function">kthMin</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> cnt <span class="token operator">=</span> r <span class="token operator">-</span> l<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> l<span class="token punctuation">;</span>
            right <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            k <span class="token operator">-=</span> cnt<span class="token punctuation">;</span>
            left <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">;</span>
            right <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>
            ret <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 941aa0</span>

   T <span class="token function">kMinSum</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> cnt <span class="token operator">=</span> r <span class="token operator">-</span> l<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>cnt <span class="token operator">></span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> l<span class="token punctuation">;</span>
            right <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            k <span class="token operator">-=</span> cnt<span class="token punctuation">;</span>
            ret <span class="token operator">+=</span> acc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> acc<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>
            left <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">;</span>
            right <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// edb4f5</span>

   <span class="token keyword">int</span> <span class="token function">lessCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> T upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>upper <span class="token operator">>=</span> <span class="token punctuation">(</span><span class="token number">1LL</span> <span class="token operator">&lt;&lt;</span> bit_len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bit_len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> r <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> cnt <span class="token operator">=</span> r <span class="token operator">-</span> l<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>upper <span class="token operator">>></span> <span class="token punctuation">(</span>bit_len <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ret <span class="token operator">+=</span> cnt<span class="token punctuation">;</span>
            left <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">;</span>
            right <span class="token operator">+=</span> so<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> l<span class="token punctuation">;</span>
            right <span class="token operator">=</span> r<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 029c6d</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="math">math</h2>

    <div class="filename">
        <h2 id="BinaryGCD.hpp">BinaryGCD.hpp</h2>
        md5: f3ab31

    </div>
    <div class="content content-hpp">
    <pre><code>u64 <span class="token function">ctz</span><span class="token punctuation">(</span>u64 x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">countr_zero</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
u64 <span class="token function">binary_gcd</span><span class="token punctuation">(</span>u64 x<span class="token punctuation">,</span> u64 y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>x <span class="token operator">||</span> <span class="token operator">!</span>y<span class="token punctuation">)</span> <span class="token keyword">return</span> x <span class="token operator">|</span> y<span class="token punctuation">;</span>
   u64 n <span class="token operator">=</span> <span class="token function">ctz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token function">ctz</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
   x <span class="token operator">>>=</span> n<span class="token punctuation">,</span> y <span class="token operator">>>=</span> m<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">></span> y<span class="token punctuation">)</span> x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token function">ctz</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> y <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token function">ctz</span><span class="token punctuation">(</span>y <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> x <span class="token operator">&lt;&lt;</span> <span class="token function">min</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="ExtGCD.hpp">ExtGCD.hpp</h2>
        md5: c3fa9b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// returns gcd(a, b) and assign x, y to integers</span>
<span class="token comment">// s.t. ax + by = gcd(a, b) and |x| + |y| is minimized</span>
ll <span class="token function">extgcd</span><span class="token punctuation">(</span>ll a<span class="token punctuation">,</span> ll b<span class="token punctuation">,</span> ll<span class="token operator">&amp;</span> x<span class="token punctuation">,</span> ll<span class="token operator">&amp;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// assert(a >= 0 &amp;&amp; b >= 0);</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token keyword">return</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">;</span>
   ll d <span class="token operator">=</span> <span class="token function">extgcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   y <span class="token operator">-=</span> a <span class="token operator">/</span> b <span class="token operator">*</span> x<span class="token punctuation">;</span>
   <span class="token keyword">return</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="crt.hpp">crt.hpp</h2>
        md5: 338cb4

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// mが互いに素になるように前処理</span>
<span class="token comment">// lcm(m) % MODを返す</span>
<span class="token comment">// crtの解がなければ-1を返す</span>
ll <span class="token function">pre_garner</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> b<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span><span class="token operator">&amp;</span> m<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll res <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ll g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> g <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/=</span> g<span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/=</span> g<span class="token punctuation">;</span>
         ll gi <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ll gj <span class="token operator">=</span> g <span class="token operator">/</span> gi<span class="token punctuation">;</span>
         <span class="token keyword">do</span> <span class="token punctuation">{</span>
            g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span>gi<span class="token punctuation">,</span> gj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            gi <span class="token operator">*=</span> g<span class="token punctuation">;</span>
            gj <span class="token operator">/=</span> g<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> gi<span class="token punctuation">;</span>
         m<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*=</span> gj<span class="token punctuation">;</span>
         b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         b<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>res <span class="token operator">*=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// m が互いに素であることが保証されている場合</span>
<span class="token comment">// b[i] = x (mod m[i]) となる最小の x \le 0 を求める</span>
ll <span class="token function">garner</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> b<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> m<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   m<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>MOD<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">coeffs</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">constants</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">-</span> constants<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">modinv</span><span class="token punctuation">(</span>coeffs<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> t <span class="token operator">+=</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token punctuation">(</span>constants<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> t <span class="token operator">*</span> coeffs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">(</span>coeffs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> constants<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="eratos.hpp">eratos.hpp</h2>
        md5: 0de96f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">void</span> <span class="token function">eratos</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span><span class="token operator">&amp;</span> isprime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   isprime <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   isprime<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   isprime<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> last <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sqrt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> last<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>isprime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> i<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            isprime<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            j <span class="token operator">+=</span> i<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="factorize.hpp">factorize.hpp</h2>
        md5: 8e6dd4

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// \sqrt(n)の素因数分解 a01341</span>
map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">prime_factor</span><span class="token punctuation">(</span>ll n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> ret<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">*</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>n <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ret<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
         n <span class="token operator">/=</span> i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> ret<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 線形篩 1f4de3</span>
vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">preprocess</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   n<span class="token operator">++</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">res</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   std<span class="token double-colon punctuation">::</span><span class="token function">iota</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">*</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">*</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j <span class="token operator">+=</span> i<span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> j<span class="token punctuation">)</span> res<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">prime_factor</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> lp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> ret<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ret<span class="token punctuation">[</span>lp<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      n <span class="token operator">/=</span> lp<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="floor_sum.hpp">floor_sum.hpp</h2>
        md5: 0f7242

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">floor_sum</span><span class="token punctuation">(</span><span class="token keyword">const</span> ll<span class="token operator">&amp;</span> n<span class="token punctuation">,</span> <span class="token keyword">const</span> ll<span class="token operator">&amp;</span> m<span class="token punctuation">,</span> ll a<span class="token punctuation">,</span> ll b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">>=</span> m<span class="token punctuation">)</span> ret <span class="token operator">+=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">/</span> m<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> a <span class="token operator">%=</span> m<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">>=</span> m<span class="token punctuation">)</span> ret <span class="token operator">+=</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>b <span class="token operator">/</span> m<span class="token punctuation">)</span><span class="token punctuation">,</span> b <span class="token operator">%=</span> m<span class="token punctuation">;</span>
   ll y <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> n <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">/</span> m<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   ll x <span class="token operator">=</span> y <span class="token operator">*</span> m <span class="token operator">-</span> b<span class="token punctuation">;</span>
   ret <span class="token operator">+=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">;</span>
   ret <span class="token operator">+=</span> <span class="token function">floor_sum</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> a<span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> x <span class="token operator">%</span> a<span class="token punctuation">)</span> <span class="token operator">%</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="modinv.hpp">modinv.hpp</h2>
        md5: a0de19

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">modinv</span><span class="token punctuation">(</span>ll a<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll b <span class="token operator">=</span> MOD<span class="token punctuation">,</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll t <span class="token operator">=</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
      a <span class="token operator">-=</span> t <span class="token operator">*</span> b<span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      u <span class="token operator">-=</span> t <span class="token operator">*</span> v<span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   u <span class="token operator">%=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>u <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> u <span class="token operator">+=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">return</span> u<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="modpow.hpp">modpow.hpp</h2>
        md5: 6b940c

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">modpow</span><span class="token punctuation">(</span>ll a<span class="token punctuation">,</span> ll n<span class="token punctuation">,</span> ll MOD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> T <span class="token operator">=</span> __int128_t<span class="token punctuation">;</span>
   <span class="token comment">// using T = ll;</span>
   T res <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   T mul <span class="token operator">=</span> a<span class="token punctuation">;</span>
   mul <span class="token operator">%=</span> MOD<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n <span class="token operator">=</span> <span class="token operator">-</span>n<span class="token punctuation">;</span>
      mul <span class="token operator">=</span> <span class="token function">modinv</span><span class="token punctuation">(</span>mul<span class="token punctuation">,</span> MOD<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token operator">*</span> mul<span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>
      mul <span class="token operator">=</span> <span class="token punctuation">(</span>mul <span class="token operator">*</span> mul<span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>
      n <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token function">ll</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="primality.hpp">primality.hpp</h2>
        md5: d6eb6a

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">bool</span> <span class="token function">is_prime</span><span class="token punctuation">(</span>ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> N <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   ll s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   ll d <span class="token operator">=</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>d <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      s<span class="token operator">++</span><span class="token punctuation">;</span>
      d <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> tests <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> a <span class="token operator">:</span> tests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">==</span> N<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      ll X <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> d<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>X <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>X <span class="token operator">!=</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         X <span class="token operator">=</span> <span class="token function">modpow</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
         r<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>X <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> r <span class="token operator">==</span> s<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="rho.hpp">rho.hpp</h2>
        md5: 820144

    </div>
    <div class="content content-hpp">
    <pre><code>ll <span class="token function">find_prime_factor</span><span class="token punctuation">(</span>ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> i128 <span class="token operator">=</span> __int128_t<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>ll c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>ll a<span class="token punctuation">)</span> <span class="token operator">-></span> ll <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">modpow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">+</span> c<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      ll y <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
      ll g <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      i128 q <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      ll ys <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      ll x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         x <span class="token operator">=</span> y<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">*</span> r <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            k<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> r <span class="token operator">&amp;&amp;</span> g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ys <span class="token operator">=</span> y<span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">min</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> r <span class="token operator">-</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
               q <span class="token operator">*=</span> <span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
               q <span class="token operator">%=</span> N<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token function">ll</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
            k <span class="token operator">+=</span> b<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         k <span class="token operator">=</span> r<span class="token punctuation">;</span>
         r <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>g <span class="token operator">==</span> N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         g <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         y <span class="token operator">=</span> ys<span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            g <span class="token operator">=</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>g <span class="token operator">==</span> N<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_prime</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> g<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_prime</span><span class="token punctuation">(</span>N <span class="token operator">/</span> g<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> N <span class="token operator">/</span> g<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">find_prime_factor</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">factorize</span><span class="token punctuation">(</span>ll N<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> ret<span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_prime</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> N <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll p <span class="token operator">=</span> <span class="token function">find_prime_factor</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>N <span class="token operator">%</span> p <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         N <span class="token operator">/=</span> p<span class="token punctuation">;</span>
         s<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      ret<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>N <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ret<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <h2 class="section" id="modint">modint</h2>

    <div class="filename">
        <h2 id="BarrettReduction.hpp">BarrettReduction.hpp</h2>
        md5: 2ca7f3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// using u64 = uint64_t;</span>
<span class="token keyword">struct</span> <span class="token class-name">Barrett</span> <span class="token punctuation">{</span>  <span class="token comment">// mod &lt; 2^32</span>
   u64 m<span class="token punctuation">,</span> im<span class="token punctuation">;</span>
   <span class="token function">Barrett</span><span class="token punctuation">(</span>u64 mod<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">im</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1ULL</span> <span class="token operator">/</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token comment">// input: a * b &lt; 2^64, output: a * b % mod</span>
   u64 <span class="token function">mul</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      a <span class="token operator">*=</span> b<span class="token punctuation">;</span>
      u64 x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__uint128_t<span class="token punctuation">)</span>a <span class="token operator">*</span> im<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">64</span><span class="token punctuation">;</span>
      a <span class="token operator">-=</span> x <span class="token operator">*</span> m<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span>a <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> a <span class="token operator">+=</span> m<span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="modint.hpp">modint.hpp</h2>
        md5: 81b530

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">const</span> ll mod <span class="token operator">=</span> <span class="token number">998244353</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">mm</span> <span class="token punctuation">{</span>
   ll x<span class="token punctuation">;</span>
   <span class="token function">mm</span><span class="token punctuation">(</span>ll x_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>x_ <span class="token operator">%</span> mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> x <span class="token operator">+=</span> mod<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm <span class="token keyword">operator</span><span class="token operator">/</span><span class="token punctuation">(</span>mm a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token comment">// 4 行コピペ  Alt + Shift + クリックで複数カーソル</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">-=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a<span class="token punctuation">.</span>x <span class="token operator">*</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token keyword">friend</span> mm<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">/=</span><span class="token punctuation">(</span>mm<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> mm b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   mm <span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   mm <span class="token function">pow</span><span class="token punctuation">(</span>ll b<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
      mm a <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> c <span class="token operator">*=</span> a<span class="token punctuation">;</span>
         a <span class="token operator">*=</span> a<span class="token punctuation">;</span>
         b <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> c<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <h2 class="section" id="FPS">FPS</h2>

    <div class="filename">
        <h2 id="FFT.hpp">FFT.hpp</h2>
        md5: 6e60c3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// {998244353, 3}, {1811939329, 13}, {2013265921, 31}</span>
mm g <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// 原始根</span>
<span class="token keyword">void</span> <span class="token function">fft</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> lg <span class="token operator">=</span> <span class="token function">__lg</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> lg<span class="token punctuation">)</span> <span class="token operator">==</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">b</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> l <span class="token operator">&lt;=</span> lg<span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll w <span class="token operator">=</span> n <span class="token operator">>></span> l<span class="token punctuation">;</span>
      mm s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">>></span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>ll u <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> u <span class="token operator">&lt;</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> u <span class="token operator">+=</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> d <span class="token operator">&lt;</span> w<span class="token punctuation">;</span> d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mm x <span class="token operator">=</span> a<span class="token punctuation">[</span>u <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> d<span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> a<span class="token punctuation">[</span>u <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> w <span class="token operator">|</span> d<span class="token punctuation">]</span> <span class="token operator">*</span> s<span class="token punctuation">;</span>
            b<span class="token punctuation">[</span>u <span class="token operator">|</span> d<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
            b<span class="token punctuation">[</span>n <span class="token operator">>></span> <span class="token number">1</span> <span class="token operator">|</span> u <span class="token operator">|</span> d<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         s <span class="token operator">*=</span> r<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">conv</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> a<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> b<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   size_t s <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// if(min(sz(a), sz(b)) &lt;= 60) 愚直に掛け算</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   b<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   mm inv <span class="token operator">=</span> <span class="token function">mm</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> inv<span class="token punctuation">;</span>
   <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token function">all</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="FFT_fast.hpp">FFT_fast.hpp</h2>
        md5: 33f77f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// modint を u32 にして加減算を真面目にやると速い</span>
mm g <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// 原始根</span>
<span class="token keyword">void</span> <span class="token function">fft</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> lg <span class="token operator">=</span> <span class="token function">__lg</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">auto</span> z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mm s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         z<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> s <span class="token operator">*</span> g<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         s <span class="token operator">*=</span> g<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> z<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> lg<span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll w <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>lg <span class="token operator">-</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mm s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ll o <span class="token operator">=</span> k <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>lg <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> o<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> o <span class="token operator">+</span> w<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mm x <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> w<span class="token punctuation">]</span> <span class="token operator">*</span> s<span class="token punctuation">;</span>
            a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
            a<span class="token punctuation">[</span>i <span class="token operator">+</span> w<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         s <span class="token operator">*=</span> z<span class="token punctuation">[</span><span class="token generic-function"><span class="token function">countr_zero</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">~</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// コピペ</span>
<span class="token keyword">void</span> <span class="token function">ifft</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span><span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> lg <span class="token operator">=</span> <span class="token function">__lg</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">auto</span> z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mm s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// g を逆数に</span>
         z<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> s <span class="token operator">*</span> g<span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
         s <span class="token operator">*=</span> g<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>mod <span class="token operator">>></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> z<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>ll l <span class="token operator">=</span> lg<span class="token punctuation">;</span> l<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 逆順に</span>
      ll w <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>lg <span class="token operator">-</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mm s <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ll o <span class="token operator">=</span> k <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>lg <span class="token operator">-</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> o<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> o <span class="token operator">+</span> w<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mm x <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> y <span class="token operator">=</span> a<span class="token punctuation">[</span>i <span class="token operator">+</span> w<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// *s を下に移動</span>
            a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
            a<span class="token punctuation">[</span>i <span class="token operator">+</span> w<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> s<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         s <span class="token operator">*=</span> z<span class="token punctuation">[</span><span class="token generic-function"><span class="token function">countr_zero</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">~</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> <span class="token function">conv</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> a<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>mm<span class="token operator">></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> b<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   size_t s <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token function">bit_ceil</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// if(min(size(a), size(b)) &lt;= 60) 愚直に掛け算</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   b<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">fft</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   mm inv <span class="token operator">=</span> <span class="token function">mm</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> inv<span class="token punctuation">;</span>
   <span class="token function">ifft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
   a<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <h2 class="section" id="graph">graph</h2>

    <div class="filename">
        <h2 id="bi_connected_components.hpp">bi_connected_components.hpp</h2>
        md5: 9883af

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">BiConnectedComponents</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">LowLink</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>bridge<span class="token punctuation">;</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>g<span class="token punctuation">;</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>low<span class="token punctuation">;</span>
   <span class="token keyword">using</span> LowLink<span class="token double-colon punctuation">::</span>ord<span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> comp<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> tree<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> group<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      comp<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      group<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> group<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      tree<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> bridge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         tree<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         tree<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>e<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">explicit</span> <span class="token function">BiConnectedComponents</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">LowLink</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">build</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> used<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> tmp<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> pre<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>pre <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ord<span class="token punctuation">[</span>pre<span class="token punctuation">]</span> <span class="token operator">>=</span> low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> comp<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> comp<span class="token punctuation">[</span>pre<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> comp<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="eulerian_trail.hpp">eulerian_trail.hpp</h2>
        md5: 89bed1

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 72bf84</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">bool</span> directed<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">EulerianTrail</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">></span> G<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> es<span class="token punctuation">;</span>
   <span class="token keyword">int</span> M<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> usedV<span class="token punctuation">,</span> usedE<span class="token punctuation">,</span> deg<span class="token punctuation">;</span>

   <span class="token function">EulerianTrail</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">G</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">deg</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">usedV</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      es<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      G<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>directed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         deg<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
         deg<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         G<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token punctuation">;</span>
         deg<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
         deg<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      M<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> st<span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ord<span class="token punctuation">;</span>
      st<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> i <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">;</span>
         usedV<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ord<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> e <span class="token operator">=</span> G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>usedE<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            usedE<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>directed <span class="token operator">&amp;&amp;</span> es<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">!=</span> i<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>es<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> es<span class="token punctuation">[</span>e<span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      ord<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ord<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ord<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">enumerate_et</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>directed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> deg<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> deg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      usedE<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> ret<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> usedV<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         ret<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">go</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// a9700f</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">enumerate_semi_et</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dsu <span class="token function">d</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> es<span class="token punctuation">)</span> d<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>first<span class="token punctuation">,</span> p<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> group<span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">leader</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> ret<span class="token punctuation">;</span>
      usedE<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> vs <span class="token operator">:</span> group<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>vs<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> latte <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> malta <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>directed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> vs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>deg<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
               <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>deg<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>latte <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                  latte <span class="token operator">=</span> p<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> p <span class="token operator">:</span> vs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>deg<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span><span class="token punctuation">(</span>latte <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> latte <span class="token operator">=</span> p<span class="token punctuation">;</span>
                  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>malta <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> malta <span class="token operator">=</span> p<span class="token punctuation">;</span>
                  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         ret<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">go</span><span class="token punctuation">(</span>latte <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> vs<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> latte<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> ret<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 97a2af</span>

   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">get_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> es<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// c83977</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="low_link.hpp">low_link.hpp</h2>
        md5: 862a6c

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">LowLink</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> g<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ord<span class="token punctuation">,</span> low<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> articulation<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> visited<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> bridge<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> pre<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      visited<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      ord<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">bool</span> isArticulation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> beet <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>to <span class="token operator">==</span> pre <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">exchange</span><span class="token punctuation">(</span>beet<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cnt<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">chmin</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> low<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            isArticulation <span class="token operator">|=</span> pre <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> low<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">>=</span> ord<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ord<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">&lt;</span> low<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> bridge<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token function">chmin</span><span class="token punctuation">(</span>low<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> ord<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      isArticulation <span class="token operator">|=</span> pre <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> cnt <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>isArticulation<span class="token punctuation">)</span> articulation<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> n <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token operator">-></span>g <span class="token operator">=</span> g<span class="token punctuation">;</span>
      ord<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      low<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      visited<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token function">LowLink</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">build</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="max_flow.hpp">max_flow.hpp</h2>
        md5: a7f1d5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 9927a4</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Cap</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">mf_graph</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">mf_graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">mf_graph</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">,</span> Cap cap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= from &amp;&amp; from &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= to &amp;&amp; to &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= cap);</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pos<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>from<span class="token punctuation">,</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> from_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> to_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>from <span class="token operator">==</span> to<span class="token punctuation">)</span> to_id<span class="token operator">++</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>to<span class="token punctuation">,</span> to_id<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>from<span class="token punctuation">,</span> from_id<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> m<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   Cap <span class="token function">flow</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> Cap flow_limit <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cap<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= s &amp;&amp; s &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= t &amp;&amp; t &lt; _n);</span>
      <span class="token comment">// assert(s != t);</span>

      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">level</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">iter</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> que<span class="token punctuation">;</span>
      <span class="token keyword">auto</span> bfs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         level<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> e <span class="token operator">:</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> level<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
               level<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> level<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>to <span class="token operator">==</span> t<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
               que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> dfs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> self<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">,</span> Cap up<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> s<span class="token punctuation">)</span> <span class="token keyword">return</span> up<span class="token punctuation">;</span>
         Cap res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> level_v <span class="token operator">=</span> level<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;</span> i <span class="token operator">=</span> iter<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _edge<span class="token operator">&amp;</span> e <span class="token operator">=</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>level_v <span class="token operator">&lt;=</span> level<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">||</span> g<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            Cap d <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> e<span class="token punctuation">.</span>to<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>up <span class="token operator">-</span> res<span class="token punctuation">,</span> g<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">+=</span> d<span class="token punctuation">;</span>
            g<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">-=</span> d<span class="token punctuation">;</span>
            res <span class="token operator">+=</span> d<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> up<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      Cap flow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>flow <span class="token operator">&lt;</span> flow_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>level<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span>flow <span class="token operator">&lt;</span> flow_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Cap f <span class="token operator">=</span> <span class="token function">dfs</span><span class="token punctuation">(</span>dfs<span class="token punctuation">,</span> t<span class="token punctuation">,</span> flow_limit <span class="token operator">-</span> flow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>f<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            flow <span class="token operator">+=</span> f<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">min_cut</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">visited</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> que<span class="token punctuation">;</span>
      que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      visited<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> e <span class="token operator">:</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>cap <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>visited<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               visited<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
               que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> visited<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 8735cf</span>

   <span class="token keyword">struct</span> <span class="token class-name">edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> from<span class="token punctuation">,</span> to<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">,</span> flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 9fe107</span>

   edge <span class="token function">get_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// assert(0 &lt;= i &amp;&amp; i &lt; m);</span>
      <span class="token keyword">auto</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> edge<span class="token punctuation">{</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>to<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>cap <span class="token operator">+</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// ad4299</span>

   vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> <span class="token function">edges</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> result<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">get_edge</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 5948b8</span>

   <span class="token keyword">void</span> <span class="token function">change_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> Cap new_cap<span class="token punctuation">,</span> Cap new_flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// assert(0 &lt;= i &amp;&amp; i &lt; m);</span>
      <span class="token comment">// assert(0 &lt;= new_flow &amp;&amp; new_flow &lt;= new_cap);</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      _e<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_cap <span class="token operator">-</span> new_flow<span class="token punctuation">;</span>
      _re<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 558c35</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   <span class="token keyword">struct</span> <span class="token class-name">_edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> to<span class="token punctuation">,</span> rev<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> pos<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>_edge<span class="token operator">>></span> g<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="min_cost_flow.hpp">min_cost_flow.hpp</h2>
        md5: 17d51b

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 4e9f1c</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Cap</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Cost</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">mcf_graph</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">mcf_graph</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">mcf_graph</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">,</span> Cap cap<span class="token punctuation">,</span> Cost cost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= from &amp;&amp; from &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= to &amp;&amp; to &lt; _n);</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pos<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>from<span class="token punctuation">,</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> from_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> to_id <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>from <span class="token operator">==</span> to<span class="token punctuation">)</span> to_id<span class="token operator">++</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>to<span class="token punctuation">,</span> to_id<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>_edge<span class="token punctuation">{</span>from<span class="token punctuation">,</span> from_id<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> m<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   pair<span class="token operator">&lt;</span>Cap<span class="token punctuation">,</span> Cost<span class="token operator">></span> <span class="token function">flow</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> Cap flow_limit <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cap<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">slope</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">,</span> flow_limit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>Cap<span class="token punctuation">,</span> Cost<span class="token operator">>></span> <span class="token function">slope</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> Cap flow_limit <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cap<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= s &amp;&amp; s &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= t &amp;&amp; t &lt; _n);</span>
      <span class="token comment">// assert(s != t);</span>
      vector<span class="token operator">&lt;</span>Cost<span class="token operator">></span> <span class="token function">dual</span><span class="token punctuation">(</span>_n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dist</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">pv</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pe</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">vis</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> dual_ref <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>Cost<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>pv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>pe<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>vis<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">struct</span> <span class="token class-name">Q</span> <span class="token punctuation">{</span>
            Cost key<span class="token punctuation">;</span>
            <span class="token keyword">int</span> to<span class="token punctuation">;</span>
            <span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> Q<span class="token operator">&amp;</span> r<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key <span class="token operator">></span> r<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
         priority_queue<span class="token operator">&lt;</span>Q<span class="token operator">></span> que<span class="token punctuation">;</span>
         dist<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Q<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> v <span class="token operator">=</span> que<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">;</span>
            que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
            vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> t<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">auto</span> e <span class="token operator">=</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token operator">!</span>e<span class="token punctuation">.</span>cap<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
               Cost cost <span class="token operator">=</span> e<span class="token punctuation">.</span>cost <span class="token operator">-</span> dual<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">+</span> dual<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmin</span><span class="token punctuation">(</span>dist<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+</span> cost<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  pv<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
                  pe<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                  que<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Q<span class="token punctuation">{</span>dist<span class="token punctuation">[</span>e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>to<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>vis<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> v <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> v<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>vis<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> dual<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">-=</span> dist<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">-</span> dist<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      Cap flow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      Cap cost <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> prev_cost_per_flow <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>Cap<span class="token punctuation">,</span> Cost<span class="token operator">>></span> result<span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>flow<span class="token punctuation">,</span> cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>flow <span class="token operator">&lt;</span> flow_limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">dual_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         Cap c <span class="token operator">=</span> flow_limit <span class="token operator">-</span> flow<span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">=</span> t<span class="token punctuation">;</span> v <span class="token operator">!=</span> s<span class="token punctuation">;</span> v <span class="token operator">=</span> pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> c <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">[</span>pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>pe<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">=</span> t<span class="token punctuation">;</span> v <span class="token operator">!=</span> s<span class="token punctuation">;</span> v <span class="token operator">=</span> pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">=</span> g<span class="token punctuation">[</span>pv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>pe<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>cap <span class="token operator">-=</span> c<span class="token punctuation">;</span>
            g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">.</span>cap <span class="token operator">+=</span> c<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         Cost d <span class="token operator">=</span> <span class="token operator">-</span>dual<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>
         flow <span class="token operator">+=</span> c<span class="token punctuation">;</span>
         cost <span class="token operator">+=</span> c <span class="token operator">*</span> d<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>prev_cost_per_flow <span class="token operator">==</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span> result<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
         result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>flow<span class="token punctuation">,</span> cost<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         prev_cost_per_flow <span class="token operator">=</span> d<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">struct</span> <span class="token class-name">edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> from<span class="token punctuation">,</span> to<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">,</span> flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 9fe107</span>

   edge <span class="token function">get_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// assert(0 &lt;= i &amp;&amp; i &lt; m);</span>
      <span class="token keyword">auto</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">edge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>to<span class="token punctuation">,</span> _e<span class="token punctuation">.</span>cap <span class="token operator">+</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> _re<span class="token punctuation">.</span>cap<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// d7bd7e</span>

   vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> <span class="token function">edges</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>edge<span class="token operator">></span> result<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">get_edge</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 5948b8</span>

   <span class="token keyword">void</span> <span class="token function">change_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> Cap new_cap<span class="token punctuation">,</span> Cap new_flow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// assert(0 &lt;= i &amp;&amp; i &lt; m);</span>
      <span class="token comment">// assert(0 &lt;= new_flow &amp;&amp; new_flow &lt;= new_cap);</span>

      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _e <span class="token operator">=</span> g<span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">[</span>pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span><span class="token operator">&amp;</span> _re <span class="token operator">=</span> g<span class="token punctuation">[</span>_e<span class="token punctuation">.</span>to<span class="token punctuation">]</span><span class="token punctuation">[</span>_e<span class="token punctuation">.</span>rev<span class="token punctuation">]</span><span class="token punctuation">;</span>
      _e<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_cap <span class="token operator">-</span> new_flow<span class="token punctuation">;</span>
      _re<span class="token punctuation">.</span>cap <span class="token operator">=</span> new_flow<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 558c35</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   <span class="token keyword">struct</span> <span class="token class-name">_edge</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> to<span class="token punctuation">,</span> rev<span class="token punctuation">;</span>
      Cap cap<span class="token punctuation">;</span>
      Cost cost<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span> pos<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>_edge<span class="token operator">>></span> g<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="scc.hpp">scc.hpp</h2>
        md5: 9f5fd6

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 3085f6</span>
<span class="token keyword">struct</span> <span class="token class-name">scc_graph</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">explicit</span> <span class="token function">scc_graph</span><span class="token punctuation">(</span><span class="token keyword">int</span> _n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">n</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">G</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rG</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">comp</span><span class="token punctuation">(</span>_n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">visited</span><span class="token punctuation">(</span>_n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= from &amp;&amp; from &lt; n);</span>
      <span class="token comment">// assert(0 &lt;= to &amp;&amp; to &lt; n);</span>
      G<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      rG<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">scc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>visited<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      order<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      comp_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>order<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">rdfs</span><span class="token punctuation">(</span>order<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> comp_size<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">v</span><span class="token punctuation">(</span>comp_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> v<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> v<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">get_comp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> comp<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// bdafc0</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">dag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> <span class="token function">res</span><span class="token punctuation">(</span>comp_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> j <span class="token operator">:</span> G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> comp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> res<span class="token punctuation">[</span>comp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> comp_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 312650</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> G<span class="token punctuation">,</span> rG<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> order<span class="token punctuation">,</span> comp<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> visited<span class="token punctuation">;</span>
   <span class="token keyword">int</span> n<span class="token punctuation">,</span> comp_size<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> G<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      order<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">rdfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      comp<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> to <span class="token operator">:</span> rG<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">rdfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="topological_sort.hpp">topological_sort.hpp</h2>
        md5: 024d40

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">topological_sort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">indeg</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">:</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> indeg<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">;</span>
   queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> q<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>indeg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>q<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">auto</span> v <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      q<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> u <span class="token operator">:</span> g<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         indeg<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>indeg<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="two_sat.hpp">two_sat.hpp</h2>
        md5: 681721

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">struct</span> <span class="token class-name">two_sat</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">two_sat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">scc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token function">two_sat</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_n</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">scc</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_answer</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_clause</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">bool</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">,</span> <span class="token keyword">bool</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// assert(0 &lt;= i &amp;&amp; i &lt; _n);</span>
      <span class="token comment">// assert(0 &lt;= j &amp;&amp; j &lt; _n);</span>
      scc<span class="token punctuation">.</span><span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token punctuation">(</span>f <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token punctuation">(</span>g <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      scc<span class="token punctuation">.</span><span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> j <span class="token operator">+</span> <span class="token punctuation">(</span>g <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token punctuation">(</span>f <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">bool</span> <span class="token function">satisfiable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scc<span class="token punctuation">.</span><span class="token function">scc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> comp <span class="token operator">=</span> scc<span class="token punctuation">.</span><span class="token function">get_comp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">==</span> comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         _answer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> comp<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _answer<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> _n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> _answer<span class="token punctuation">;</span>
   scc_graph scc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="graph/tree">graph/tree</h2>

    <div class="filename">
        <h2 id="cartesian_tree.hpp">cartesian_tree.hpp</h2>
        md5: ac77a5

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">cartesian_tree</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> root<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> par<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">;</span>

   <span class="token function">cartesian_tree</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">par</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stack<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> st<span class="token punctuation">;</span>
      <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> prev <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">[</span>st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">></span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            prev <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>prev <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> par<span class="token punctuation">[</span>prev<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> par<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      root <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> root <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> right<span class="token punctuation">[</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
         <span class="token keyword">else</span> left<span class="token punctuation">[</span>par<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="hld.hpp">hld.hpp</h2>
        md5: 10247f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">class</span> <span class="token class-name">HLDcomposition</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">int</span> V<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> G<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> stsize<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> pathtop<span class="token punctuation">,</span> in<span class="token punctuation">,</span> out<span class="token punctuation">;</span>
   <span class="token keyword">int</span> root<span class="token punctuation">;</span>
   <span class="token keyword">void</span> <span class="token function">build_stsize</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stsize<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> parent<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> v <span class="token operator">:</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">swap</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">build_stsize</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>
         stsize<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+=</span> stsize<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>stsize<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">></span> stsize<span class="token punctuation">[</span>G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build_path</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> tm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      in<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> tm<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> v <span class="token operator">:</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         pathtop<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> pathtop<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">:</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">build_path</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      out<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> tm<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">,</span> <span class="token keyword">int</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      G<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      G<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> _root <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      root <span class="token operator">=</span> _root<span class="token punctuation">;</span>
      <span class="token keyword">int</span> tm <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">build_stsize</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pathtop<span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
      <span class="token function">build_path</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> in<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">lca</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> pa <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>pa <span class="token operator">!=</span> pb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            a <span class="token operator">=</span> parent<span class="token punctuation">[</span>pa<span class="token punctuation">]</span><span class="token punctuation">,</span> pa <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            b <span class="token operator">=</span> parent<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">,</span> pb <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">subtree_query</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>in<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> out<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">>></span> <span class="token function">path_query</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> pf <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">,</span> pt <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">using</span> T <span class="token operator">=</span> tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">></span><span class="token punctuation">;</span>
      deque<span class="token operator">&lt;</span>T<span class="token operator">></span> front<span class="token punctuation">,</span> back<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>pf <span class="token operator">!=</span> pt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>pf<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>pt<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            front<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>pf<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            from <span class="token operator">=</span> parent<span class="token punctuation">[</span>pf<span class="token punctuation">]</span><span class="token punctuation">,</span> pf <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            back<span class="token punctuation">.</span><span class="token function">push_front</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>pt<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            to <span class="token operator">=</span> parent<span class="token punctuation">[</span>pt<span class="token punctuation">]</span><span class="token punctuation">,</span> pt <span class="token operator">=</span> pathtop<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>in<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">></span> in<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">)</span> front<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> front<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>in<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">,</span> in<span class="token punctuation">[</span>to<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>T<span class="token operator">></span> ret<span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>front<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>front<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         front<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>back<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ret<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>back<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         back<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token function">HLDcomposition</span><span class="token punctuation">(</span><span class="token keyword">int</span> node_size<span class="token punctuation">)</span>
       <span class="token operator">:</span> <span class="token function">V</span><span class="token punctuation">(</span>node_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">G</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">stsize</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">parent</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pathtop</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">in</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">out</span><span class="token punctuation">(</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="offline_lca.hpp">offline_lca.hpp</h2>
        md5: e88371

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">offline_lca</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> g<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> qs<span class="token punctuation">,</span> <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> Q <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span><span class="token punctuation">;</span>
   dsu <span class="token function">d</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">mark</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ptr</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ans</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   stack<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> st<span class="token punctuation">;</span>
   st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>l<span class="token punctuation">,</span> r<span class="token punctuation">]</span> <span class="token operator">:</span> qs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mark<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      mark<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">></span> <span class="token function">q</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>mark<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mark<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      ptr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      q<span class="token punctuation">[</span>qs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>qs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      q<span class="token punctuation">[</span>qs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>qs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">auto</span> run <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> u<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>ptr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">--</span>ptr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>mark<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>st<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> u <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>mark<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> mark<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
         d<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> g<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">[</span>ptr<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mark<span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">leader</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">run</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>v<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">:</span> q<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span>mark<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ans<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ans<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mark<span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">leader</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="rerooting.hpp">rerooting.hpp</h2>
        md5: 3bb537

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: b7fc0f</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">M</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> calc_contribution <span class="token operator">=</span> <span class="token boolean">false</span><span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">Rerooting</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> S <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span>S<span class="token punctuation">;</span>
   <span class="token keyword">using</span> C <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span>C<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> dp<span class="token punctuation">,</span> memo<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> C<span class="token operator">>></span><span class="token operator">></span> g<span class="token punctuation">;</span>
   map<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> S<span class="token operator">></span> hash<span class="token punctuation">;</span>
   <span class="token keyword">int</span> N<span class="token punctuation">;</span>

   <span class="token function">Rerooting</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">N</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">g</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add_edge</span><span class="token punctuation">(</span><span class="token keyword">int</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">const</span> C<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      g<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
      g<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span>S<span class="token operator">></span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      memo<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dp<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reroot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> dp<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span><span class="token operator">:</span>
   <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">int</span> pre <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">bool</span> is_leaf <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>to<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>to <span class="token operator">==</span> pre<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         is_leaf <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token function">dfs</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
         memo<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">merge</span><span class="token punctuation">(</span>memo<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">apply</span><span class="token punctuation">(</span>memo<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>is_leaf<span class="token punctuation">)</span> <span class="token punctuation">{</span> memo<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">leaf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">reroot</span><span class="token punctuation">(</span><span class="token keyword">int</span> cur<span class="token punctuation">,</span> <span class="token keyword">const</span> S val<span class="token punctuation">,</span> <span class="token keyword">int</span> pre <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span>S<span class="token operator">></span> ds<span class="token punctuation">;</span>
      ds<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>calc_contribution<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>pre <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> hash<span class="token punctuation">[</span>cur <span class="token operator">*</span> N <span class="token operator">+</span> pre<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>to<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>to <span class="token operator">==</span> pre<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         ds<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">apply</span><span class="token punctuation">(</span>memo<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>calc_contribution<span class="token punctuation">)</span> <span class="token punctuation">{</span> hash<span class="token punctuation">[</span>cur <span class="token operator">*</span> N <span class="token operator">+</span> to<span class="token punctuation">]</span> <span class="token operator">=</span> ds<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span>S<span class="token operator">></span> <span class="token function">l</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">r</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> l<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">merge</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> r<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">merge</span><span class="token punctuation">(</span>ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dp<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> ind <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token punctuation">[</span>to<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">:</span> g<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>to <span class="token operator">==</span> pre<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         S sub <span class="token operator">=</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">merge</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">[</span>ind <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">reroot</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">apply</span><span class="token punctuation">(</span>sub<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> to<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ind<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   S <span class="token function">get_contribution</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>p <span class="token operator">*</span> N <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> hash<span class="token punctuation">[</span>p <span class="token operator">*</span> N <span class="token operator">+</span> c<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">M</span><span class="token double-colon punctuation">::</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// e6000f</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*

struct M {
   using S = pair&lt;mm, int>; // DPの型
   using C = pair&lt;mm, mm>;  // 辺コストの型
   static S merge(S a, S b) { return {a.first + b.first, a.second + b.second}; } // DPのマージ
   static S apply(S a, int from, int to, C b) {  // DPの親への寄与
      return {(a.first + A[from]) * b.first + b.second * (a.second + 1), a.second + 1};
   }
   static S e() { return {0, 0}; } // 単位元
   static S leaf() { return {0, 0}; } // 葉の値
};

Rerooting&lt;M> reroot;
*/</span></code></pre>
</div>

    <h2 class="section" id="flow">flow</h2>

    <div class="filename">
        <h2 id="燃やす埋める.md">燃やす埋める.md</h2>
    </div>
    <div class="content content-md"><table>
<thead>
<tr>
<th>変形前の制約</th>
<th>変形後の制約</th>
</tr>
</thead>
<tbody><tr>
<td>$x$ が $0$ のとき $z$ 失う</td>
<td>$(x, T, z)$</td>
</tr>
<tr>
<td>$x$ が $0$ のとき $z$ 得る</td>
<td>無条件で $z$ 得る; $(S, x, z)$</td>
</tr>
<tr>
<td>$x$ が $1$ のとき $z$ 失う</td>
<td>$(S, x, z)$</td>
</tr>
<tr>
<td>$x$ が $1$ のとき $z$ 得る</td>
<td>無条件で $z$ 得る; $(x, T, z)$</td>
</tr>
<tr>
<td>$x, y, \dots$ がすべて $0$ のとき $z$ 得る</td>
<td>無条件で $z$ 得る; $(S, w, z), (w, x, \infty), (w, y, \infty)$</td>
</tr>
<tr>
<td>$x, y, \dots$ がすべて $1$ のとき $z$ 得る</td>
<td>無条件で $z$ 得る; $(w, T, z), (x, w, \infty), (y, w, \infty)$</td>
</tr>
</tbody></table>
</div>

    <h2 class="section" id="string">string</h2>

    <div class="filename">
        <h2 id="KMP.hpp">KMP.hpp</h2>
        md5: 298f79

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// kmp[i] := max{ l ≤ i | s[:l] == s[(i+1)-l:i+1] }</span>
<span class="token comment">// abacaba -> 0010123</span>
<span class="token keyword">auto</span> <span class="token function">KMP</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">p</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll g <span class="token operator">=</span> p<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>g <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">)</span> g <span class="token operator">=</span> p<span class="token punctuation">[</span>g <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> g <span class="token operator">+</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="Manacher.hpp">Manacher.hpp</h2>
        md5: 20c548

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// 各位置での回文半径を求める</span>
<span class="token comment">// aaabaaa -> 1214121</span>
<span class="token comment">// 偶数長の回文を含めて直径を知るには，N+1 個の $ を挿入して 1 を引く</span>
<span class="token comment">// $a$a$a$b$a$a$a$ -> 123432181234321</span>
<span class="token keyword">auto</span> <span class="token function">manacher</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">r</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">>=</span> j <span class="token operator">&amp;&amp;</span> i <span class="token operator">+</span> j <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i <span class="token operator">-</span> j<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> j<span class="token operator">++</span><span class="token punctuation">;</span>
      r<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>
      ll k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">>=</span> k <span class="token operator">&amp;&amp;</span> i <span class="token operator">+</span> k <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> k <span class="token operator">+</span> r<span class="token punctuation">[</span>i <span class="token operator">-</span> k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         r<span class="token punctuation">[</span>i <span class="token operator">+</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">[</span>i <span class="token operator">-</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
         k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      i <span class="token operator">+=</span> k<span class="token punctuation">,</span> j <span class="token operator">-=</span> k<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="RollingHash.hpp">RollingHash.hpp</h2>
        md5: 7403a8

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// using u64 = uint64_t;</span>
<span class="token keyword">const</span> u64 mod <span class="token operator">=</span> INF<span class="token punctuation">;</span>
u64 <span class="token function">add</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a <span class="token operator">+=</span> b<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">>=</span> mod<span class="token punctuation">)</span> a <span class="token operator">-=</span> mod<span class="token punctuation">;</span>
   <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
u64 <span class="token function">mul</span><span class="token punctuation">(</span>u64 a<span class="token punctuation">,</span> u64 b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">auto</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>__uint128_t<span class="token punctuation">)</span>a <span class="token operator">*</span> b<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>c <span class="token operator">>></span> <span class="token number">61</span><span class="token punctuation">,</span> c <span class="token operator">&amp;</span> mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
random_device rnd<span class="token punctuation">;</span>
<span class="token keyword">const</span> u64 r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>u64<span class="token punctuation">)</span><span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">32</span> <span class="token operator">|</span> <span class="token function">rnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">RH</span> <span class="token punctuation">{</span>
   ll n<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>u64<span class="token operator">></span> hs<span class="token punctuation">,</span> pw<span class="token punctuation">;</span>
   <span class="token function">RH</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hs</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pw</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         pw<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
         hs<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span>hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   u64 <span class="token function">get</span><span class="token punctuation">(</span>ll l<span class="token punctuation">,</span> ll r<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>hs<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> mod <span class="token operator">-</span> <span class="token function">mul</span><span class="token punctuation">(</span>hs<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> pw<span class="token punctuation">[</span>r <span class="token operator">-</span> l<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="SuffixArray.hpp">SuffixArray.hpp</h2>
        md5: cbf1dc

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// returns pair{sa, lcp}</span>
<span class="token comment">// sa 長さ n : s[sa[0]:] &lt; s[sa[1]:] &lt; … &lt; s[sa[n-1]:]</span>
<span class="token comment">// lcp 長さ n-1 : lcp[i] = LCP(s[sa[i]:], s[sa[i+1]:])</span>
<span class="token keyword">auto</span> <span class="token function">SA</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lim <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
   <span class="token comment">// assert(lim > ranges::max(s));</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">sa</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">lcp</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ws</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> lim<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rk</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>ll j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> p <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1LL</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lim <span class="token operator">=</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      p <span class="token operator">=</span> j<span class="token punctuation">;</span>
      <span class="token function">iota</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> j<span class="token punctuation">)</span> y<span class="token punctuation">[</span>p<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> j<span class="token punctuation">;</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> ws<span class="token punctuation">[</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lim<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> ws<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> ws<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span>ll i <span class="token operator">=</span> n<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">)</span> sa<span class="token punctuation">[</span><span class="token operator">--</span>ws<span class="token punctuation">[</span>x<span class="token punctuation">[</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      p <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      x<span class="token punctuation">[</span>sa<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ll a <span class="token operator">=</span> sa<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         x<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">==</span> y<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> y<span class="token punctuation">[</span>a <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">==</span> y<span class="token punctuation">[</span>b <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> p <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> p<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> rk<span class="token punctuation">[</span>sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> lcp<span class="token punctuation">[</span>rk<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> k<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i <span class="token operator">+</span> k<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>sa<span class="token punctuation">[</span>rk<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> k<span class="token punctuation">]</span><span class="token punctuation">)</span> k<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   sa<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   lcp<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>lcp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> pair<span class="token punctuation">{</span>sa<span class="token punctuation">,</span> lcp<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="Zalgorithm.hpp">Zalgorithm.hpp</h2>
        md5: 6388f3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// Z[i] := LCP(s, s[i:])</span>
<span class="token comment">// abacaba -> 7010301</span>
<span class="token keyword">auto</span> <span class="token function">Z</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   ll n <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>ll<span class="token operator">></span> <span class="token function">z</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll<span class="token operator">&amp;</span> x <span class="token operator">=</span> z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">&lt;</span> r <span class="token operator">?</span> <span class="token function">min</span><span class="token punctuation">(</span>r <span class="token operator">-</span> i<span class="token punctuation">,</span> z<span class="token punctuation">[</span>i <span class="token operator">-</span> l<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">+</span> x <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> x<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">+</span> x <span class="token operator">></span> r<span class="token punctuation">)</span> l <span class="token operator">=</span> i<span class="token punctuation">,</span> r <span class="token operator">=</span> i <span class="token operator">+</span> x<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="aho_corasick.hpp">aho_corasick.hpp</h2>
        md5: f30f1f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// base: 822702</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> char_size<span class="token punctuation">,</span> <span class="token keyword">int</span> margin<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">AhoCorasick</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">Trie</span><span class="token operator">&lt;</span><span class="token class-name">char_size</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">margin</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> Trie<span class="token operator">&lt;</span>char_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> margin<span class="token operator">></span><span class="token double-colon punctuation">::</span>Trie<span class="token punctuation">;</span>

   <span class="token keyword">const</span> <span class="token keyword">int</span> FAIL <span class="token operator">=</span> char_size<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> correct<span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">bool</span> heavy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      correct<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span> correct<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> que<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> char_size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            que<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>que<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span><span class="token operator">&amp;</span> now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> fail <span class="token operator">=</span> now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span><span class="token punctuation">;</span>
         correct<span class="token punctuation">[</span>que<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> correct<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">;</span>
         que<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> char_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">~</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>FAIL<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>heavy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">auto</span><span class="token operator">&amp;</span> u <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">;</span>
                  <span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">;</span>
                  vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> accept<span class="token punctuation">;</span>
                  <span class="token function">set_union</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">all</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">back_inserter</span><span class="token punctuation">(</span>accept<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  u <span class="token operator">=</span> accept<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               que<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               now<span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>fail<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">;</span>
      now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c <span class="token operator">-</span> margin<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 68ef6b</span>

   unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      unordered_map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">,</span> visit_cnt<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> c <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c <span class="token operator">-</span> margin<span class="token punctuation">]</span><span class="token punctuation">;</span>
         visit_cnt<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>now<span class="token punctuation">,</span> cnt<span class="token punctuation">]</span> <span class="token operator">:</span> visit_cnt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> v <span class="token operator">:</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span> res<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+=</span> cnt<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 36fe6c</span>

   pair<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> c<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      now <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>nodes<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c <span class="token operator">-</span> margin<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>correct<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">,</span> now<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// 43ccad</span>

   pair<span class="token operator">&lt;</span>ll<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ll res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> c <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">auto</span> <span class="token punctuation">[</span>cnt<span class="token punctuation">,</span> nxt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">move</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
         res <span class="token operator">+=</span> cnt<span class="token punctuation">;</span>
         now <span class="token operator">=</span> nxt<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>res<span class="token punctuation">,</span> now<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>  <span class="token comment">// b1949a</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <div class="filename">
        <h2 id="sa_is.hpp">sa_is.hpp</h2>
        md5: 162db6

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sa_is</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> upper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sa</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">></span> <span class="token function">ls</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> ls<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> s<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sum_l</span><span class="token punctuation">(</span>upper <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum_s</span><span class="token punctuation">(</span>upper <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> sum_s<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> sum_l<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> upper<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sum_s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> sum_l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> upper<span class="token punctuation">)</span> sum_l<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> sum_s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">auto</span> induce <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> lms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">buf</span><span class="token punctuation">(</span>upper <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sum_s<span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> d <span class="token operator">:</span> lms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>d <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         sa<span class="token punctuation">[</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sum_l<span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sa<span class="token punctuation">[</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">>=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ls<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> sa<span class="token punctuation">[</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">all</span><span class="token punctuation">(</span>sum_l<span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> v <span class="token operator">=</span> sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>v <span class="token operator">>=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> sa<span class="token punctuation">[</span><span class="token operator">--</span>buf<span class="token punctuation">[</span>s<span class="token punctuation">[</span>v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">lms_map</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> lms_map<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> m<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> lms<span class="token punctuation">;</span>
   lms<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ls<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> lms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">induce</span><span class="token punctuation">(</span>lms<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> sorted_lms<span class="token punctuation">;</span>
      sorted_lms<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> v <span class="token operator">:</span> sa<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>lms_map<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> sorted_lms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">rec_s</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> rec_upper <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      rec_s<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>sorted_lms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> l <span class="token operator">=</span> sorted_lms<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> r <span class="token operator">=</span> sorted_lms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> end_l <span class="token operator">=</span> <span class="token punctuation">(</span>lms_map<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token operator">?</span> lms<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> n<span class="token punctuation">;</span>
         <span class="token keyword">int</span> end_r <span class="token operator">=</span> <span class="token punctuation">(</span>lms_map<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token operator">?</span> lms<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> n<span class="token punctuation">;</span>
         <span class="token keyword">bool</span> same <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>end_l <span class="token operator">-</span> l <span class="token operator">!=</span> end_r <span class="token operator">-</span> r<span class="token punctuation">)</span> same <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> end_l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
               l<span class="token operator">++</span><span class="token punctuation">;</span>
               r<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>l <span class="token operator">==</span> n <span class="token operator">||</span> s<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> same <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>same<span class="token punctuation">)</span> rec_upper<span class="token operator">++</span><span class="token punctuation">;</span>
         rec_s<span class="token punctuation">[</span>lms_map<span class="token punctuation">[</span>sorted_lms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> rec_upper<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">auto</span> rec_sa <span class="token operator">=</span> <span class="token function">sa_is</span><span class="token punctuation">(</span>rec_s<span class="token punctuation">,</span> rec_upper<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> sorted_lms<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> lms<span class="token punctuation">[</span>rec_sa<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token function">induce</span><span class="token punctuation">(</span>sorted_lms<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> sa<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="trie.hpp">trie.hpp</h2>
        md5: 09415e

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> char_size<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">TrieNode</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> nxt<span class="token punctuation">[</span>char_size<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> exist<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> accept<span class="token punctuation">;</span>

   <span class="token function">TrieNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">exist</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">memset</span><span class="token punctuation">(</span>nxt<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>nxt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> char_size<span class="token punctuation">,</span> <span class="token keyword">int</span> margin<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">Trie</span> <span class="token punctuation">{</span>
   <span class="token keyword">using</span> Node <span class="token operator">=</span> TrieNode<span class="token operator">&lt;</span>char_size<span class="token operator">></span><span class="token punctuation">;</span>

   vector<span class="token operator">&lt;</span>Node<span class="token operator">></span> nodes<span class="token punctuation">;</span>
   <span class="token keyword">int</span> root<span class="token punctuation">;</span>
   <span class="token function">Trie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">update_direct</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> nodes<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">update_child</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">,</span> <span class="token keyword">int</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">++</span>nodes<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>exist<span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> str_index<span class="token punctuation">,</span> <span class="token keyword">int</span> node_index<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>str_index <span class="token operator">==</span> <span class="token function">size</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">update_direct</span><span class="token punctuation">(</span>node_index<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> <span class="token keyword">int</span> c <span class="token operator">=</span> str<span class="token punctuation">[</span>str_index<span class="token punctuation">]</span> <span class="token operator">-</span> margin<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            nodes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">add</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> str_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">update_child</span><span class="token punctuation">(</span>node_index<span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> id <span class="token operator">=</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>exist<span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> str_index<span class="token punctuation">,</span> <span class="token keyword">int</span> node_index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> idx <span class="token operator">:</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>accept<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>str_index <span class="token operator">==</span> <span class="token function">size</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> <span class="token keyword">int</span> c <span class="token operator">=</span> str<span class="token punctuation">[</span>str_index<span class="token punctuation">]</span> <span class="token operator">-</span> margin<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token function">query</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> f<span class="token punctuation">,</span> str_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nodes<span class="token punctuation">[</span>node_index<span class="token punctuation">]</span><span class="token punctuation">.</span>nxt<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">&amp;</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">query</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>exist<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="algorithm">algorithm</h2>

    <div class="filename">
        <h2 id="doubling.hpp">doubling.hpp</h2>
        md5: df858f

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> L<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">Doubling</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> V<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">Doubling</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      V <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span></span></span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> V<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> L <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> V<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">int</span> <span class="token function">jump</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> ll k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">++</span>cnt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> from <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> from <span class="token operator">=</span> V<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> from<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="doubling_monoid.hpp">doubling_monoid.hpp</h2>
        md5: 530e69

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">int</span> L<span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">auto</span> op<span class="token punctuation">,</span> <span class="token keyword">auto</span> e<span class="token operator">></span> <span class="token keyword">struct</span> <span class="token class-name">Doubling</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span><span class="token operator">:</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> V<span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span> data<span class="token punctuation">;</span>

   <span class="token keyword">public</span><span class="token operator">:</span>
   <span class="token function">Doubling</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> to<span class="token punctuation">,</span> <span class="token keyword">const</span> vector<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>
      V <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span></span></span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      data <span class="token operator">=</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>T<span class="token operator">>></span></span></span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">></span></span></span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         V<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> to<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> L <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               V<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
               data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               V<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
               data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> T<span class="token operator">></span> <span class="token function">jump</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">,</span> ll k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      T res <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">++</span>cnt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> from <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> data<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            from <span class="token operator">=</span> V<span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>from<span class="token punctuation">,</span> res<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>

    <h2 class="section" id="geometry">geometry</h2>

    <div class="filename">
        <h2 id="base.hpp">base.hpp</h2>
        md5: 9ca2e3

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token keyword">using</span> Point <span class="token operator">=</span> complex<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">using</span> Line <span class="token operator">=</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">X</span> <span class="token expression"><span class="token function">real</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Y</span> <span class="token expression"><span class="token function">imag</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">const</span> <span class="token keyword">double</span> EPS <span class="token operator">=</span> <span class="token number">1e-10</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>X <span class="token operator">*</span> b<span class="token punctuation">.</span>X <span class="token operator">+</span> a<span class="token punctuation">.</span>Y <span class="token operator">*</span> b<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>X <span class="token operator">*</span> b<span class="token punctuation">.</span>Y <span class="token operator">-</span> a<span class="token punctuation">.</span>Y <span class="token operator">*</span> b<span class="token punctuation">.</span>X<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre>
</div>

    <div class="filename">
        <h2 id="convex_hull.hpp">convex_hull.hpp</h2>
        md5: 17af99

    </div>
    <div class="content content-hpp">
    <pre><code>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> <span class="token function">convex_hull</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">,</span> <span class="token keyword">bool</span> collinear <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ps<span class="token punctuation">;</span>
   <span class="token function">sort</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">&amp;</span>EPS<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>X <span class="token operator">-</span> b<span class="token punctuation">.</span>X<span class="token punctuation">)</span> <span class="token operator">></span> EPS <span class="token operator">?</span> a<span class="token punctuation">.</span>X <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>X <span class="token operator">:</span> a<span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> <span class="token function">hull</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> th <span class="token operator">=</span> collinear <span class="token operator">?</span> <span class="token operator">-</span>EPS <span class="token operator">:</span> EPS<span class="token punctuation">;</span>
   <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> th<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         hull<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">int</span> t <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">>=</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> th<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> t<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span>hull<span class="token punctuation">[</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         hull<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         k<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   hull<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> hull<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="etc.hpp">etc.hpp</h2>
        md5: 093f7a

    </div>
    <div class="content content-hpp">
    <pre><code><span class="token comment">// 1: a-bから見てa-cが反時計回り</span>
<span class="token comment">// -1: a-bから見てa-cが時計回り</span>
<span class="token comment">// 0: a-c-bがこの順で直線</span>
<span class="token comment">// 2: c-a-bの順で直線</span>
<span class="token comment">// -2: a-b-cの順で直線</span>

<span class="token keyword">int</span> <span class="token function">ccw</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> b<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">,</span> c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">,</span> c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">,</span> c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">norm</span><span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">norm</span><span class="token punctuation">(</span>c <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">-</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 6f1927</span>

Point <span class="token function">projection</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">double</span> t <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>p <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">norm</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> t <span class="token operator">*</span> <span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// b9dbd7</span>

Point <span class="token function">reflection</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> l<span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token comment">// 65ba76</span>

<span class="token comment">// point and line intersection</span>
<span class="token keyword">bool</span> <span class="token function">isinterPL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token comment">// e9d393</span>

<span class="token comment">// point and segment intersection</span>
<span class="token keyword">bool</span> <span class="token function">isinterPS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">ccw</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token comment">// 79c17b</span>

<span class="token comment">// two lines intersection</span>
<span class="token keyword">bool</span> <span class="token function">isinterLL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> EPS <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// b58dbd</span>

<span class="token comment">// two segments intersection</span>
<span class="token keyword">bool</span> <span class="token function">isinterSS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">norm</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">isinterPS</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">norm</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">isinterPS</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">ccw</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">ccw</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">ccw</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">ccw</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// a499ea</span>

<span class="token keyword">double</span> <span class="token function">distancePL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token comment">// c77772</span>

<span class="token keyword">double</span> <span class="token function">distancePS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   Point h <span class="token operator">=</span> <span class="token function">projection</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isinterPS</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span>p <span class="token operator">-</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 3bd780</span>

<span class="token keyword">double</span> <span class="token function">distanceLL</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isinterLL</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">distancePL</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// ab4ace</span>

<span class="token keyword">double</span> <span class="token function">distanceSS</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> s<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isinterSS</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token function">distancePS</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">distancePS</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">distancePS</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">distancePS</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// c284e5</span>

<span class="token comment">// if(ans){ x = p->X; y = q->Y} else {cout &lt;&lt; "not cross"}</span>
optional<span class="token operator">&lt;</span>Point<span class="token operator">></span> <span class="token function">crosspoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Line<span class="token operator">&amp;</span> l<span class="token punctuation">,</span> <span class="token keyword">const</span> Line<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">double</span> d <span class="token operator">=</span> <span class="token function">cross</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> nullopt<span class="token punctuation">;</span>
   <span class="token keyword">return</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cross</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 687c0c</span>

<span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">double</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> res <span class="token operator">+=</span> <span class="token function">cross</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token function">size</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> res <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 3b832b</span>

<span class="token keyword">bool</span> <span class="token function">is_convex</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ccw</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 52fb34</span>

tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">diameter</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> si <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sj <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">></span> ps<span class="token punctuation">[</span>si<span class="token punctuation">]</span><span class="token punctuation">.</span>Y<span class="token punctuation">)</span> si <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> ps<span class="token punctuation">[</span>sj<span class="token punctuation">]</span><span class="token punctuation">.</span>Y<span class="token punctuation">)</span> sj <span class="token operator">=</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">double</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> i <span class="token operator">=</span> si<span class="token punctuation">,</span> j <span class="token operator">=</span> sj<span class="token punctuation">;</span>
   <span class="token keyword">int</span> ri <span class="token operator">=</span> i<span class="token punctuation">,</span> rj <span class="token operator">=</span> j<span class="token punctuation">;</span>
   <span class="token keyword">do</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmax</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         ri <span class="token operator">=</span> i<span class="token punctuation">;</span>
         rj <span class="token operator">=</span> j<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span> <span class="token operator">-</span> ps<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">;</span>
      <span class="token keyword">else</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">!=</span> si <span class="token operator">||</span> j <span class="token operator">!=</span> sj<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>res<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>ri<span class="token punctuation">,</span> rj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>ri<span class="token punctuation">,</span> rj<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// cae9ad</span>

<span class="token comment">// 2: inside, 1: border, 0: outside</span>
<span class="token keyword">int</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>Point<span class="token operator">></span><span class="token operator">&amp;</span> ps<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">bool</span> in <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Point a <span class="token operator">=</span> ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">,</span> b <span class="token operator">=</span> ps<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>Y <span class="token operator">></span> b<span class="token punctuation">.</span>Y<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>Y <span class="token operator">&lt;=</span> EPS <span class="token operator">&amp;&amp;</span> EPS <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>Y <span class="token operator">&amp;&amp;</span> <span class="token function">cross</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>EPS<span class="token punctuation">)</span> in <span class="token operator">=</span> <span class="token operator">!</span>in<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS <span class="token operator">&amp;&amp;</span> <span class="token function">dot</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> in <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// fd7e87</span>

tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token function">closest_pair</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">></span> ps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token keyword">double</span> INF <span class="token operator">=</span> <span class="token number">1e18</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>INF<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">using</span> P <span class="token operator">=</span> pair<span class="token operator">&lt;</span>Point<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">;</span>
   vector<span class="token operator">&lt;</span>P<span class="token operator">></span> <span class="token function">V</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> V<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>ps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> P<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> P<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">-</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">-</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">)</span> <span class="token operator">></span> EPS<span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">.</span>second <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">auto</span> rec <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> self<span class="token punctuation">,</span> <span class="token keyword">auto</span> it<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token operator">-></span> tuple<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>INF<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> m <span class="token operator">=</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> x <span class="token operator">=</span> it<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>d1<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> b1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> it<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">auto</span> <span class="token punctuation">[</span>d2<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> b2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> it <span class="token operator">+</span> m<span class="token punctuation">,</span> n <span class="token operator">-</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> d<span class="token punctuation">;</span>
      <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>d1 <span class="token operator">&lt;</span> d2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         d <span class="token operator">=</span> d1<span class="token punctuation">;</span>
         a <span class="token operator">=</span> a1<span class="token punctuation">;</span>
         b <span class="token operator">=</span> b1<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         d <span class="token operator">=</span> d2<span class="token punctuation">;</span>
         a <span class="token operator">=</span> a2<span class="token punctuation">;</span>
         b <span class="token operator">=</span> b2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">inplace_merge</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> it <span class="token operator">+</span> m<span class="token punctuation">,</span> it <span class="token operator">+</span> n<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> P<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> P<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      vector<span class="token operator">&lt;</span>P<span class="token operator">></span> vec<span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">>=</span> d<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">double</span> dx <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X <span class="token operator">-</span> vec<span class="token punctuation">[</span><span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span> <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span> dy <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y <span class="token operator">-</span> vec<span class="token punctuation">[</span><span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span> <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dy <span class="token operator">>=</span> d<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chmin</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               a <span class="token operator">=</span> it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
               b <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token function">size</span><span class="token punctuation">(</span>vec<span class="token punctuation">)</span> <span class="token operator">-</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         vec<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>it<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>d<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> <span class="token punctuation">[</span>d<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rec</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> V<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>d<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">// 12a9dc</span></code></pre>
</div>

    <h2 class="section" id="memo">memo</h2>

    <div class="filename">
        <h2 id="Primes.md">Primes.md</h2>
    </div>
    <div class="content content-md"><h4>素数の個数</h4>
<table>
<thead>
<tr>
<th>$n$</th>
<th>$10^2$</th>
<th>$10^3$</th>
<th>$10^4$</th>
<th>$10^5$</th>
<th>$10^6$</th>
<th>$10^7$</th>
<th>$10^8$</th>
<th>$10^9$</th>
<th>$10^{10}$</th>
</tr>
</thead>
<tbody><tr>
<td>$\pi(n)$</td>
<td>25</td>
<td>168</td>
<td>1229</td>
<td>9592</td>
<td>78498</td>
<td>664579</td>
<td>5.76e+6</td>
<td>5.08e+7</td>
<td>4.55e+8</td>
</tr>
</tbody></table>
<h4>高度合成数</h4>
<table>
<thead>
<tr>
<th>$≤n$</th>
<th>$10^3$</th>
<th>$10^4$</th>
<th>$10^5$</th>
<th>$10^6$</th>
<th>$10^7$</th>
<th>$10^8$</th>
<th>$10^9$</th>
</tr>
</thead>
<tbody><tr>
<td>$x$</td>
<td>840</td>
<td>7560</td>
<td>83160</td>
<td>720720</td>
<td>8648640</td>
<td>73513440</td>
<td>735134400</td>
</tr>
<tr>
<td>$d^0(x)$</td>
<td>32</td>
<td>64</td>
<td>128</td>
<td>240</td>
<td>448</td>
<td>768</td>
<td>1344</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>$≤n$</th>
<th>$10^{10}$</th>
<th>$10^{11}$</th>
<th>$10^{12}$</th>
<th>$10^{13}$</th>
<th>$10^{14}$</th>
<th>$10^{15}$</th>
<th>$10^{16}$</th>
<th>$10^{17}$</th>
<th>$10^{18}$</th>
</tr>
</thead>
<tbody><tr>
<td>$d^0(x)$</td>
<td>2304</td>
<td>4032</td>
<td>6720</td>
<td>10752</td>
<td>17280</td>
<td>26880</td>
<td>41472</td>
<td>64512</td>
<td>103680</td>
</tr>
</tbody></table>
<h4>素数階乗</h4>
<table>
<thead>
<tr>
<th>$n$</th>
<th>$2$</th>
<th>$3$</th>
<th>$5$</th>
<th>$7$</th>
<th>$11$</th>
<th>$13$</th>
<th>$17$</th>
<th>$19$</th>
<th>$23$</th>
<th>$29$</th>
</tr>
</thead>
<tbody><tr>
<td>$n\#$</td>
<td>2</td>
<td>6</td>
<td>30</td>
<td>210</td>
<td>2310</td>
<td>30030</td>
<td>510510</td>
<td>9.70e+6</td>
<td>2.23e+8</td>
<td>6.47e+9</td>
</tr>
</tbody></table>
<h4>階乗</h4>
<table>
<thead>
<tr>
<th>$4!$</th>
<th>$5!$</th>
<th>$6!$</th>
<th>$7!$</th>
<th>$8!$</th>
<th>$9!$</th>
<th>$10!$</th>
<th>$11!$</th>
<th>$12!$</th>
<th>$13!$</th>
</tr>
</thead>
<tbody><tr>
<td>24</td>
<td>120</td>
<td>720</td>
<td>5040</td>
<td>40320</td>
<td>362880</td>
<td>3.63e+6</td>
<td>3.99e+7</td>
<td>4.79e+8</td>
<td>6.23e+9</td>
</tr>
</tbody></table>
</div>

    <div class="filename">
        <h2 id="ext.cpp">ext.cpp</h2>
        md5: 64e006

    </div>
    <div class="content content-cpp">
    <pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/pb_ds/assoc_container.hpp></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/pb_ds/tree_policy.hpp></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/pb_ds/priority_queue.hpp></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ext/rope></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> __gnu_pbds<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> __gnu_cxx<span class="token punctuation">;</span>  <span class="token comment">// for ext/rope</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   tree<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> null_type<span class="token punctuation">,</span> less<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">,</span> rb_tree_tag<span class="token punctuation">,</span> tree_order_statistics_node_update<span class="token operator">></span> tree<span class="token punctuation">;</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// 1 10</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1 6 10</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1 6 7 10</span>
   tree<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// 1 4 6 7 10</span>
   tree<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 1 4 7 10</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span><span class="token function">order_of_key</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5未満の要素数</span>
   <span class="token function">assert</span><span class="token punctuation">(</span><span class="token operator">*</span>tree<span class="token punctuation">.</span><span class="token function">find_by_order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0-indexedで2番目の要素</span>

   gp_hash_table<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">></span> m<span class="token punctuation">;</span>
   m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
   m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
   m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

   __gnu_pbds<span class="token double-colon punctuation">::</span>priority_queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> greater<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">,</span> rc_binomial_heap_tag<span class="token operator">></span> pq<span class="token punctuation">;</span>
   <span class="token keyword">auto</span> it <span class="token operator">=</span> pq<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
   pq<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 1 10</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pq<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10 20</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pq<span class="token punctuation">.</span><span class="token function">erase_if</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 20</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pq<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// empty</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// access, insert, erase: O(log n)</span>
   rope<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> v<span class="token punctuation">;</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2 1</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2 3 1</span>
   v<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2 3 4 1</span>
   v<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 2 1</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">assert</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>

    <div class="filename">
        <h2 id="priority_queue.md">priority_queue.md</h2>
    </div>
    <div class="content content-md"><table>
<thead>
<tr>
<th></th>
<th>push</th>
<th>pop</th>
<th>modify</th>
<th>erase</th>
</tr>
</thead>
<tbody><tr>
<td>std::priority_queue</td>
<td>最悪$\Theta(n)$,償却$\Theta(\log(n))$</td>
<td>最悪$\Theta(\log(n))$</td>
<td>最悪$\Theta(n\log(n))$</td>
<td>$\Theta(n \log(n))$</td>
</tr>
<tr>
<td>pairing_heap_tag</td>
<td>$O(1)$</td>
<td>最悪$\Theta(n)$, 償却$\Theta(\log n)$</td>
<td>最悪$\Theta(n)$, 償却$\Theta(\log(n))$</td>
<td>最悪$\Theta(n)$, 償却$O(\log(n))$</td>
</tr>
<tr>
<td>binary_heap_tag</td>
<td>最悪$\Theta(n)$, 償却$O(\log(n))$</td>
<td>最悪$\Theta(n)$, 償却$O(\log(n))$</td>
<td>$\Theta(n)$</td>
<td>$\Theta(n)$</td>
</tr>
<tr>
<td>binomial_heap_tag</td>
<td>最悪$\Theta(n)$, 償却$O(\log(n))$</td>
<td>$\Theta(\log (n))$</td>
<td>$\Theta(\log(n)) $</td>
<td>$\Theta(\log(n))$</td>
</tr>
<tr>
<td>rc_binomial_heap_tag</td>
<td>$O(1)$</td>
<td>$\Theta(\log(n))$</td>
<td>$\Theta(\log(n))$</td>
<td>$\Theta(\log(n))$</td>
</tr>
<tr>
<td>thin_heap_tag</td>
<td>$O(1)$</td>
<td>最悪$\Theta(n)$, 償却$O(\log(n))$</td>
<td>最悪$\Theta(\log(n))$,償却$O(1)$ or 償却$\Theta(\log n)$</td>
<td>最悪$\Theta(n)$, 償却$O(\log(n))$</td>
</tr>
</tbody></table>
<p>joinは基本的にeraseの最悪計算量に一致.pairing_heap_tagのみ高速で$O(1)$</p>
</div>

</body>
</html>